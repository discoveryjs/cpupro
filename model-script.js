var Zt=Object.defineProperty;var Da=Object.getOwnPropertyDescriptor;var Ba=Object.getOwnPropertyNames;var va=Object.prototype.hasOwnProperty;var lt=(t,e)=>()=>(t&&(e=t(t=0)),e);var O=(t,e)=>{for(var r in e)Zt(t,r,{get:e[r],enumerable:!0})},Ua=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ba(e))!va.call(t,s)&&s!==r&&Zt(t,s,{get:()=>e[s],enumerable:!(n=Da(e,s))||n.enumerable});return t};var La=t=>Ua(Zt({},"__esModule",{value:!0}),t);var yn={};O(yn,{default:()=>ff});function ff(t){t.textView.define("allocation-samples-matrix",{view:"table",data:"sort(type.order() asc)",cols:[{header:"Type",content:"text:type",footer:'text:"All types"'},...pf]})}var uf,ti,pf,ri=lt(()=>{uf=[{key:"total",header:"All lifespans"},{key:"alive",header:"Alive"},{key:"long-lived",header:"Long lived"},{key:"short-lived",header:"Short lived"}],ti={view:"context",when:"sum",content:['text:sum > 999 ? sum.unit() : sum + "b"','text:` (${min != max ? min + "\u2026" : ""}${max.bytes()} \xD7 ${count})`']},pf=uf.map(({key:t,header:e})=>({header:e,data:`$["${t}"]`,content:ti,footer:{data:`.($["${t}"]) | { count: sum(=>count), sum(=>sum), min.min(), max.max() }`,content:ti}}))});var An={};O(An,{default:()=>mf});function mf({textView:t}){t.define("duration",(e,r,n,s)=>{let{time:o,total:i}=n,a=s.data?.currentProfile?.type||"time";e.appendText(`${(o/1e3).toFixed(1)}${a==="memory"?"Kb":"ms"} (${(100*o/i).toFixed(1)}%)`)})}var ni=lt(()=>{});var Tn={};O(Tn,{default:()=>df});function df({textView:t}){t.define("call-frame-source",{view:"source",context:"{ ..., currentProfile: #.data.currentProfile }",data:`{
            $script;
            $source: $script.source;
            $sourceSliceStart: $source.lastIndexOf('\\n', start) + 1;
            $sourceSliceEnd: $source.indexOf('\\n', end) | $ != -1 ?: $source.size();
            $sourceSlice: $source[$sourceSliceStart:$sourceSliceEnd].replace(/\\n$/, '');
            $line: line or 1;
            $start;
            $end;
            $unit: #.currentProfile.type = 'memory' ? 'Kb' : 'ms';
            $scriptFunction: #.currentProfile.codesByCallFrame[=> callFrame = @];
            $values: #.currentProfile
                | #.nonFilteredTimings
                    ? callFramePositionsTimings or callFramesTimings
                    : callFramePositionsTimingsFiltered or callFramesTimingsFiltered;

            $inlinePoints: $scriptFunction.codes
                | $[-1]
                | inlined.match(/O\\d+(?=F|$)/g).matched;
            $codePoints: $scriptFunction.codes
                | $.[tier="Ignition"][-1] or .[positions][-1]
                | positions.match(/O\\d+(?=C|$)/g).matched;

            $inlinedMarks: $scriptFunction.codes[-1].inlined.match(/O\\d+(?=F|$)/g).matched
                |? .({ offset: +$[1:] - $sourceSliceStart, content: 'text:"1"', className: 'def', prefix: 'Inline' });
            $codePointMarks: $codePoints
                |? .(+$[1:] - $sourceSliceStart | is number ? { offset: $ });

            $sampleMarkContent: {
                view: 'text',
                data: 'value[prop] | $ > 0 ? (@.prop = "selfTime" ? "self: " : "nested: ") + unit() : ""'
            };
            $sampleMarks: $values.entries
                | $[].entry.callFrame
                    ? .[entry.callFrame = @]
                    : $[=> entry = @]
                |? .($pos: entry.scriptOffset | is number and $ != -1 ? $ - $sourceSliceStart : $start - $sourceSliceStart; [
                    selfTime ? {
                        offset: $pos,
                        kind: 'self',
                        content: $sampleMarkContent,
                        value: $values.entries[entryIndex],
                        prop: 'selfTime'
                    },
                    nestedTime ? {
                        offset: $pos,
                        kind: 'nested',
                        content: $sampleMarkContent,
                        value: $values.entries[entryIndex],
                        prop: 'nestedTime'
                    },
                ]).[];

            $allMarks: {
                $sampleMarks
            };

            syntax: "js",
            source: $sourceSlice,
            lineNum: => $ + $line,
            callFrame: @,
            $allMarks,
            marks: $allMarks.values().[].()
        }`})}var oi=lt(()=>{});var si={};O(si,{default:()=>hf});function hf(t){t.apply([yn,An,Tn])}var ii=lt(()=>{ri();ni();oi()});import fa from"node:fs";import Jn from"node:path";import{isReadable as cd,Readable as ud}from"node:stream";var Kn={name:"Implicit config",version:null,description:null,model:{slug:"default",name:"cpupro",version:"0.7.0",description:"A viewer for CPU profiles captured in V8 runtimes like Node.js, Deno or Chromium browsers",meta:{demos:[{runtime:"nodejs",title:"V8 CPU profile",url:"demo/nodejs.jsonxl"},{runtime:"deno",title:"V8 log (preprocessed)",url:"demo/deno.jsonxl"},{runtime:"chromium",title:"Chromium Profile",url:"demo/chromium.jsonxl"},{runtime:"edge",title:"Edge EPT",url:"demo/edge.jsonxl"}]}}};function ye(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r];return e}function Qn(t){let e=t[0];for(let r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e}function Re(t){let e=new Uint32Array(t.length);for(let r=0;r<e.length;r++)e[r]=t[r];return e}function eo(t){let e=new Int32Array(t.length);for(let r=0;r<e.length;r++)e[r]=t[r];return e}var dd=64*1024;var Xn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe=new Uint8Array(256);for(let t=0;t<Xn.length;t++)Fe[Xn.charCodeAt(t)]=t;function to(t){let e=t.length;for(;e>0&&t[e-1]==="=";)e--;let r=new Uint8Array(3*Math.ceil(e/4)),n=0,s=0,o=0,i=0;for(let a=0,l=0;a<e;)n=Fe[t.charCodeAt(a++)&255],s=Fe[t.charCodeAt(a++)&255],o=Fe[t.charCodeAt(a++)&255],i=Fe[t.charCodeAt(a++)&255],r[l++]=n<<2|s>>4,r[l++]=s<<4|o>>2,r[l++]=o<<6|i;return r.subarray(0,(e>>2)*3+(e%4*6>>3))}function ro(t){let e=t[t.length-1].id;if(e!==t.length)for(let r=0;r<t.length;r++)t[r].id>e&&(e=t[r].id);return e}var Zn=function(){let t="(?<pkg>(?:[^/]+/)?[^/]+?)",e="(?<pkg>(?:@[^/]+/)?[^/]+?)",r="(?:@(?<version>[^/]+))?",n="(?:/(?<path>.+))?",s={specifier:e+r+n,pkg:t,atpkg:e,version:r,"/version":"(?:/(?<version>[^/]+))?",path:n},o=new RegExp(`\\[(${Object.keys(s).join("|")})\\]`,"g");return function(a){return new RegExp(`^/${a.replace(o,(l,c)=>s[c])}$`,"d")}}();function oe(...t){return t.map(e=>typeof e=="string"?{registry:e,pattern:Zn("[specifier]")}:{registry:e.registry,pattern:Zn(e.pattern||"[specifier]")})}var ue=!1,no=!0,oo=!1,yd=Object.freeze([]),Qt=48,so=new Map([["(root)","root"],["(program)","program"],["(garbage collector)","gc"],["(idle)","idle"],["(no samples)","no-samples"],["(parser)","parser"],["(bytecode compiler)","bytecode-compiler"],["(compiler)","compiler"],["(atomics wait)","atomics-wait"]]),er=new Map([["(root)","root"],["(program)","program"],["(garbage collector)","gc"],["(idle)","idle"],["(no samples)","unknown"],["(parser)","compilation"],["(bytecode compiler)","compilation"],["(compiler)","compilation"],["(atomics wait)","blocking"]]),io=["script","wasm","regexp","electron","deno","node","internals","program","devtools","chrome-extension","gc","compilation","blocking","root","idle","unknown"],ct=["Unknown","Ignition","Sparkplug","Maglev","Turboprop","Turbofan"],ut={Unknown:"cold",Ignition:"cold",Sparkplug:"warm",Maglev:"hot",Turboprop:"hot",Turbofan:"hot"},ao={fmkadmapgofadopljbjfkapdkoienihi:"React Developer Tools",lmhkpmbekcpmknklioeibfkpmmfibljd:"Redux DevTools",nhdogjmejiglipccpnnnanhbledajbpd:"Vue.js devtools",ienfalfjdbdpebioblfackkekamfmbnh:"Angular DevTools",jdkknkkbebbapilgoeccciglkfbmbnfm:"Apollo Client Devtools",hcikjlholajopgbgfmmlbmifdfbkijdj:"Rempl",pamhglogfolfbmlpnenhpeholpnlcclo:"JsonDiscovery",jlmafbaeoofdegohdhinkhilhclaklkp:"OctoLinker",dhdgffkkebhmkfjojejmpbldmpobfkfo:"Tampermonkey"},tr={"https://jsr.io":{cdn:"jsr",endpoints:oe({registry:"jsr",pattern:"[atpkg][/version][path]"})},"https://npm.jsr.io":{cdn:"jsr",endpoints:oe("npm")},"https://deno.land":{cdn:"denoland",endpoints:oe({registry:"denoland",pattern:"(?<pkg>std)[version][path]"},{registry:"denoland",pattern:"x/[specifier]"})},"https://esm.sh":{cdn:"esmsh",endpoints:oe({registry:"github",pattern:"v\\d+/gh/[pkg][version][path]"},{registry:"npm",pattern:"v\\d+/[specifier]"})},"https://cdn.jsdelivr.net":{cdn:"jsdelivr",endpoints:oe({registry:"npm",pattern:"npm/[specifier]"},{registry:"github",pattern:"gh/[pkg][version][path]"})},"https://unpkg.com":{cdn:"unpkg",endpoints:oe("npm")},"https://esm.run":{cdn:"jsdelivr",endpoints:oe("npm")},"https://ga.jspm.io":{cdn:"jspm",endpoints:oe({registry:"npm",pattern:"npm:[specifier]"})},"https://cdn.skypack.dev":{cdn:"skypack",endpoints:oe({registry:"npm",pattern:"-/[pkg][version]-[^\\/\\-]+?/[^\\/]+?,mode=(?<path>.+)"},"npm")}},pt=["alive","short-lived","long-lived"];var Ae={"object-shape":"#ffffffa0",object:"#fee29ca0",array:"#ffee61a0",string:"#78b362a0","concat-string":"#78b362a0","sliced-string":"#78b362a0",script:"#fee29ca0",npm:"#f98e94a0",github:"#666666a0",jsr:"#ffee61a0",denoland:"#ffffffa0",wasm:"#9481ffa0",regexp:"#8db2f8a0",electron:"#9feaf9a0",deno:"#ffffffa0",node:"#78b362a0",internals:"#fcb69aa0",program:"#edfdd1a0",devtools:"#90d7f3a0","chrome-extension":"#7dfacda0","webpack/runtime":"#888888a0",gc:"#f1b6fda0",compilation:"#fc9a9aa0",blocking:"#f2a376a0",root:"#444444a0",idle:"#888888a0",unknown:"#888888a0",Unknown:"#888888a0",Ignition:"#b9b9b9a0",Sparkplug:"#e3c685a0",Maglev:"#dba543a0",Turboprop:"#dba543a0",Turbofan:"#f78080a0","heap-number":"#65b4fda0",bigint:"#65b4fda0",closure:"#f2a376a0",code:"#fc9a9aa0",symbol:"#ffee61a0","wasm-object":"#9481ffa0",native:"#fcb69aa0",synthetic:"#fcb69aa0",hidden:"#888888a0","short-lived":"#fee29ca0","long-lived":"#f2a376a0",alive:"#78b362a0",new_space:"#fee29ca0",old_space:"#f2a376a0",code_space:"#fc9a9aa0",code_lo_space:"#fc9a9aa0",new_lo_space:"#fee29ca0",lo_space:"#f2a376a0",shared_space:"#fcb69aa0",shared_lo_space:"#fcb69aa0",read_only_space:"#fee29ca0"},rr=Object.fromEntries(Object.entries(Ae).map(([t,e])=>[t,[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]])),lo=Object.fromEntries(Object.keys(Ae).map((t,e)=>[t,e+1]));function nr(t){switch(t){case"Builtin":case"Ignition":case"Unopt":return"Ignition";case"Baseline":case"Sparkplug":return"Sparkplug";case"Maglev":return"Maglev";case"Turboprop":return"Turboprop";case"Opt":case"Turbofan":return"Turbofan";default:return"Unknown"}}function co(t,e,r=null){let n=Array.from(new Set(r),(o,i)=>({function:i,codes:[]})),s=r!==null?o=>r[o]:o=>o;for(let o of e){let i=o.func;if(typeof i=="number"){let a=o.source||null;n[s(i)].codes.push({tm:o.tm||0,tier:nr(o.kind),size:o.size||0,positions:a?.positions||"",inlined:a?.inlined||"",fns:a?.fns?.map(s)||[],deopt:o.deopt})}}return n}function De(t){let e=[],r=!1,n=0;for(let s=1;s<t.length;s++){let o=t.charCodeAt(s);switch(o){case 67:case 70:r?e.push(n):e.push(n,-1),r=!1,n=0;break;case 79:e.push(n),n=0;break;case 73:e.push(n),r=!0,n=0;break;default:n=n*10+(o-48)}}return r?e.push(n):e.push(n,-1),e}function uo(t,e){let r=0,n=(t.length/3|0)-1;for(;r<=n;){let s=r+n>>1,o=s*3,i=t[o];if(i===e)return o;i<e?r=s+1:n=s-1}return n===-1?0:n*3}function ja(t){return t.map(e=>{let r=e.func,n=e.source;if(r===void 0||n===void 0)return null;let s=n.positions;if(!s)return null;let o=nr(e.kind)!=="Ignition",i=De(s),a=i[i.length-3],l=n.inlined?De(n.inlined):null;if(l!==null)for(let c=0;c<l.length;c+=3){let p=n.fns[l[c]];if(p===null||p<0)return console.error("Broken positions",e,{positions:i,inlined:l}),null;l[c]=p}return{fistCode:i[0],lastCode:a,pcOnNextInstruction:o,positions:i,inlined:l}})}function po(t,e,r){let n=ja(t);for(let s of n)if(!(s===null||!s.inlined))for(let o=0;o<s.inlined.length;o+=3){let i=r[e[s.inlined[o]].codes[0]];if(typeof i!="number")throw new Error("Can't resolve call frame for an inlined function");s.inlined[o]=i}return n}function or(t,e){return String(t).padStart(e,"0")}function sr(t,e,r=!1){t=Math.round(t);let n=Math.floor(t/(60*1e3*1e3)),s=Math.floor(t/(1e3*1e3))%60,o=Math.floor(t/1e3)%1e3;switch(!0){case e<1e5:return`${(t/1e3).toFixed(1)}ms`;case e<1e6:return`${Math.floor(t/1e3)}ms`;case e<6e7:{let i=`${s}.${or(o,3)}s`;return r?i:i.replace(/(\.000|0+)s/,"s")}default:{let i=`${n}:${or(s,2)}.${or(o,3)}`;return r?i:i.replace(/(\.000|0+)$/,"")}}}function Be(t,e,r,n){let s=new Int32Array(t.length).fill(-1),o=new Int32Array(e.length).fill(-1),{firstChild:i,nextSibling:a}=mo(t),{nodes:l,parent:c}=ho(i,a);for(let p=0;p<e.length;p++){let u=e[p];u!==-1&&(s[u]=p)}for(let p=0;p<t.length;p++){let u=s[l[p]];u!==-1&&(o[u]=p),l[p]=r[l[p]]}return{dictionary:n,sourceIdToNode:o,parent:c,nodes:l}}function mo(t,e=new Uint32Array(t.length),r=new Uint32Array(t.length)){for(let n=t.length-1;n>0;n--){let s=t[n];r[n]=e[s],e[s]=n}return{firstChild:e,nextSibling:r}}function Va(t,e,r,n=new Uint32Array(t.length)){let s=new Uint32Array(r);s[t[0]]=t.length+1;for(let o=1;o<t.length;o++)s[t[o]]>=o?n[o]=1:s[t[o]]=o+e[o];return n}function qa(t,e=new Uint32Array(t.length)){for(let r=t.length-1;r>0;r--)e[t[r]]+=e[r]+1;return e}function ho(t,e,r=new Uint32Array(t.length),n=new Uint32Array(t.length)){let s=0,o=0;do{let i=t[s],a=e[s],l=o++;if(r[l]=s,i!==0)s=i,n[o]=l;else if(a!==0)s=a,n[o]=n[l];else for(s=0;l=n[l];)if(a=e[r[l]]){n[o]=n[l],s=a;break}}while(s!==0);return{nodes:r,parent:n}}function za(t,e,r,n){let s=new Uint32Array(t.length);for(let o=0;o<t.length;o++)s[r[t[o]]]=o,t[o]=n[e[t[o]]];for(let o=0;o<r.length;o++)r[o]=s[r[o]]}function $a(t,e,r,n,s,o,i){let a=new Uint32Array(s),l=new Uint32Array(s),c=new Uint32Array(s),p=new Uint32Array(s);return ho(o,i,a,l),za(a,e,r,n),qa(l,c),Va(a,c,t,p),{nodes:a,parent:l,subtreeSize:c,nested:p}}function Ha(t,e,r,n,s,o){let i=new Uint32Array(t),a=new Uint32Array(t),l=new Uint32Array(t),c=1;for(let p=0;p<s.length;p++){let u=p,f=n[e[u]],m=u;for(let d=s[p];d!==0;){let g=n[e[d]];if(g===f){let A=s[d],h=o[d];if(r[d]=r[u],m===u?s[m]=A||h:o[m]=A||h,A){if(h){let y=A;for(;o[y]!==0;)y=o[y];o[y]=h}s[d]=0,d=A;continue}}else if(i[g]===u+1){let A=s[d],h=a[g];if(r[d]=r[h],o[m]=o[d],A){if(s[h]!==0){let T=l[g];for(;o[T]!==0;)T=o[T];o[T]=A,l[g]=T}else s[h]=A,l[g]=A;s[d]=0}}else i[g]=u+1,a[g]=d,l[g]=s[d],r[d]=c++,m=d;d=o[d]}}return c}var fo=t=>t;function Ga(t,e=fo,r){if(typeof e!="function")return{dictionary:r,sourceDictionaryMap:e};if(e===fo)return{dictionary:t,sourceDictionaryMap:Uint32Array.from(t,(o,i)=>i)};let n=new Map(r?r.map((o,i)=>[o,i]):void 0),s=Uint32Array.from(t,o=>{let i=e(o),a=n.get(i);return a===void 0&&n.set(i,a=n.size),a});return{dictionary:[...n.keys()],sourceDictionaryMap:s}}function go(t,e,r){let n=Date.now(),s=t.nodes,o=new Uint32Array(s.length),{firstChild:i,nextSibling:a}=mo(t.parent),l=Date.now(),c=t.dictionary,{dictionary:p,sourceDictionaryMap:u}=Ga(c,e,r),f=Date.now(),m=Ha(p.length,s,o,u,i,a),d=Date.now(),{nodes:g,parent:A,subtreeSize:h,nested:y}=$a(p.length,s,o,u,m,i,a);return{sourceNodeMap:o,sourceDictionaryMap:u,dictionary:p,nodes:g,parent:A,subtreeSize:h,nested:y,timings:{fcns:l-n,dict:f-l,rollup:d-f,finalize:Date.now()-d}}}function Te(t,e,r,n){let s=Date.now(),{sourceNodeMap:o,dictionary:i,nodes:a,parent:l,subtreeSize:c,nested:p,timings:u}=go(e,r,n),f=Date.now(),m=new be(i,new Int32Array(o.buffer),a,l,c,p);return ue&&console.info(`---> buildTree(${t||""})`,u.fcns,"(fc/ns) +",u.dict,"(dict) +",u.rollup,"(rollup) +",u.finalize,"(finalize) +",Date.now()-f,"(create tree) =",Date.now()-s,"ms"),m}function Wa(t,e,r,n){let s=Date.now(),o=Be(t,e.slice(),r,n);return ue&&console.log("buildTreeSource()",Date.now()-s),o}function yo(t,e,r,n,s=null,o=t){let i=Wa(e,r,n,t.callFrames),a=s!==null?Te("callFramePositions",s):null,l=a!==null?Te("callFrames",a,f=>f.callFrame,o.callFrames):Te("callFrames",i),c=Te("modules",l,t.callFrameToModule,o.modules),p=Te("packages",c,t.moduleToPackage,o.packages),u=Te("categories",p,t.packageToCategory,o.categories);return{treeSource:i,callFramePositionsTree:a,callFramesTree:l,modulesTree:c,packagesTree:p,categoriesTree:u}}var ir=new Uint32Array;function Ya(t,e){let{dictionary:r}=t,n=typeof e=="function"?e:o=>o===e,s=new Uint8Array(r.length);for(let o=0;o<s.length;o++)n(r[o])&&(s[o]=1);return s}var be=class{dictionary;sourceIdToNode;sampleIdToNode;#e;sampleIdToNodeChanged;nodes;parent;subtreeSize;nested;entryNodes;entryNodesOffset;entryNodesCount;root;#t;#r;constructor(e,r,n,s,o,i){this.dictionary=e,this.sourceIdToNode=r,this.sampleIdToNode=ir,this.#e=ir,this.sampleIdToNodeChanged=!1,this.nodes=n,this.parent=s||new Uint32Array(n.length),this.subtreeSize=o||new Uint32Array(n.length),this.nested=i||new Uint32Array(n.length),this.#t=new Map,this.#r=new Map,Object.defineProperty(this,"root",{enumerable:!0,get:()=>this.getEntry(0)}),Object.defineProperties(this,{entryNodes:{enumerable:!0,configurable:!0,get:()=>this.#n().entryNodes},entryNodesOffset:{enumerable:!0,configurable:!0,get:()=>this.#n().entryNodesOffset},entryNodesCount:{enumerable:!0,configurable:!0,get:()=>this.#n().entryNodesCount}})}#n(){let{nodes:e,dictionary:r}=this,n=new Uint32Array(e.length),s=new Uint32Array(r.length),o=new Uint32Array(r.length);for(let i=0;i<e.length;i++)o[e[i]]++;for(let i=0,a=0;i<o.length;i++)s[i]=a,a+=o[i];for(let i=0;i<n.length;i++)n[s[e[i]]++]=i;for(let i=0;i<o.length;i++)s[i]-=o[i];return Object.defineProperties(this,{entryNodes:{value:n},entryNodesOffset:{value:s},entryNodesCount:{value:o}}),this}createEntry(e){let r={nodeIndex:e,value:this.dictionary[this.nodes[e]],parent:null,subtreeSize:this.subtreeSize[e]};return e!==0&&Object.defineProperty(r,"parent",{enumerable:!0,get:()=>this.getEntry(this.parent[e])}),this.subtreeSize[e]&&Object.defineProperty(r,"children",{enumerable:!0,get:()=>this.getChildren(e)}),r}getEntry(e){let r=this.#t.get(e),n;return(r===void 0||(n=r.deref())===void 0)&&this.#t.set(e,new WeakRef(n=this.createEntry(e))),n}getChildren(e){let r=this.#r.get(e),n;return(r===void 0||(n=r.deref())===void 0)&&this.#r.set(e,new WeakRef(n=[...this.map(this.children(e))])),n}getValueSubtreesSize(e,r=!0){let{dictionary:n,nodes:s,subtreeSize:o}=this,i=0,a=0;typeof e!="number"&&(e=n.indexOf(e));for(let l=0;l<s.length;l++)if(s[l]===e){let c=o[l];i+=c,a++,l+=c}return r?i+a:i}setSamplesConvolutionRule(e,{treeSamplesCount:r,dictSamplesCount:n,profilePresence:s}){let{parent:o,nodes:i,sampleIdToNode:a}=this,l=i.slice(),c=this.#e,p=u=>({entry:this.dictionary[i[u]],treeSamplesCount:r[u],dictSamplesCount:n[u],profilePresence:s[i[u]]});for(let u=1;u<l.length;u++){let f=o[u],m=l[f],d=p(u),g=p(f),A=m===f?g:p(m);l[u]=e(d,g,A)===!0?m:u}c===ir&&(this.#e=c=a.slice());for(let u=0;u<a.length;u++)a[u]=l[c[u]];this.sampleIdToNodeChanged=!0}*map(e){for(let r of e)yield this.getEntry(r)}*selectNodes(e,r=!1){let{dictionary:n,nested:s,entryNodes:o,entryNodesOffset:i,entryNodesCount:a}=this;typeof e!="number"&&(e=n.indexOf(e));let l=i[e],c=l+a[e];for(let p=l;p<c;p++){let u=o[p];(r||s[u]===0)&&(yield u)}}*selectBy(e,r=!1){let{nodes:n,nested:s}=this,o=Ya(this,e),i=[];for(let a=0;a<n.length;a++)o[n[a]]&&(r||s[a]===0)&&(yield a);return i}*ancestors(e,r=1/0){let{parent:n}=this,s=n[e];for(;s!==e&&(yield s,!(--r<=0));)e=s,s=n[e]}*children(e){let{subtreeSize:r}=this,n=e+r[e];for(;e<n;)yield++e,e+=r[e]}*subtree(e){let r=e+this.subtreeSize[e];for(;e<r;)yield++e}};var Ao="AGFzbQEAAAABEQJgBH9/f38AYAZ/f39/f38AAhMBB2ltcG9ydHMGbWVtb3J5AgAAAwUEAAAAAQdbBBVhY2N1bXVsYXRlU2FtcGxlQ291bnQAABFhY2N1bXVsYXRlVGltaW5ncwABEXJvbGx1cFRyZWVUaW1pbmdzAAIXcm9sbHVwRGljdGlvbmFyeVRpbWluZ3MAAwrIAgRHAQJ/IABBAnQhBAJAA0AgBEUNASAEQQRrIQQgASAEaigCAEUNACADIAIgBGooAgBBAnRqIQUgBSAFKAIAQQFqNgIADAALCwtJAQN/IABBAnQhBAJAA0AgBEUNASAEQQRrIQQgASAEaigCACIFRQ0AIAMgAiAEaigCAEECdGohBiAGIAYoAgAgBWo2AgAMAAsLC1QBA38gAUECdCEEAkADQCAEQQRMDQEgBEEEayEEIAIgBGooAgAgAyAEaigCAGoiBUUNACADIAAgBGooAgBBAnRqIQYgBiAGKAIAIAVqNgIADAALCwtfAQR/IABBAnQhBgJAA0AgBkUNASAGQQRrIQYgASAGaigCAEECdCEHIAIgB2ooAgAgAyAHaigCAGoiCEUNACAFIAQgBmooAgBBAnRqIQkgCSAJKAIAIAhqNgIADAALCws=";function Ka(t,e={}){let r=to(t),n={imports:e},s=new WebAssembly.Module(r);return new WebAssembly.Instance(s,n)}function To(t){let e=Ka(Ao,{memory:t}),{accumulateSampleCount:r,accumulateTimings:n,rollupTreeTimings:s,rollupDictionaryTimings:o}=e.exports;return{computeTimings(i,a=!0){a&&(i.samplesCount.fill(0),i.samplesTimes.fill(0)),r(i.timeDeltas.length,i.timeDeltas.byteOffset,i.samples.byteOffset,i.samplesCount.byteOffset),n(i.timeDeltas.length,i.timeDeltas.byteOffset,i.samples.byteOffset,i.samplesTimes.byteOffset)},computeTreeTimings(i,a=!0){a&&(i.samplesCount.fill(0),i.selfTimes.fill(0),i.nestedTimes.fill(0)),n(i.sourceSamplesCount.length,i.sourceSamplesCount.byteOffset,i.sampleIdToNode.byteOffset,i.samplesCount.byteOffset),n(i.sourceSamplesTimes.length,i.sourceSamplesTimes.byteOffset,i.sampleIdToNode.byteOffset,i.selfTimes.byteOffset),s(i.parent.byteOffset,i.selfTimes.length,i.selfTimes.byteOffset,i.nestedTimes.byteOffset)},computeDictionaryTimings(i,a=!0){a&&(i.samplesCount.fill(0),i.selfTimes.fill(0),i.totalTimes.fill(0)),n(i.sourceSamplesCount.length,i.sourceSamplesCount.byteOffset,i.sampleIdToDict.byteOffset,i.samplesCount.byteOffset),n(i.sourceSamplesTimes.length,i.sourceSamplesTimes.byteOffset,i.sampleIdToDict.byteOffset,i.selfTimes.byteOffset),o(i.totalNodes.length,i.totalNodes.byteOffset,i.nodeSelfTimes.byteOffset,i.nodeNestedTimes.byteOffset,i.totalNodeToDict.byteOffset,i.totalTimes.byteOffset)}}}function bo(){function t(e,r,n){for(let s=r.length-1;s>=0;s--)e[n[s]]+=r[s]}return{computeTimings(e,r=!0){let{samples:n,timeDeltas:s,samplesCount:o,samplesTimes:i}=e,a=n.length;r&&(o.fill(0),i.fill(0)),t(i,s,n);for(let l=a-1;l>=0;l--)s[l]!==0&&o[n[l]]++},computeTreeTimings(e,r=!0){let{sourceSamplesCount:n,sourceSamplesTimes:s,sampleIdToNode:o,parent:i,samplesCount:a,selfTimes:l,nestedTimes:c}=e,p=i.length;r&&(a.fill(0),l.fill(0),c.fill(0)),t(a,n,o),t(l,s,o);for(let u=p-1;u>0;u--)c[i[u]]+=l[u]+c[u]},computeDictionaryTimings(e,r=!0){let{sourceSamplesCount:n,sourceSamplesTimes:s,nodeSelfTimes:o,nodeNestedTimes:i,sampleIdToDict:a,totalNodes:l,totalNodeToDict:c,samplesCount:p,selfTimes:u,totalTimes:f}=e,m=l.length;r&&(p.fill(0),u.fill(0),f.fill(0)),t(p,n,a),t(u,s,a);for(let d=m-1;d>=0;d--){let g=l[d],A=o[g],h=i[g];f[c[d]]+=A+h}}}}var Eo=bo(),{computeTreeTimings:Ld}=Eo;function Co(t,e){let r=0,n=t.length-1;for(;r<=n;){let s=r+n>>1,o=t[s];if(o===e)return s;o<e?r=s+1:n=s-1}return n===-1?0:n}function Xa(t,e){for(let r=1;r<t.length;r++)t[r]=e[r-1]+t[r-1]}function So(t,e,r=!0){t.computeTimings(e.samples,r);for(let n of e.tree)t.computeTreeTimings(n,r);for(let n of e.dict)t.computeDictionaryTimings(n,r)}var ve=class{#e=[];subscribe(e){let r={fn:e};return this.#e.push(r),()=>{r!==null&&(this.#e=this.#e.filter(n=>n!==r),r=null)}}notify(){for(let{fn:e}of this.#e)e()}},ft=class extends ve{samples;timeDeltas;timestamps;samplesCount;samplesTimes;constructor(e,r,n,s,o){super(),this.samples=e,this.timeDeltas=r,this.timestamps=n,this.samplesCount=s,this.samplesTimes=o}},ar=class extends ft{samplesMask;originalTimeDeltas;rangeStart=null;rangeEnd=null;rangeSamples=null;constructor(e,r,n,s,o,i){super(e,n,s,o,i),this.samplesMask=r,this.originalTimeDeltas=n}resetRange(){this.rangeStart=null,this.rangeEnd=null,this.rangeSamples=null,this.timeDeltas!==this.originalTimeDeltas&&(this.timeDeltas.set(this.originalTimeDeltas),this.originalTimeDeltas=this.timeDeltas)}setRange(e,r){let{timeDeltas:n,timestamps:s}=this,{originalTimeDeltas:o}=this;n===o&&(this.originalTimeDeltas=o=n.slice()),n.fill(0);let i=Co(s,e),a=Co(s,r);this.rangeStart=e,this.rangeEnd=r,this.rangeSamples=a-i+1,i!==a?(n[i]=o[i]-(e-s[i]),n[a]=r-s[a],i+1<a&&n.set(o.subarray(i+1,a),i+1)):n[i]=r-e}},Ce=class extends ve{tree;samplesCount;selfTimes;nestedTimes;constructor(e,r,n,s){super(),this.tree=e,this.samplesCount=r,this.selfTimes=n,this.nestedTimes=s}getTimings(e){let r=this.samplesCount[e],n=this.selfTimes[e],s=this.nestedTimes[e];return{node:this.tree.getEntry(e),samples:r,selfTime:n,nestedTime:s,totalTime:n+s}}getValueTimings(e){let{tree:r,samplesCount:n,selfTimes:s,nestedTimes:o}=this,{nested:i}=r,a=0,l=0,c=0;for(let p of r.selectNodes(e,!0))a+=n[p],l+=s[p],i[p]===0&&(c+=o[p]);return{value:r.dictionary[e],samples:a,selfTime:l,nestedTime:c,totalTime:l+c}}};var mt=class extends ve{entries;entriesMap;samplesCount;selfTimes;totalTimes;constructor(e,r,n,s){super(),this.samplesCount=r,this.selfTimes=n,this.totalTimes=s,this.entries=e.map((o,i)=>({entryIndex:i,entry:o,samples:r[i],selfTime:n[i],nestedTime:s[i]-n[i],totalTime:s[i]})),this.entriesMap=this.entries.reduce((o,i)=>o.set(i.entry,i),new Map)}getEntry(e){return this.entriesMap.get(e)||null}sync(){let{entries:e,samplesCount:r,selfTimes:n,totalTimes:s}=this;for(let o=0;o<e.length;o++){let i=e[o],a=n[o],l=s[o];i.samples=r[o],i.selfTime=a,i.nestedTime=l-a,i.totalTime=l}}},lr=class{entries;entriesMap;firstSeen;lastSeen;constructor(e,r,n){let{dictionary:s,nodes:o,parent:i,sampleIdToNode:a}=e,l=new Uint32Array(o.length).fill(4294967295),c=new Uint32Array(o.length),p=new Uint32Array(s.length).fill(4294967295),u=new Uint32Array(s.length);for(let f=0;f<n.length;f++){let m=a[n[f]],d=r[f];l[m]>d&&(l[m]=d),c[m]<d&&(c[m]=d)}for(let f=o.length-1;f>0;f--){let m=i[f],d=o[f],g=l[f],A=c[f];l[m]>g&&(l[m]=g),p[d]>g&&(p[d]=g),c[m]<A&&(c[m]=A),u[d]<A&&(u[d]=A)}this.firstSeen=l,this.lastSeen=c,this.entries=s.map((f,m)=>({entryIndex:m,entry:f,firstSeen:p[m],lastSeen:u[m]})),this.entriesMap=this.entries.reduce((f,m)=>f.set(m.entry,m),new Map)}};function Za(t){let{nodes:e,nested:r,sampleIdToNode:n}=t,s=new Uint32Array(e.length),o=new Uint32Array(e.length),i=0;for(let a=0;a<e.length;a++)r[a]===0&&(o[i]=e[a],s[i]=a,i++);return{tree:t,sampleIdToDict:n.map(a=>e[a]),totalNodes:s.slice(0,i),totalNodeToDict:o.slice(0,i)}}function Qa(t,e,r,n=!0){let s=r.map(Za),o=r[0].sampleIdToNode.length,i=2*e.length+t.length+3*o;for(let{tree:d,sampleIdToDict:g,totalNodes:A,totalNodeToDict:h}of s)i+=d.sampleIdToNode.length+d.parent.length+3*d.nodes.length,i+=g.length+A.length+h.length+3*d.dictionary.length;let a=n?new WebAssembly.Memory({initial:Math.ceil(4*i/65535)}):new Uint8Array(4*i),l=a?new Uint32Array(a.buffer):null,c=0,p={timeDeltas:f(e),timestamps:m(e.length),samples:f(t),samplesMask:m(o),samplesCount:m(o),samplesTimes:m(o)},u={memory:a,samples:p,tree:[],dict:[]};Xa(p.timestamps,p.timeDeltas);for(let{tree:d,sampleIdToDict:g,totalNodes:A,totalNodeToDict:h}of s){let y={tree:d,sourceSamplesCount:p.samplesCount,sourceSamplesTimes:p.samplesTimes,sampleIdToNode:d.sampleIdToNode=f(d.sampleIdToNode),parent:f(d.parent),samplesCount:m(d.nodes.length),selfTimes:m(d.nodes.length),nestedTimes:m(d.nodes.length)},T={dictionary:d.dictionary,sourceSamplesCount:p.samplesCount,sourceSamplesTimes:p.samplesTimes,nodeSelfTimes:y.selfTimes,nodeNestedTimes:y.nestedTimes,sampleIdToDict:f(g),totalNodes:f(A),totalNodeToDict:f(h),samplesCount:m(d.dictionary.length),selfTimes:m(d.dictionary.length),totalTimes:m(d.dictionary.length)};u.tree.push(y),u.dict.push(T)}return u;function f(d){return l===null?d:(l.set(d,c),l.subarray(c,c+=d.length))}function m(d){return l===null?new Uint32Array(d):l.subarray(c,c+=d)}}function ko(t,e,r){let n=no,s=Qa(t,e,r,n),{memory:o,samples:i,tree:a,dict:l}=s,c=n&&o?To(o):Eo;So(c,s,!1);let p=new ft(t,e,i.timestamps,i.samplesCount.slice(),i.samplesTimes.slice()),u=new ar(i.samples,i.samplesMask,i.timeDeltas,i.timestamps,i.samplesCount,i.samplesTimes),f=a.map(b=>new Ce(b.tree,b.samplesCount.slice(),b.selfTimes.slice(),b.nestedTimes.slice())),m=a.map(b=>new Ce(b.tree,b.samplesCount,b.selfTimes,b.nestedTimes)),d=l.map(b=>new mt(b.dictionary,b.samplesCount.slice(),b.selfTimes.slice(),b.totalTimes.slice())),g=l.map(b=>new mt(b.dictionary,b.samplesCount,b.selfTimes,b.totalTimes)),A=a.map(b=>new lr(b.tree,i.timestamps,i.samples)),{setRange:h,resetRange:y}=u,T=[u,...m,...g],C=()=>{for(let b=0;b<l.length;b++){let{sampleIdToNode:E,tree:{nodes:S,sampleIdToNodeChanged:k}}=a[b],{sampleIdToDict:w}=l[b];if(k){for(let F=0;F<E.length;F++)w[F]=S[E[F]];a[b].tree.sampleIdToNodeChanged=!1}}So(c,s),g.forEach(b=>b.sync()),T.forEach(b=>b.notify())};return u.setRange=function(...b){h.call(this,...b),C()},u.resetRange=function(...b){y.call(this,...b),C()},{recomputeTimings:C,samplesTimings:p,samplesTimingsFiltered:u,treeTimings:f,treeTimestamps:A,treeTimingsFiltered:m,dictionaryTimings:d,dictionaryTimingsFiltered:g}}var el=new Map,tl=new Map,rl={Ignition:"Ig",Sparkplug:"Sp",Maglev:"Ml",Turboprop:"Tp",Turbofan:"Tf",Turboshaft:"Ts",Unknown:"??"};function wo(t,e,r=1e3){let n=0;for(;t>r&&n<e.length-1;)t/=r,n++;return(n===0?t:t<100?t.toFixed(1).replace(/\.0/,""):Math.round(t))+e[n]}function nl(t,e){let{dictionary:r}=t,n=typeof e=="function"?e:o=>o===e,s=new Uint8Array(r.length);for(let o=0;o<s.length;o++)n(r[o])&&(s[o]=1);return s}function xo(t,e){let{dictionary:r,sampleIdToNode:n,nodes:s}=t,o=typeof e=="function"?e:a=>a===e,i=new Uint8Array(n.length);for(let a=0;a<i.length;a++){let l=n[a];o(r[s[l]],a)&&(i[a]=1)}return i}function _o(t,e,r,n,s){let o=new Float64Array(t),i=s/t,a=i,l=0;for(let c=0,p=0;c<r.length;c++){let u=e[r[c]],f=n[c];if(p+f<a)u&&(o[l]+=f);else{if(u){let m=a-p,d=f-m,g=1;for(;d>i;)o[l+g]=i,g++,d-=i;o[l]+=m,o[l+g]=d}for(;p+f>a;)l+=1,a+=i}p+=f}return o}function ol(t,e,r,n){let s=new Uint32Array(t),o=n/t,i=o,a=0;for(let l=0,c=0;l<e.length;l++){let p=r[l];if(c+p<i)s[a]++;else{let u=i-c,f=p-u,m=1;for(;f>o;)s[a+m]++,m++,f-=o;for(s[a]++,s[a+m]++;c+p>i;)a+=1,i+=o}c+=p}return Array.from(s)}var sl={hasSource:`
        callFrame
            | $ or @
            | is object and marker('call-frame').object
            ? regexp is string or (script.source is string and (end - start) > 0)
            : (script
                | $ or @
                | is object and marker('script').object
                | source is string and source.size() > 0)
    `,order(t){return lo[t]||100},color(t,e){let r=e?rr:Ae;return r[t]||r.unknown},colorRand(t,e){let r=e?rr:Ae,n=e?el:tl;if(!n.has(t)){let s=Object.keys(r);n.set(t,r[s[Math.floor(Math.random()*s.length)]])}return n.get(t)},abbr(t){return rl[t]||t},hotness(t){return ut[t]||"unknown"},toFixed(t,e=2){return Number(t).toFixed(e)},percent(t,e=2){return(100*t).toFixed(e)+"%"},totalPercent(t,e=2){let r=(this.context.context||this.context)?.data?.totalTime,n=100*t/r,s=1/Math.pow(10,e||1);return n>=s?n.toFixed(e||1)+"%":n!==0?"<"+s+"%":"0%"},duration(t){let e=(this.context.context||this.context)?.data?.totalTime,r=100*t/e;return(t/1e3).toFixed(1)+"ms"+(r>=.01?" / "+r.toFixed(2)+"%":"")},ms(t){return(t/1e3).toFixed(1)+"ms"},kb(t){return(t/1e3).toFixed(1)+"Kb"},unit(t,e=this.context.currentProfile?.type){return(t/1e3).toFixed(1)+(e==="memory"?"Kb":"ms")},bytes(t,e="b",r=1e3){return wo(t,[e||"","Kb","Mb","Gb"],r)},shortNum(t){return wo(t,["","K","M","G"])},formatMicrosecondsTime:sr,formatMicrosecondsTimeFixed(t,e){return sr(t,e,!0)},zip(t,e=s=>s,r,n=s=>s){let s=new Map(t.map(o=>[e(o),{left:o,right:null}]));for(let o of r){let i=s.get(n(o));i!==void 0&&(i.right=o)}return[...s.values()]},tree(t,e,r=n=>n){let n=t.map(o=>({parent:null,value:o,children:[]})),s={value:null,children:[]};for(let o of n){let i=e(o.value),a=Number.isInteger(i)&&i>=0&&i<n.length?n[i]:s;a.children.push(o),o.parent=a!==s?a:null,o.value=r(o.value)}return s.children},parsePositions(t,e=0){if(typeof t!="string"||t==="")return[];let r=De(String(t)),n=[],s=null;for(let o=0;o<r.length;o+=3){let i=r[o],a=r[o+1],l=r[o+2];s!==null&&(s.size=i-s.code),n.push(s={index:n.length,code:i,offset:a,inline:l!==-1?l:void 0,size:-1})}return e>0&&s!==null&&(s.size=Math.max(e-s.code,-1)),n},parseInlined(t,e){if(typeof t!="string"||t==="")return[];let r=De(String(t)),n=[];for(let s=0;s<r.length;s+=3){let o=r[s],i=r[s+1],a=r[s+2],l={index:n.length,fn:o,offset:i,parent:a!==-1?a:void 0};n.push(l),Array.isArray(e)&&(l.callFrame=e[o]||null)}return n},inlinedPath(t,e,r){let n={callFrame:e,offset:-1,parent:null},s=[n];for(let{callFrame:o,offset:i}of t)n.offset=i,n={callFrame:o,offset:-1,parent:n},s.push(n);return n.offset=r,s},inlinedMatrix(t=[]){let e=new Map,r=[],n=[];for(let i=0;i<t.length;i++){let a=t[i],l=this.method("parseInlined",a.inlined),c=[];for(let p of l){let u=a.fns[p.fn],f=p.parent===void 0?null:c[p.parent],m=f!==null?`${p.offset}-${u.id}-${f.id}`:`${p.offset}-${u.id}`,d=e.get(m);d===void 0&&(e.set(m,d={id:e.size,value:{offset:p.offset,callFrame:u,code:a},parent:f,children:[],codePresence:Array.from(t,()=>0)}),f!==null?f.children.push(d):r.push(d)),d.codePresence[i]=1,c.push(d)}}for(let i of s(r)){let a=[];o(i,u=>{a.push(u),s(u.children)});let l=[],c=a.length,p=0;for(let u=0;u<t.length;u++){let f=Array.from(a,g=>g.codePresence[u]),m=f.join(""),d=this.method("sum",f);d!==0&&d<c&&(c=d),d>p&&(p=d),l.push({hash:m,presence:f,code:t[u]})}n.push({offset:i.value.offset,tree:i,linear:a.map(u=>u.value),min:c,max:p,snapshots:l})}return n;function s(i){return i.length>1&&i.sort((a,l)=>a.value.offset-l.value.offset),i}function o(i,a){a(i);for(let l of i.children)o(l,a)}},offsetToLineColumn(t,e,r){let n=0,s=0,o=0;if(e&&!r&&typeof e.script?.source=="string"&&Number.isFinite(e.start)&&Number.isFinite(e.line)&&Number.isFinite(e.end)&&(r=e,e=e.script.source),typeof e!="string")return null;t<0?t=0:t>e.length&&(t=e.length),r&&Number.isFinite(r.start)&&r.start>=0&&(n=r.start,s=r.line,o=r.column,r.end>=r.start&&t>r.end&&(t=r.end));let i=/\r\n?|\n/g;for(i.lastIndex=n;i.exec(e)!==null;){if(i.lastIndex>t){o+=t-n;break}n=i.lastIndex,s++,o=0}return{line:s,column:o}},select(t,e,...r){let n=null;if(t instanceof Ce&&(n=t,t=t.tree),t instanceof be){let s;switch(e){case"nodes":s=typeof r[0]=="function"?t.selectBy(...r):t.selectNodes(...r);break;case"children":s=t.children(...r);break;case"subtree":s=t.subtree(...r);break;case"parent":s=t.ancestors(r[0],1);break;case"ancestors":s=t.ancestors(...r);break}if(s!==void 0){if(n){let o=[];for(let i of t.map(s)){let a=n.selfTimes[i.nodeIndex],l=n.nestedTimes[i.nodeIndex];o.push({node:i,selfTime:a,nestedTime:l,totalTime:a+l})}return o}return[...t.map(s)]}}},subtreeSamples(t,e,r=!1){let n=t.sampleIdToNode,s=new Set(n),o=new Set,i=new Set,a=new Set,l=new Uint8Array(n.length),c=typeof e=="number"?e:t.dictionary.indexOf(e);for(let p of t.selectNodes(e)){r&&s.has(p)&&o.add(p);for(let u of t.subtree(p))s.has(u)&&(r||t.nodes[u]!==c)&&(o.add(u),i.add(t.dictionary[t.nodes[u]]))}for(let p=0;p<n.length;p++)o.has(n[p])&&(l[p]=1,a.add(p));return{entries:[...i],selectedSamples:a,mask:l,sampleSelector:(p,u)=>a.has(u)}},binCallsFromMask(t,e=500,r=this.context.currentProfile){let{samples:n,timeDeltas:s,totalTime:o}=r,i=_o(e,t,n,s,o);return Array.from(i)},getTimings(t,e){return typeof e!="number"&&(e=t.tree.dictionary.indexOf(e)),t.getTimings(e)},getValueTimings(t,e){return t.getValueTimings(e)},getEntry(t,e){if(typeof t?.getEntry=="function")return t.getEntry(e)},nestedTimings(t,e,r){let n=t.tree,s=r||n,o=typeof e=="number"?e:s.dictionary.indexOf(e),i=new Uint32Array(n.dictionary.length),a=s.nodes,l=s.sampleIdToNode,c=new Uint32Array(s.nodes.length),p=new Set,u=[];for(let f of s.selectNodes(o))for(let m of s.subtree(f))a[m]!==o&&(c[m]=1);for(let f=0;f<l.length;f++)if(c[l[f]]){let m=n.sampleIdToNode[f];p.has(m)||(i[n.nodes[m]]+=t.selfTimes[m],p.add(m))}for(let f=0;f<i.length;f++)i[f]>0&&u.push({entry:n.dictionary[f],selfTime:i[f]});return u},selectBy(t,e){let{nodes:r}=t,n=nl(t,e),s=[];for(let o=0;o<r.length;o++)n[r[o]]&&s.push(t.getEntry(o));return s},timestamps(t,e,r=this.context.currentProfile){let n;switch(e){case"call-frame":n=r?.callFramesTreeTimestamps.entriesMap;break;case"module":n=r?.modulesTreeTimestamps.entriesMap;break;case"package":n=r?.packagesTreeTimestamps.entriesMap;break;case"category":n=r?.categoriesTreeTimestamps.entriesMap;break}if(n)return n.get(t)},countSamples(t=500,e=this.context.currentProfile){let{samples:r,timeDeltas:n,totalTime:s}=e;return ol(t,r,n,s)},binCalls(t,e,r=500,n=this.context.currentProfile){let{samples:s,timeDeltas:o,totalTime:i}=n,a=xo(t,e),l=_o(r,a,s,o,i);return Array.from(l)},binHeapEvents(t,e="new",r=500,n=this.context.currentProfile){let{totalTime:s}=n,o=new Float64Array(r),i=s/r,a=i,l=0;for(let c=0;c<t.length;c++){let{tm:p,event:u,size:f}=t[c];if(!(p===0||u!==e)){for(;p>a;)l++,a+=i;o[l]+=f}}return o},binHeapTotal(t,e=500,r=0,n=this.context.currentProfile){let{totalTime:s}=n,o=new Float64Array(e),i=s/e,a=i,l=0,c=r||0,p=c;for(let u=0;u<t.length;u++){let{tm:f,event:m,size:d}=t[u];if(f!==0){for(;f>a;)o[l]=p,p=c,l++,a+=i;c+=m==="new"?d:-d,p=Math.max(c,p)}}return o[l]=p,l<e-1&&o.fill(c,l+1),o},binAllocations(t,e,r,n=500,s=this.context.currentProfile||this.context.data.currentProfile){let{totalTime:o}=s,i=Array.from({length:r.length},()=>new Uint32Array(n)),a=o/n,l=0,c=0;if(e)for(let p=0;p<t.length;p++){let u=i[e[p]],f=t[p];for(;l+f>=a;){let m=a-l;u[c++]+=m,f-=m,l=0}u[c]+=f,l+=f}return i.map((p,u)=>({name:r[u],color:Ae[r[u]],step:a,value:ye(p),total:o,bins:p}))},allocationsMatrix(t,e,r,n=this.context.data.currentProfile){let{_memoryGc:s,_memoryType:o,_memoryTypeNames:i}=n,{samples:a,timeDeltas:l}=e,c=pt.length,p=i.length,u=new Uint32Array(c*p),f=new Uint32Array(c*p),m=new Uint32Array(c*p),d=new Uint32Array(c*p),g=xo(t,r),A=[];for(let h=0;h<a.length;h++)if(g[a[h]]!==0){let y=l[h];if(y!==0){let T=o[h]*c+s[h];u[T]++,f[T]+=y,m[T]=m[T]?Math.min(m[T],y):y,d[T]=Math.max(d[T],y)}}for(let h=0;h<i.length;h++){let y={type:i[h],total:{count:0,sum:0,min:1/0,max:0}};for(let T=0;T<pt.length;T++){let C=h*c+T;u[C]>0&&(y.total.count+=u[C],y.total.sum+=f[C],y.total.min=Math.min(y.total.min,m[C]),y.total.max=Math.max(y.total.max,d[C])),y[pt[T]]={count:u[C],sum:f[C],min:m[C],max:d[C]}}y.total.count&&A.push(y)}return A},binScriptFunctionCodes(t,e=500,r=this.context.currentProfile){let{totalTime:n}=r,s=new Uint32Array(e),o=n/e,i=o,a=0;for(let l=0;l<t.length;l++){let{tm:c}=t[l];for(;c>i;)a++,i+=o;s[a]+=1}return a<e-1&&s.fill(s[a],a+1),s},binScriptFunctionCodesTotal(t,e=500,r=this.context.currentProfile){let{totalTime:n}=r,s=n/e,o=new Map,i=new Map,a=new Uint32Array(e),l=s,c=0;for(let p of ct)o.set(p,new Uint32Array(e));for(let p=0;p<t.length;p++){let{tm:u,tier:f,callFrameCodes:m}=t[p];for(;u>l;){c++,a[c]=a[c-1];for(let g of o.values())g[c]=g[c-1];l+=s}let d=i.get(m);d===void 0?(o.get(f)[c]++,a[c]++):f!==d&&(o.get(d)[c]--,o.get(f)[c]++),i.set(m,f)}if(c<e-1){a.fill(a[c],c+1);for(let p of o.values())p.fill(p[c],c+1)}return{byTier:[...o.entries()],fnCount:a}}},Po=sl;var No={0:"read_only_space",1:"new_space",2:"old_space",3:"code_space",4:"shared_space",5:"new_lo_space",6:"lo_space",7:"code_lo_space",8:"shared_lo_space"},Io={0:"alive",1:"short-lived",2:"long-lived"},Oo={0:"INTERNALIZED_STRING",2:"EXTERNAL_INTERNALIZED_STRING",8:"ONE_BYTE_INTERNALIZED_STRING",10:"EXTERNAL_ONE_BYTE_INTERNALIZED_STRING",18:"UNCACHED_EXTERNAL_INTERNALIZED_STRING",26:"UNCACHED_EXTERNAL_ONE_BYTE_INTERNALIZED_STRING",32:"STRING",33:"CONS_STRING",34:"EXTERNAL_STRING",35:"SLICED_STRING",37:"THIN_STRING",40:"ONE_BYTE_STRING",41:"CONS_ONE_BYTE_STRING",42:"EXTERNAL_ONE_BYTE_STRING",43:"SLICED_ONE_BYTE_STRING",50:"UNCACHED_EXTERNAL_STRING",58:"UNCACHED_EXTERNAL_ONE_BYTE_STRING",96:"SHARED_STRING",98:"SHARED_EXTERNAL_STRING",104:"SHARED_ONE_BYTE_STRING",106:"SHARED_EXTERNAL_ONE_BYTE_STRING",114:"SHARED_UNCACHED_EXTERNAL_STRING",122:"SHARED_UNCACHED_EXTERNAL_ONE_BYTE_STRING",128:"SYMBOL",129:"BIG_INT_BASE",130:"HEAP_NUMBER",131:"ODDBALL",132:"PROMISE_FULFILL_REACTION_JOB_TASK",133:"PROMISE_REJECT_REACTION_JOB_TASK",134:"CALLABLE_TASK",135:"CALLBACK_TASK",136:"PROMISE_RESOLVE_THENABLE_JOB_TASK",137:"LOAD_HANDLER",138:"STORE_HANDLER",139:"FUNCTION_TEMPLATE_INFO",140:"OBJECT_TEMPLATE_INFO",141:"ACCESS_CHECK_INFO",142:"ACCESSOR_PAIR",143:"ALIASED_ARGUMENTS_ENTRY",144:"ALLOCATION_MEMENTO",145:"ALLOCATION_SITE",146:"ARRAY_BOILERPLATE_DESCRIPTION",147:"ASM_WASM_DATA",148:"ASYNC_GENERATOR_REQUEST",149:"BREAK_POINT",150:"BREAK_POINT_INFO",151:"CALL_SITE_INFO",152:"CLASS_POSITIONS",153:"DEBUG_INFO",154:"ENUM_CACHE",155:"ERROR_STACK_DATA",156:"FEEDBACK_CELL",157:"FUNCTION_TEMPLATE_RARE_DATA",158:"INTERCEPTOR_INFO",159:"INTERPRETER_DATA",160:"MODULE_REQUEST",161:"PROMISE_CAPABILITY",162:"PROMISE_ON_STACK",163:"PROMISE_REACTION",164:"PROPERTY_DESCRIPTOR_OBJECT",165:"PROTOTYPE_INFO",166:"REG_EXP_BOILERPLATE_DESCRIPTION",167:"SCRIPT",168:"SCRIPT_OR_MODULE",169:"SOURCE_TEXT_MODULE_INFO_ENTRY",170:"STACK_FRAME_INFO",171:"TEMPLATE_OBJECT_DESCRIPTION",172:"TUPLE2",173:"WASM_EXCEPTION_TAG",174:"WASM_INDIRECT_FUNCTION_TABLE",175:"FIXED_ARRAY",176:"HASH_TABLE",177:"EPHEMERON_HASH_TABLE",178:"GLOBAL_DICTIONARY",179:"NAME_DICTIONARY",180:"NAME_TO_INDEX_HASH_TABLE",181:"NUMBER_DICTIONARY",182:"ORDERED_HASH_MAP",183:"ORDERED_HASH_SET",184:"ORDERED_NAME_DICTIONARY",185:"REGISTERED_SYMBOL_TABLE",186:"SIMPLE_NUMBER_DICTIONARY",187:"CLOSURE_FEEDBACK_CELL_ARRAY",188:"OBJECT_BOILERPLATE_DESCRIPTION",189:"SCRIPT_CONTEXT_TABLE",190:"BYTE_ARRAY",191:"BYTECODE_ARRAY",192:"FIXED_DOUBLE_ARRAY",193:"INTERNAL_CLASS_WITH_SMI_ELEMENTS",194:"SLOPPY_ARGUMENTS_ELEMENTS",195:"TURBOSHAFT_FLOAT64_TYPE",196:"TURBOSHAFT_FLOAT64_RANGE_TYPE",197:"TURBOSHAFT_FLOAT64_SET_TYPE",198:"TURBOSHAFT_WORD32_TYPE",199:"TURBOSHAFT_WORD32_RANGE_TYPE",200:"TURBOSHAFT_WORD32_SET_TYPE",201:"TURBOSHAFT_WORD64_TYPE",202:"TURBOSHAFT_WORD64_RANGE_TYPE",203:"TURBOSHAFT_WORD64_SET_TYPE",204:"FOREIGN",205:"AWAIT_CONTEXT",206:"BLOCK_CONTEXT",207:"CATCH_CONTEXT",208:"DEBUG_EVALUATE_CONTEXT",209:"EVAL_CONTEXT",210:"FUNCTION_CONTEXT",211:"MODULE_CONTEXT",212:"NATIVE_CONTEXT",213:"SCRIPT_CONTEXT",214:"WITH_CONTEXT",215:"TURBOFAN_BITSET_TYPE",216:"TURBOFAN_HEAP_CONSTANT_TYPE",217:"TURBOFAN_OTHER_NUMBER_CONSTANT_TYPE",218:"TURBOFAN_RANGE_TYPE",219:"TURBOFAN_UNION_TYPE",220:"UNCOMPILED_DATA_WITH_PREPARSE_DATA",221:"UNCOMPILED_DATA_WITH_PREPARSE_DATA_AND_JOB",222:"UNCOMPILED_DATA_WITHOUT_PREPARSE_DATA",223:"UNCOMPILED_DATA_WITHOUT_PREPARSE_DATA_WITH_JOB",224:"WASM_FUNCTION_DATA",225:"WASM_CAPI_FUNCTION_DATA",226:"WASM_EXPORTED_FUNCTION_DATA",227:"WASM_JS_FUNCTION_DATA",228:"EXPORTED_SUB_CLASS_BASE",229:"EXPORTED_SUB_CLASS",230:"EXPORTED_SUB_CLASS2",231:"SMALL_ORDERED_HASH_MAP",232:"SMALL_ORDERED_HASH_SET",233:"SMALL_ORDERED_NAME_DICTIONARY",234:"ABSTRACT_INTERNAL_CLASS_SUBCLASS1",235:"ABSTRACT_INTERNAL_CLASS_SUBCLASS2",236:"DESCRIPTOR_ARRAY",237:"STRONG_DESCRIPTOR_ARRAY",238:"SOURCE_TEXT_MODULE",239:"SYNTHETIC_MODULE",240:"WEAK_FIXED_ARRAY",241:"TRANSITION_ARRAY",242:"ACCESSOR_INFO",243:"CALL_HANDLER_INFO",244:"CELL",245:"CODE",246:"COVERAGE_INFO",247:"EMBEDDER_DATA_ARRAY",248:"FEEDBACK_METADATA",249:"FEEDBACK_VECTOR",250:"FILLER",251:"FREE_SPACE",252:"INSTRUCTION_STREAM",253:"INTERNAL_CLASS",254:"INTERNAL_CLASS_WITH_STRUCT_ELEMENTS",255:"MAP",256:"MEGA_DOM_HANDLER",257:"ON_HEAP_BASIC_BLOCK_PROFILER_DATA",258:"PREPARSE_DATA",259:"PROPERTY_ARRAY",260:"PROPERTY_CELL",261:"SCOPE_INFO",262:"SHARED_FUNCTION_INFO",263:"SMI_BOX",264:"SMI_PAIR",265:"SORT_STATE",266:"SWISS_NAME_DICTIONARY",267:"WASM_API_FUNCTION_REF",268:"WASM_CONTINUATION_OBJECT",269:"WASM_INTERNAL_FUNCTION",270:"WASM_NULL",271:"WASM_RESUME_DATA",272:"WASM_STRING_VIEW_ITER",273:"WASM_TYPE_INFO",274:"WEAK_ARRAY_LIST",275:"WEAK_CELL",276:"WASM_ARRAY",277:"WASM_STRUCT",278:"JS_PROXY",1057:"JS_OBJECT",279:"JS_GLOBAL_OBJECT",280:"JS_GLOBAL_PROXY",281:"JS_MODULE_NAMESPACE",1040:"JS_SPECIAL_API_OBJECT",1041:"JS_PRIMITIVE_WRAPPER",1058:"JS_API_OBJECT",2058:"JS_LAST_DUMMY_API_OBJECT",2059:"JS_DATA_VIEW",2060:"JS_RAB_GSAB_DATA_VIEW",2061:"JS_TYPED_ARRAY",2062:"JS_ARRAY_BUFFER",2063:"JS_PROMISE",2064:"JS_BOUND_FUNCTION",2065:"JS_WRAPPED_FUNCTION",2066:"JS_FUNCTION",2067:"BIGINT64_TYPED_ARRAY_CONSTRUCTOR",2068:"BIGUINT64_TYPED_ARRAY_CONSTRUCTOR",2069:"FLOAT32_TYPED_ARRAY_CONSTRUCTOR",2070:"FLOAT64_TYPED_ARRAY_CONSTRUCTOR",2071:"INT16_TYPED_ARRAY_CONSTRUCTOR",2072:"INT32_TYPED_ARRAY_CONSTRUCTOR",2073:"INT8_TYPED_ARRAY_CONSTRUCTOR",2074:"UINT16_TYPED_ARRAY_CONSTRUCTOR",2075:"UINT32_TYPED_ARRAY_CONSTRUCTOR",2076:"UINT8_CLAMPED_TYPED_ARRAY_CONSTRUCTOR",2077:"UINT8_TYPED_ARRAY_CONSTRUCTOR",2078:"JS_ARRAY_CONSTRUCTOR",2079:"JS_PROMISE_CONSTRUCTOR",2080:"JS_REG_EXP_CONSTRUCTOR",2081:"JS_CLASS_CONSTRUCTOR",2082:"JS_ARRAY_ITERATOR_PROTOTYPE",2083:"JS_ITERATOR_PROTOTYPE",2084:"JS_MAP_ITERATOR_PROTOTYPE",2085:"JS_OBJECT_PROTOTYPE",2086:"JS_PROMISE_PROTOTYPE",2087:"JS_REG_EXP_PROTOTYPE",2088:"JS_SET_ITERATOR_PROTOTYPE",2089:"JS_SET_PROTOTYPE",2090:"JS_STRING_ITERATOR_PROTOTYPE",2091:"JS_TYPED_ARRAY_PROTOTYPE",2092:"JS_MAP_KEY_ITERATOR",2093:"JS_MAP_KEY_VALUE_ITERATOR",2094:"JS_MAP_VALUE_ITERATOR",2095:"JS_SET_KEY_VALUE_ITERATOR",2096:"JS_SET_VALUE_ITERATOR",2097:"JS_ATOMICS_CONDITION",2098:"JS_ATOMICS_MUTEX",2099:"JS_SHARED_ARRAY",2100:"JS_SHARED_STRUCT",2101:"JS_ITERATOR_DROP_HELPER",2102:"JS_ITERATOR_FILTER_HELPER",2103:"JS_ITERATOR_MAP_HELPER",2104:"JS_ITERATOR_TAKE_HELPER",2105:"JS_GENERATOR_OBJECT",2106:"JS_ASYNC_FUNCTION_OBJECT",2107:"JS_ASYNC_GENERATOR_OBJECT",2108:"JS_MAP",2109:"JS_SET",2110:"JS_WEAK_MAP",2111:"JS_WEAK_SET",2112:"JS_ARGUMENTS_OBJECT",2113:"JS_ARRAY",2114:"JS_ARRAY_ITERATOR",2115:"JS_ASYNC_FROM_SYNC_ITERATOR",2116:"JS_COLLATOR",2117:"JS_CONTEXT_EXTENSION_OBJECT",2118:"JS_DATE",2119:"JS_DATE_TIME_FORMAT",2120:"JS_DISPLAY_NAMES",2121:"JS_DURATION_FORMAT",2122:"JS_ERROR",2123:"JS_EXTERNAL_OBJECT",2124:"JS_FINALIZATION_REGISTRY",2125:"JS_LIST_FORMAT",2126:"JS_LOCALE",2127:"JS_MESSAGE_OBJECT",2128:"JS_NUMBER_FORMAT",2129:"JS_PLURAL_RULES",2130:"JS_RAW_JSON",2131:"JS_REG_EXP",2132:"JS_REG_EXP_STRING_ITERATOR",2133:"JS_RELATIVE_TIME_FORMAT",2134:"JS_SEGMENT_ITERATOR",2135:"JS_SEGMENTER",2136:"JS_SEGMENTS",2137:"JS_SHADOW_REALM",2138:"JS_STRING_ITERATOR",2139:"JS_TEMPORAL_CALENDAR",2140:"JS_TEMPORAL_DURATION",2141:"JS_TEMPORAL_INSTANT",2142:"JS_TEMPORAL_PLAIN_DATE",2143:"JS_TEMPORAL_PLAIN_DATE_TIME",2144:"JS_TEMPORAL_PLAIN_MONTH_DAY",2145:"JS_TEMPORAL_PLAIN_TIME",2146:"JS_TEMPORAL_PLAIN_YEAR_MONTH",2147:"JS_TEMPORAL_TIME_ZONE",2148:"JS_TEMPORAL_ZONED_DATE_TIME",2149:"JS_V8_BREAK_ITERATOR",2150:"JS_VALID_ITERATOR_WRAPPER",2151:"JS_WEAK_REF",2152:"WASM_EXCEPTION_PACKAGE",2153:"WASM_GLOBAL_OBJECT",2154:"WASM_INSTANCE_OBJECT",2155:"WASM_MEMORY_OBJECT",2156:"WASM_MODULE_OBJECT",2157:"WASM_SUSPENDER_OBJECT",2158:"WASM_TABLE_OBJECT",2159:"WASM_TAG_OBJECT",2160:"WASM_VALUE_OBJECT"};function ur(t){return typeof t=="object"&&t!==null}function Mo(t){let e=t;if(!ur(e)||typeof e.id!="number"||!ur(e.callFrame))return!1;let r=e.callFrame.scriptId;return!(typeof r!="string"&&(typeof r!="number"||!Number.isInteger(r)))}function pr(t){return!Array.isArray(t)||ArrayBuffer.isView(t)?!1:t.length>0?Number.isInteger(t[0])&&(t.length===1||Number.isInteger(t[1])):!0}function Fo(t,e){return Array.isArray(t)?t.length>0?e(t[0])&&(t.length===1||e(t[1])):!0:!1}function il(t){return Fo(t,e=>typeof e=="object"&&e!==null&&"size"in e&&typeof e.size=="number")}function dt(t){let e=t;return!(!ur(e)||!Fo(e.nodes,Mo)&&!("head"in e&&Mo(e.head))||!il(e.samples)&&(!pr(e.samples)||!pr(e.timeDeltas)))}function Ro(t){let e=t.nodes;if(e.length<2||typeof e[0].parent!="number"&&typeof e[1].parent!="number")return;let r=new Map;for(let n of t.nodes)(!Array.isArray(n.children)||n.children.length===0)&&r.set(n.id,n);if(r.size>0){for(let n of e)if(typeof n.parent=="number"){let s=r.get(n.parent);s!==void 0&&(Array.isArray(s.children)?s.children.push(n.id):s.children=[n.id])}}}function Do(t,e=[]){let r=t.children;if(Array.isArray(r)){e.push({...t,children:r.map(n=>n.id)});for(let n of r)Do(n,e)}return e}function Bo(t){let e=t.head;return e?{...t,nodes:Do(e)}:t}function vo(t,e){if(t.length>0&&e in t[0])return t.map(r=>r[e])}function cr(t,e,r,n=!1){let s=vo(t,e),o=[];if(s!==void 0){let i=new Map([...new Set(s)].map((a,l)=>[a,l]));s=s.map(a=>i.get(a)||0),o=[...i.keys()].map(a=>n||!Object.hasOwn(r,a)?`(${a}) ${r[a]||"unknown"}`:r[a]||"unknown")}return{vector:s,names:o}}function Uo(t){if(pr(t.samples))return t;let e=t.samples;e=e.slice().sort((l,c)=>l.ordinal-c.ordinal);let{vector:r,names:n}=cr(e,"type",Oo,!0),{vector:s,names:o}=cr(e,"space",No),{vector:i,names:a}=cr(e,"gc",Io);return{...t,_type:"memory",_memoryGc:i,_memoryGcNames:a,_memoryType:r,_memoryTypeNames:n,_memorySpace:s,_memorySpaceNames:o,_samplePositions:vo(e,"pos"),_scripts:t._scripts||t.scripts||void 0,samples:e.map(l=>l.nodeId),timeDeltas:e.map(l=>l.size)}}function Lo(t){let{meta:e}=t;return!!(e&&e.fileDocumentType==="x-msedge-session-log"&&e.type==="performance")}function jo(t){let e=[],r=[];for(let s of t.scripts||[])s.sourceText&&e.push({id:Number(s.scriptId),url:s.url,source:s.sourceText});for(let s of t.executionContexts||[])s.name&&r.push({origin:s.origin,name:s.name});return{...t.payload,runtime:"edge",executionContexts:r,scripts:e}}function fr(t){if(!Array.isArray(t))return typeof t=="object"&&t!==null&&"traceEvents"in t?fr(t.traceEvents):!1;if(t.length===0)return!0;let e=t[0];return"pid"in e&&"tid"in e&&"ph"in e&&"cat"in e}function Vo(t){let e=new Map,r=new Map,n=new Map;"traceEvents"in t&&(t=t.traceEvents),t=t.filter(i=>i.name==="CpuProfile"||i.name==="Profile"||i.name==="ProfileChunk"||i.name==="process_name"||i.name==="thread_name").sort((i,a)=>i.ts-a.ts);for(let i of t){if(i.name==="CpuProfile"){let a=`${i.pid}:0x1`,l=i.args.data.cpuProfile;e.set(a,l)}if(i.name==="Profile"){let a=`${i.pid}:${i.id}`,l={_name:n.get(i.tid)||null,startTime:0,endTime:0,nodes:[],samples:[],timeDeltas:[],...i.args.data};e.set(a,l)}if(i.name==="thread_name"&&n.set(i.tid,i.args.name),i.name==="process_name"&&r.set(i.pid,i.args.name),i.name==="ProfileChunk"){let a=`${i.pid}:${i.id}`,l=e.get(a),c=i.args.data;if(!l){console.warn(`Ignoring ProfileChunk for undeclared Profile with id ${a}`);continue}if(c.cpuProfile){let{nodes:p,samples:u}=c.cpuProfile;Array.isArray(p)&&p.length>0&&l.nodes.push(...p),u&&l.samples.push(...u)}c.timeDeltas&&l.timeDeltas.push(...c.timeDeltas),c.startTime!=null&&(l.startTime=c.startTime),c.endTime!=null&&(l.endTime=c.endTime)}}if(e.size===0)throw new Error("Could not find CPU profile in Timeline");let s=[],o=-1;for(let[i,a]of e)(r.get(parseInt(i))||"Unknown")==="CrRendererMain"&&(o=s.length),s.push(a);return o===-1&&(o=s.reduce((i,a,l,c)=>c[i].nodes.length<a.nodes.length?l:i,0)),{indexToView:o,profiles:s}}var qo="1.0.0-beta.13";var z=Object.hasOwn||((t,e)=>Object.hasOwnProperty.call(t,e)),al=Object.prototype.toString;function Se(t,e){return e!==void 0&&(D(e)?e.forEach(r=>t.add(r)):t.add(e)),t}function ht(t,e,r){t.has(e)?t.get(e).add(r):t.set(e,new Set([r]))}function zo(t,e){return t&&z(t,e)?t[e]:void 0}function te(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function ie(t){return al.call(t)==="[object RegExp]"}function se(t){return t&&(D(t)||z(t,"length")&&isFinite(t.length))}function D(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function pe(t,e=0){let r=parseInt(t,10);return isNaN(r)?e:r}function Z(t){if(D(t))return t.length>0;if(te(t)){for(let e in t)if(z(t,e))return!0;return!1}return!!t}var ll=function(){return{yy:{},options:{ranges:!0},rules:[/^(?:\/\/.*?(?:\n|\r\n?|\u2028|\u2029|$)|\/\*(?:.|\s)*?(?:\*\/|$))/,/^\s+/,/^\//,/^<(?!=)/,/^/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*\(?)/,/^/,(e,r)=>{if(e[0]!==(r==="template"?"}":"`"))return null;for(let n=1;n<e.length;n++){if(e[n]==="`")return n+1;if(e[n]==="$"&&e[n+1]==="{")return n+2;e[n]==="\\"&&n++}return null},(e,r)=>{if(e[0]!==(r==="template"?"}":"`"))return null;for(let n=1;n<e.length;n++){if(e[n]==="`")return n+1;if(e[n]==="$"&&e[n+1]==="{")return n+2;e[n]==="\\"&&n++}return null},/^/,/^\(/,/^\)/,/^\[/,/^\]/,/^\{/,/^\}/,/^(?:(true|false|null|undefined|Infinity|NaN)\b)/,/^and\b/,/^or\b/,/^is\b/,/^has\s+no\b/,/^has\b/,/^in\b/,/^not\s+in\b/,/^not\b/,/^no\b/,/^(?:(asc|desc)(NA?|AN?)?\b)/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*\()/,/^(?:\$(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*\()/,/^(?:(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*)/,/^(?:\$(?:[a-zA-Z_]|\\u[0-9a-fA-F]{4})(?:[a-zA-Z_$0-9]|\\u[0-9a-fA-F]{4})*)/,/^(?:[_\d]*\.)?[_\d]+(?:[eE][-+]?[_\d]+)?\b/,/^(?:\d*\.)?\d+(?:[eE][-+]?\d+)?\b/,/^0[xX][_0-9a-fA-F]+/,/^0[xX][0-9a-fA-F]+/,/^(?:"(?:\\[\\"]|[^"])*")/,/^(?:'(?:\\[\\']|[^'])*')/,/^(?:\/(?:\\.|[^/])+\/[gimsu]*)/,/^@/,/^#/,/^\$\$/,/^\$/,/^=>/,/^=/,/^!=/,/^~=/,/^>=/,/^<=/,/^</,/^>/,/^\.\.\(/,/^\.\(/,/^\.\[/,/^\.\.\./,/^\.\./,/^\./,/^\?\?/,/^\?/,/^,/,/^:/,/^;/,/^\-/,/^\+/,/^\*/,/^\//,/^\%/,/^(?:\|)/,/^./,/^$/],conditions:{preventPrimitive:{rules:[0,1,2,3,4,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68],inclusive:!0},preventKeyword:{rules:[5,6],inclusive:!1},template:{rules:[8,9],inclusive:!1},INITIAL:{rules:[0,1,7,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68],inclusive:!0}},performAction(e,r,n,s){let o=s;switch(n){case 0:{e.commentRanges.push(r.yylloc.range);break}case 1:break;case 2:{return this.popState(),40;break}case 3:{return this.popState(),44;break}case 4:{this.done=!1,this.popState();break}case 5:{if(this.popState(),r.yytext.endsWith("(")){this.unput(r.yytext);return}return e.pps(),r.yytext=this.ident(r.yytext),14;break}case 6:{this.done=!1,this.popState();break}case 7:{let i=r.yytext.endsWith("`")?"TEMPLATE":"TPL_START";return r.yytext=this.toStringLiteral(r.yytext,!0,1+ +(i!=="TEMPLATE")),i==="TEMPLATE"&&e.pps(),i;break}case 8:{let i=r.yytext.endsWith("`")?"TPL_END":"TPL_CONTINUE";return r.yytext=this.toStringLiteral(r.yytext,!0,1+ +(i!=="TPL_END")),this.popState(),i==="TPL_END"&&e.pps(),i;break}case 9:{this.parseError("Unexpected end of input");break}case 10:return 21;case 11:{return e.pps(),22;break}case 12:return 61;case 13:{return e.pps(),63;break}case 14:return 84;case 15:{if(this.bracketStack[this.bracketStack.length-1]!=="TPL_END")return e.pps(),85;this.unput("}"),this.begin("template");break}case 16:{return r.yytext=this.toLiteral(r.yytext),57;break}case 17:return 36;case 18:return 37;case 19:return 30;case 20:return 35;case 21:return 33;case 22:return 32;case 23:return 34;case 24:return 25;case 25:return 26;case 26:return 95;case 27:{return r.yytext=this.ident(r.yytext.slice(0,-1)),70;break}case 28:{return r.yytext=this.ident(r.yytext.slice(1,-1)),72;break}case 29:{return e.pps(),r.yytext=this.ident(r.yytext),14;break}case 30:{return e.pps(),r.yytext=this.ident(r.yytext.slice(1)),15;break}case 31:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext,!0),55;break}case 32:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext),55;break}case 33:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext,!0,!0),55;break}case 34:{return e.pps(),r.yytext=this.toNumberLiteral(r.yytext,!1,!0),55;break}case 35:{return e.pps(),r.yytext=this.toStringLiteral(r.yytext),54;break}case 36:{return e.pps(),r.yytext=this.toStringLiteral(r.yytext),54;break}case 37:{return e.pps(),r.yytext=this.toRegExp(r.yytext),56;break}case 38:{return e.pps(),51;break}case 39:{return e.pps(),52;break}case 40:{return e.pps(),53;break}case 41:{return e.pps(),9;break}case 42:return 20;case 43:return 42;case 44:return 43;case 45:return 48;case 46:return 47;case 47:return 45;case 48:return 44;case 49:return 46;case 50:return 69;case 51:return 66;case 52:return 67;case 53:return 89;case 54:{return e.pps(),e.pks(),68;break}case 55:{return e.pps(),e.pks(),65;break}case 56:return 38;case 57:return 17;case 58:return 73;case 59:return 11;case 60:return 10;case 61:return 27;case 62:return 28;case 63:return 39;case 64:return 40;case 65:return 41;case 66:return 29;case 67:{this.parseError(`Bad input on line ${r.yylloc.first_line} column ${r.yylloc.first_column}
`+this.showPosition(),{text:r.yytext,token:"BAD_TOKEN"});break}case 68:return 5}},setInput(e,r){return this.yy=r||this.yy||{},this._input=e,this._more=!1,this._backtrack=!1,this.done=!1,this.currentCondition="INITIAL",this.conditionStack=["INITIAL"],this.offset=0,this.yytext=this.match="",this.yyleng=0,this.yylineno=0,this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.yylloc.range=[0,0],this},parseError(e,r){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,r)},input(){let e=this._input[this.offset],r=/\n|\r\n?|\u2028|\u2029/g.test(e);return this.offset++,this.yyleng++,this.yytext=this.match=this.yytext+e,r?(this.yylineno++,this.yylloc.last_line++,this.yylloc.last_column=0):this.yylloc.last_column++,this.yylloc.range[1]++,e},lineColumnForOffset(e=this.offset,r=this._input,n=1,s=0){let o=/\n|\r\n?|\u2028|\u2029/g,i=n,a=s,l=0,c;for(;(c=o.exec(r))!==null;)if(c.index<e)i++,a=0,l=c.index+c[0].length;else{a+=e-l,l=-1;break}return l!==-1&&(a+=e-l),{line:i,column:a}},setMatch(e,r){let n=this._input.slice(e,r),s=e!==this.offset?this.lineColumnForOffset(e):{line:this.yylloc.last_line,column:this.yylloc.last_column},o=e!==r?this.lineColumnForOffset(r-e,n,s.line,s.column):s;this.yytext=this.match=n,this.yyleng=r-e,this.offset=r,this.yylineno=o.line-1,this.yylloc={first_line:s.line,first_column:s.column,last_line:o.line,last_column:o.column},this.yylloc.range=[e,r]},less(e){let r=this.offset-this.match.length;this.setMatch(r,r+e)},unput(e){let r=this.match.length-e.length;if(!this.match.startsWith(e,r))throw new Error("Lexer#unput() should receive a part of matched text only");this.less(r)},more(){this._more=!0},reject(){throw new Error("reject() is allowed only when options.backtrack_lexer = true")},showPosition(e=this.offset-this.match.length){let r=this._input,n=Math.max(e-20,0),s=Math.min(e+20,r.length),o=(n===0?"":"...")+r.slice(n,e).replace(/\n|\r\n?|\u2028|\u2029/g,"\\n"),i=r.slice(e,s).replace(/\n|\r\n?|\u2028|\u2029/g,"\\n")+(s===r.length?"":"...");return o+i+`
${"-".repeat(o.length)}^`},test_match(e,r){let n;this._more=!1,this._backtrack=!1,this.setMatch(this.offset,this.offset+e[0].length),this.matches=e;let s=this.performAction.call(this,this.yy,this,r,this.conditionStack[this.conditionStack.length-1]);return!s&&this._backtrack?(Object.assign(this,n),!1):(this.eof()||(this.done=!1),typeof s=="number"&&this.yy.parser?this.yy.parser.terminals_[s]:s||!1)},eof(){return this.offset===this._input.length},next(){if(this.done)return 1;this.eof()&&(this.done=!0),this._more||(this.yytext="",this.match="");let e,r;for(let n of this.conditions[this.currentCondition].rules){let s=this.rules[n],o=this._input.slice(this.offset),i;if(typeof s=="function"){let a=s(o,this.currentCondition);switch(typeof a){case"string":i=[a];break;case"number":i=[o.slice(0,a)];break;default:i=a}}else i=o.match(s);if(i&&(!e||i[0].length>e[0].length)){e=i,r=n;break}}if(e)return this.test_match(e,r);if(this.eof())return 1;this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex(){let e;for(;!e;)e=this.next();return e},begin(e){this.currentCondition=e,this.conditionStack.push(e)},pushState(e){this.begin(e)},popState(){return this.conditionStack.pop(),this.currentCondition=this.conditionStack.length?this.conditionStack[this.conditionStack.length-1]:"INITIAL"},topState(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},stateStackSize(){return this.conditionStack.length}}}();function mr(){this.yy={}}mr.prototype={Parser:mr,lexer:ll,symbols_:{error:2,root:3,block:4,EOF:5,definitions:6,e:7,def:8,$:9,";":10,":":11,$ident:12,ident:13,IDENT:14,$IDENT:15,condConsequent:16,"?":17,condAlternate:18,query:19,"=>":20,"(":21,")":22,functionArgs:23,compareFunction:24,NOT:25,NO:26,"-":27,"+":28,"|":29,IS:30,assertion:31,IN:32,HAS:33,NOTIN:34,HASNO:35,AND:36,OR:37,"??":38,"*":39,"/":40,"%":41,"=":42,"!=":43,"<":44,"<=":45,">":46,">=":47,"~=":48,queryRoot:49,relativePath:50,"@":51,"#":52,$$:53,STRING:54,NUMBER:55,REGEXP:56,LITERAL:57,template:58,object:59,array:60,"[":61,sliceNotation:62,"]":63,"method()":64,".":65,".(":66,".[":67,"..":68,"..(":69,"METHOD(":70,arguments:71,"$METHOD(":72,",":73,functionArg:74,templateString:75,templateStart:76,templateTail:77,templateEnd:78,templateContinue:79,TEMPLATE:80,TPL_START:81,TPL_CONTINUE:82,TPL_END:83,"{":84,"}":85,objectEntries:86,objectEntry:87,objectEntryKeyLiteral:88,"...":89,arrayElements:90,arrayElement:91,assertionTerm:92,assertionList:93,compareExpr:94,ORDER:95,sliceNotationComponent:96,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",9:"$",10:";",11:":",14:"IDENT",15:"$IDENT",17:"?",20:"=>",21:"(",22:")",25:"NOT",26:"NO",27:"-",28:"+",29:"|",30:"IS",32:"IN",33:"HAS",34:"NOTIN",35:"HASNO",36:"AND",37:"OR",38:"??",39:"*",40:"/",41:"%",42:"=",43:"!=",44:"<",45:"<=",46:">",47:">=",48:"~=",51:"@",52:"#",53:"$$",54:"STRING",55:"NUMBER",56:"REGEXP",57:"LITERAL",61:"[",63:"]",65:".",66:".(",67:".[",68:"..",69:"..(",70:"METHOD(",72:"$METHOD(",73:",",80:"TEMPLATE",81:"TPL_START",82:"TPL_CONTINUE",83:"TPL_END",84:"{",85:"}",89:"...",95:"ORDER"},productions_:[0,[3,2],[4,2],[4,1],[4,1],[4,0],[6,1],[6,2],[8,2],[8,4],[8,2],[8,4],[13,1],[12,1],[16,2],[16,1],[18,2],[18,1],[18,0],[7,1],[7,2],[7,3],[7,4],[7,5],[7,1],[7,2],[7,2],[7,2],[7,2],[7,3],[7,4],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[7,3],[19,1],[19,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,1],[49,3],[49,2],[49,2],[49,1],[49,1],[49,3],[49,4],[49,2],[49,2],[49,3],[49,3],[49,2],[49,2],[49,3],[49,2],[49,3],[50,3],[50,4],[50,4],[50,3],[50,3],[50,4],[50,4],[50,3],[50,3],[50,4],[64,2],[64,3],[64,2],[64,3],[71,1],[71,3],[74,1],[23,1],[23,3],[58,1],[58,2],[77,1],[77,2],[77,2],[77,3],[75,1],[76,1],[79,1],[78,1],[59,2],[59,3],[59,4],[59,3],[59,4],[59,5],[86,1],[86,3],[88,1],[88,1],[88,1],[87,1],[87,1],[87,1],[87,1],[87,1],[87,3],[87,3],[87,3],[87,2],[87,2],[87,2],[87,5],[87,1],[87,2],[90,1],[90,3],[91,1],[91,1],[91,2],[60,2],[60,3],[60,4],[31,1],[31,2],[31,3],[31,4],[92,1],[92,1],[92,1],[92,1],[93,1],[93,3],[93,3],[24,1],[24,3],[94,2],[62,1],[62,2],[62,2],[62,3],[96,1],[96,2]],table:function(e){function r(f){let m=f.match(/[\x20-\x2f]/g),d=m?Math.max(...m.map(g=>g.charCodeAt()-32)):-1;for(let g=d;g>=0;g--){let A=(32+g).toString(16),h;f=f.replace(new RegExp("\\[\\x"+A+"(.+?)\\]"),(y,T)=>h=T).replace(new RegExp("\\x"+A,"g"),h)}return f=f.replace(/<([^>]+?)>/g,(g,A)=>{let h=o[A[0]],y=1;return h>>5===1&&(h=h&31|o[A[1]]<<5,y=2),A.slice(y).repeat(h)}),f}function n(f){let m=[];for(let d=0;d<f.length;d++){let g=o[f[d]];if(g&32){let A=o[f[++d]];m.push(g&31|A<<5)}else m.push(g)}return m}let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789~|=".split("").reduce((f,m,d)=>(f[m]=d,f),Object.create(null)),[i,a,...l]=e.split("=").map(r),c=a.split(";").map(f=>{let m=[];for(let d=0;d<f.length;d++)for(let g=0,A=o[f[d]];g<3;g++)m.push(A>>g*2&3);return m}),p=l.map(n),u=n(i).map(f=>{let m=c[f],d=Object.create(null);for(let g=0;g<m.length;g++){let A=m[g];if(A!==0){let h=p[A-1].shift();d[g]=A===1?h:[A-1,h]}}return d});for(let f=0;f<p[3].length;f+=2)u[p[3][f]][p[3][f+1]]=[3];return u}(`ABCDEFGHIJKHHHHLL<NM>NOPMMQRSQRTMUVWXYYMZaEFTO<TH>PMbQRSQRcMMHdefgBhBiBHj[ BjBkBk]BFHFHlBMmBnBoBpBqBrBMMsBtBMMMMXMWMMuB[!lBMMuB]vBgBMMwBUMZMxByBzB0B1B2B3B4BH5<DB6>BvBXe7BXevBgBM<E8B>9B~ <DB|>BgCgC<EhC>gCMMiC<C!>cHdjCMfMkClClCMMmCnCnBoCpCMtBqCrCvBMMMvBMUMMsCMxBHtCHtCtCHuCvCTXHXvB<FM>cHhBhBMFFMpBpCnCqCMOOMMzBzB2BMsCwCtCtCxC7BcMrCrCHMHtCtC=A1[ V[!C["lmkCpqC]]]<FA>[#[$[%[&['UqqWJkq]K]C][([)FgCCAAE];]]A];Ag;AwU[*ClmkOpqC]<FA>[+[,U[-qqWJnqK]]C(A]wAA[.A[/kAMAqi]]<Fq>CAAAAD<JA>g;AwADwzwP8|D<GA>||DMz|PDAwDPw;AwA8AwAMA|z<F|>DAAAIjqCMAA8MAAw;AAE!<FA>#wA8AwgMA|z<F|>DAAAMz|DMAA8MAAw;AAVClmkapqC<FA>&S(AwA8AwAMA|z<F|>DAAAMz|DIAA8MAAw;AwAoAwAMA|z<F|>DAAAMz|DMAA8MAAw;AwA8AwAMA|z<F|>DAAAMz|DMAA8MAAw;AAEi"<FA>UqqWZmqKCFgCCgFEB;AAAChCACIAE<IA>C<KA>Q;AwAsAwBMA|z<F|>DAAAMz|DMAA8MAAw;AAAAk<QA>EAIC;AEV*<FA>#E <FA>+A <FA>#AE!<FA>%VlqCAAE;AARClC<MA>KCIEAICAAAYl;AwE~lmkOp6y<F|>X-OFg~OAA0;AwA|wzwP8|z<F|>D||DMz|PPAw|PAAw;AAEClmkKpqC<FA>'aC(AAADwzwD8|D<GA>||DMw|PDAw|D;M;AAEi"<FA>UqqWZmqKC)B;AwA8.<Fq>CAAAMz|DMAA8MAA<Cg;AAAAAA>AI<QA>I;<FA>kAIAqi<Fq>C<OA>g;AAU!<FA>$<HA>M<QA>M;AAA8AwgMA|z<F|>DAAAMw|DM<GA>w;AwA8A0AMA6jq|qqqCAAAMz|DMAA8MAAw;AwA8A0AMA|z||q||DAAAMz|DMAA8MAAw<C;AAAAAAAAAAAAAAAAAAAAAC>AAI;AAAg<RA>D<KA>B;AAAgAkAAAqi<Fq>CAAAADAAM<GA>gB;<VA>DAAM;AAEy"<FA>+AE!<FA>,O(AAAChCACA<KA>C<KA>Q;AAAChCACIAE<IA>C<KA>QB;<HA>I;AwA8AkAMA6i<Fq>CAAAMz|DMAA8MAAw;<FA>kAAAqi<Fq>C<JA>FoAAAg;<YA>IAAAI;AAQClC<MA>KCIEAICAAAYl;<YA>MAAAM;AAAo<UA>MAAAM;AAEq"<FA>&OFgCOAAE;AAEi"<FA>&OFgCOAAE;AAE!<FA>&OFgCOAAE;AAAg<UA>MAAAM;AAAClmECAgC<FA>&OFgCO;AAAw<UA>MAAAM;<FA>/<Fq>C<HA>M<GA>g;AwA8A0AMA6z||qqqCAAAMz|DMAA8MAAw;AwA8A0AMA6jqvqqqCAAAMz|DMAA8MAAw;AwA8A0AMA6jquqqqCAAAMz|DMAA8MAAw;AwA8A0AMA|z<F|>DAAAMz|DMAA8MAAw;AwA8A0AMA6z||qvqDAAAMz|DMAA8MAAw;AwA8A0AMA6z||q||DAAAMz|DMAA8MAAw;AAAgAkAAAqi<Fq><CCAAAA><FA>gB;<FA>C<SA>Q;<FA>kAAAqi<Fq>C<OA>g;AAAIAkAAAqi<Fq>C<OA>g;AAE!<FA>UqqWJmqKCFgCCgEE;<VA>D;AAAwAkAAAqi<Fq>CAAAAD<JA>g;<FA>kAAAqi<Fq>CAAAADAAM<GA>g;<HA>IAAAAK;<HA>MAAAAP;AAAClC<MA>KCIEAICAAAIl;<FA>kAAAqi<Fq>C<HA>MAAAMAAg;<FA>kAAAqi<Fq><CCAAAA><FA>g;<UA>IgqCMAAAM;AAAIAkAAAqi<Fq>C<HA>MAAAMAAg;AAAg=BC[ D[!E["[#F[$QhBgBG]][%[&['[(KRSbcd]iB]pBqB]T]]]]zB[)0B$%qC]y[*C[[,+[-0ChBgB]]G%]]5C4C#3C'6CpBqBT9*~*|*gD+pD-G(lD[.iBpBqB]nDqDToDzDtDuD2D4D5D6D 7D 8D9D~D gE|D"jE-G&hEiEkETpEF[/sEtEuE]oEqEvE1E+4E-G'3EpBqBT4E-G'6EpBqBTqC8E7!zD9EuD~E+|E+gF+hF+iF+jF+kF+lF+mF+nF+oF+pF+qF+rF+sF+tF+uF+vF+wF+xFzF-G(0F.ToD1F2F3F 4F 5F6F7F qC8F+qChG0B$%jG-G&iG<EqC>kG+lG+pGqCqGrG+sG+zDtGzDwGuDvGxG+qC1G)2G3GjE-G&4GiEkET0B/8GqEvE~G+gH+hH+jH,kHRSbcd.qCqCqCpH0B$%<UqC>qGqCvH+xH<EqC>4H-G&3HT5HqCqCzDwGuD6HqCqCjE-G&~HiEkETiItEuEgIvElI+qCmI+qCqCnI+qC5C4C"pI+qCqCqI+qCzDsIuDzDtIuD~G+iItEuEgIvE<FqC>xI+yI+qCqC=[ [!["P[#[$[%[&['tBIsBHJ]LMNO][(oB[)fUVWXYZae]]][*jBkBlBmBnBuBvBwBxB]]r]]B]y][+B[,![-[.sB|B~B][/1B2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC]]]rC]sCtCuCvCwCxCzC#B1CPtB7CsBHJ2CLMNO(*rB8C<EzC#B>hDiDjDkDzCrD%mD*rBsDyDxD1DwDvD0D3D<CtBuBvB!!>zC$mElErBrEtB1DyEzE0EwEuBvBnExEzC&)*rBzC'2ELMNO(*rBzC'5ELMNO(*rB-rC DxD1DwDvD0D<TzC#B>3DzCrD%yF*rBtBuBv<CB">BtBuBv+zC#B9F~F|FsBgG|B~B/rC!1CzC#B<C|B~B3B4B5B6BgChCiCjCkClCmCnCoCpC><CgChCiC><CzC#B>mGnGoGrDrD-rC<CzC#B>yDxD1DuG0DyDxD1DwDvD0DzC&)*rByGzG0G.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC,mElErCzC$mElErB6G5GrEtB1DyEzE0EwEuBvB7GxEhDiDzCjD9G#BzC|G#BzC#BiHzC#BzCtB1DsBlH(*rB.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpCmHnH-rCoHnH.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC!<E|B~BgChCiCjCkClCmCnCoCpC>|B~B3B4B5B6B9BgChCiCjCkClCmCnCoCpC|B~B3B4B5B6B7B9BgChCiCjCkClCmCnCoCpC|B~B3B4B5B6BgChCiCjCkClCmCnCoCp<CCgChCi><CC|B~BgChCiClCmCnCo><FC|B~BgChCi>ClCmCnCoCrD-qHrCrHsHtHuH-rCzC#BwHyHsBzH|B~B/rC-rC0H-rC1H-rCzC%2H*rBsDrD<C-rC>yDxD1DwDvD0D7H8H9H<C.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC>zC$mElErBhItB1DyEzE0EwEuBvB|HxEkIjI<CzC#B-rC>-rCzC#B-oIrCsCtCuCvCwCxC!zC#B.2B3B4B5B6B7B8B9BgChCiCjCkClCmCnCoCpC-rCzC#B-rCrI8H9H<CyDxD1DwDvD0D>zCuI#BhItB1DyEzE0EwEuBvBvIxE1H<D-rC>wI<C-rC><CzC#B><C-rC>=FDDDEEE<jBG><gBT><mBN><lBY><kB4B><kB6B><mB0B><mB1B><mB7E><mB2B><mB3B><mB5B><mB7B><mB8B><mB9B><mB~B><mB|B><mBgC><mBhC><lBS><mBlC><mBmC>FFF<mBlD><cP><5BM><mBrD><gBsD>BCCC<jBH><lBS><mB9E>FFF<PU><mB4B><mB6B>jDjDNNNiD<bN>iDN<WZ><Wa><jBb><jBc><jBI><jBK><mBtE>~EqEqEoEoEiFiFrErE<mBjC><mBwE><mB0E><mB1E><mB2E><mB3E><5BN><mBkC><cR><mBpC><mBqC><mBtC><mBuC><RwC><mBmD><mBnD><mBuD><gBtD><mBvD>1D1[ D6D6D7D7D]8D8D9D9D~D~DmEmE<D3D><D4D><D5D><RO><5B8C>gDgD<5B~C><Rd><mBf><agB><ahB><aiB><ajB><VkB><UlB><WmB><jBnB><jBoB><mBpB><mBqB><mBrB><dsB><dtB><hBuB><hBvB><hBwB><hBxB><dyB><mBzB><mByC><mB1C><mB2C><mB5C><mB6C><PV><mBnC><mB8E><mBiC><mBuE>|EgFjFjFsEsE<mBxE><D4E><RQ><mBrC><mBsC><mBvC><RxC><mBoD><mBpD><mBwD><mByD>iEiEjEjEkEkEnEnE<5B9C><5B|C><Re><mBzC><mB0C><mB3C><mB4C><mB7C><PW>kDkDiDiD<mBoC><jBJ><jBL><mBvE>pEpEqEqEhF<mByE><mBqD><mBxD>2D2 <mBzD>hEhE|D|DgEgEhDhD<PX><mBzE><D5E><D6E><mB0D>hEhElElE=BB`),defaultActions:{50:[2,1],201:[2,159],249:[2,161]},performAction(t,e,r,n,s,o,i){let a=o.length-1;switch(s){case 1:return n.buildResult(o[a-1]);case 2:this.$={type:"Block",definitions:o[a-1],body:o[a],range:this._$.range};break;case 3:this.$={type:"Block",definitions:o[a],body:{type:"Placeholder",range:[i[a].range[1],i[a].range[1]]},range:this._$.range};break;case 4:this.$={type:"Block",definitions:[],body:o[a],range:this._$.range};break;case 5:this.$={type:"Block",definitions:[],body:{type:"Placeholder",range:[i[a].range[1],i[a].range[1]]},range:this._$.range};break;case 6:case 96:case 99:case 101:case 117:case 136:case 152:case 155:this.$=[o[a]];break;case 7:o[a-1].push(o[a]);break;case 8:this.$={type:"Definition",declarator:{type:"Declarator",name:null,range:i[a-1].range},value:null,range:this._$.range};break;case 9:this.$={type:"Definition",declarator:{type:"Declarator",name:null,range:i[a-3].range},value:o[a-1],range:this._$.range};break;case 10:this.$={type:"Definition",declarator:{type:"Declarator",name:o[a-1].name,range:i[a-1].range},value:null,range:this._$.range};break;case 11:this.$={type:"Definition",declarator:{type:"Declarator",name:o[a-3].name,range:i[a-3].range},value:o[a-1],range:this._$.range};break;case 12:case 13:case 98:case 148:case 149:this.$={type:"Identifier",name:o[a],range:this._$.range};break;case 14:case 16:case 163:this.$=o[a];break;case 15:case 17:this.$={type:"Placeholder",range:[i[a].range[1],i[a].range[1]]};break;case 18:case 162:this.$=null;break;case 19:case 52:case 53:case 64:case 65:case 138:break;case 20:case 22:this.$={type:"Function",arguments:[],body:o[a],range:this._$.range};break;case 21:this.$={type:"Function",arguments:[{type:"Identifier",name:o[a-2]}],body:o[a],range:this._$.range};break;case 23:this.$={type:"Function",arguments:o[a-3],body:o[a],range:this._$.range};break;case 24:this.$={type:"CompareFunction",compares:o[a],range:this._$.range};break;case 25:case 26:case 27:case 28:case 67:this.$={type:"Prefix",operator:o[a-1],argument:o[a],range:this._$.range};break;case 29:this.$={type:"Pipeline",left:o[a-2],right:o[a],range:this._$.range};break;case 30:this.$={type:"Pipeline",left:o[a-3],right:{type:"Block",definitions:o[a-1],body:o[a]},range:this._$.range};break;case 31:this.$={type:"Postfix",operator:o[a],argument:o[a-2],range:this._$.range};break;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:this.$={type:"Binary",operator:o[a-1],left:o[a-2],right:o[a],range:this._$.range};break;case 51:this.$={type:"Conditional",test:o[a-2],consequent:o[a-1],alternate:o[a],range:this._$.range};break;case 54:this.$={type:"Data",range:this._$.range};break;case 55:this.$={type:"Context",range:this._$.range};break;case 56:this.$={type:"Current",range:this._$.range};break;case 57:this.$={type:"Arg1",range:this._$.range};break;case 58:this.$={type:"Reference",name:o[a],range:this._$.range};break;case 59:case 60:case 61:case 62:case 107:case 108:case 109:case 110:case 119:case 120:case 121:this.$={type:"Literal",value:o[a],range:this._$.range};break;case 63:this.$={type:"Template",values:o[a],range:this._$.range};break;case 66:this.$={type:"SliceNotation",value:null,arguments:o[a-1],range:this._$.range};break;case 68:this.$={type:"Conditional",test:null,consequent:o[a-1],alternate:o[a],range:this._$.range};break;case 69:case 73:this.$={type:"GetProperty",value:null,property:o[a],range:this._$.range};break;case 70:case 74:this.$={type:"MethodCall",value:null,method:o[a],range:this._$.range};break;case 71:this.$={type:"Parentheses",body:o[a-1],range:this._$.range};break;case 72:this.$={type:"Parentheses",body:{type:"Block",definitions:o[a-2],body:o[a-1]},range:this._$.range};break;case 75:this.$={type:"Map",value:null,query:o[a-1],range:this._$.range};break;case 76:this.$={type:"Filter",value:null,query:o[a-1],range:this._$.range};break;case 77:this.$={type:"MapRecursive",value:null,query:{type:"GetProperty",value:null,property:o[a]},range:this._$.range};break;case 78:this.$={type:"MapRecursive",value:null,query:{type:"MethodCall",value:null,method:o[a]},range:this._$.range};break;case 79:this.$={type:"MapRecursive",value:null,query:o[a-1],range:this._$.range};break;case 80:this.$={type:"Pipeline",left:null,right:o[a],range:this._$.range};break;case 81:this.$={type:"Pipeline",left:null,right:{type:"Block",definitions:o[a-1],body:o[a]},range:this._$.range};break;case 82:this.$={type:"Pick",value:o[a-2],getter:null,range:this._$.range};break;case 83:this.$={type:"Pick",value:o[a-3],getter:o[a-1],range:this._$.range};break;case 84:this.$={type:"SliceNotation",value:o[a-3],arguments:o[a-1],range:this._$.range};break;case 85:this.$={type:"GetProperty",value:o[a-2],property:o[a],range:this._$.range};break;case 86:this.$={type:"MethodCall",value:o[a-2],method:o[a],range:this._$.range};break;case 87:this.$={type:"Map",value:o[a-3],query:o[a-1],range:this._$.range};break;case 88:this.$={type:"Filter",value:o[a-3],query:o[a-1],range:this._$.range};break;case 89:this.$={type:"MapRecursive",value:o[a-2],query:{type:"GetProperty",value:null,property:o[a]},range:this._$.range};break;case 90:this.$={type:"MapRecursive",value:o[a-2],query:{type:"MethodCall",value:null,method:o[a]},range:this._$.range};break;case 91:this.$={type:"MapRecursive",value:o[a-3],query:o[a-1],range:this._$.range};break;case 92:this.$={type:"Method",reference:{type:"Identifier",name:o[a-1],range:[i[a-1].range[0],i[a-1].range[1]-1]},arguments:[],range:this._$.range},this._mn=o[a-1];break;case 93:this.$={type:"Method",reference:{type:"Identifier",name:o[a-2],range:[i[a-2].range[0],i[a-2].range[1]-1]},arguments:o[a-1],range:this._$.range},this._mn=o[a-2];break;case 94:this.$={type:"Method",reference:{type:"Reference",name:{type:"Identifier",name:o[a-1],range:[i[a-1].range[0],i[a-1].range[1]-1]},range:[i[a-1].range[0],i[a-1].range[1]-1]},arguments:[],range:this._$.range},this._mn=o[a-1];break;case 95:this.$={type:"Method",reference:{type:"Reference",name:{type:"Identifier",name:o[a-2],range:[i[a-2].range[0],i[a-2].range[1]-1]},range:[i[a-2].range[0],i[a-2].range[1]-1]},arguments:o[a-1],range:this._$.range},this._mn=o[a-2];break;case 97:case 100:case 118:case 137:case 156:o[a-2].push(o[a]);break;case 102:this.$=[o[a-1],...o[a]];break;case 103:case 158:this.$=[null,o[a]];break;case 104:case 160:this.$=[o[a-1],o[a]];break;case 105:this.$=[null,o[a-1],...o[a]];break;case 106:this.$=[o[a-2],o[a-1],...o[a]];break;case 111:case 114:this.$={type:"Object",properties:[],range:this._$.range};break;case 112:this.$={type:"Object",properties:o[a-1],range:this._$.range};break;case 113:this.$={type:"Object",properties:o[a-2],range:this._$.range};break;case 115:this.$={type:"Block",definitions:o[a-2],body:{type:"Object",properties:o[a-1]},range:this._$.range};break;case 116:this.$={type:"Block",definitions:o[a-3],body:{type:"Object",properties:o[a-2]},range:this._$.range};break;case 122:this.$={type:"ObjectEntry",key:{type:"Current"},value:null,range:this._$.range};break;case 123:this.$={type:"ObjectEntry",key:{type:"Reference",name:o[a]},value:null,range:this._$.range};break;case 124:case 126:this.$={type:"ObjectEntry",key:o[a],value:null,range:this._$.range};break;case 125:this.$={type:"ObjectEntry",key:{type:"Literal",value:this._mn},value:o[a],range:this._$.range};break;case 127:case 128:this.$={type:"ObjectEntry",key:o[a-2],value:o[a],range:this._$.range};break;case 129:this.$={type:"ObjectEntry",key:{type:"Identifier",name:"$"+o[a-2].name},value:o[a],range:this._$.range};break;case 130:this.$={type:"ObjectEntry",key:o[a-1],value:{type:"Pipeline",left:{type:"Reference",name:o[a-1]},right:o[a]},range:this._$.range};break;case 131:this.$={type:"ObjectEntry",key:o[a-1],value:{type:"Pipeline",left:{type:"GetProperty",value:null,property:o[a-1]},right:o[a]},range:this._$.range};break;case 132:this.$={type:"ObjectEntry",key:{type:"Literal",value:this._mn},value:{type:"Pipeline",left:o[a-1],right:o[a]},range:this._$.range};break;case 133:this.$={type:"ObjectEntry",key:o[a-3],value:o[a],range:this._$.range};break;case 134:this.$={type:"Spread",query:null,array:!1,range:this._$.range};break;case 135:this.$={type:"Spread",query:o[a],array:!1,range:this._$.range};break;case 139:this.$={type:"Spread",query:null,array:!0,range:this._$.range};break;case 140:this.$={type:"Spread",query:o[a],array:!0,range:this._$.range};break;case 141:this.$={type:"Array",elements:[],range:this._$.range};break;case 142:this.$={type:"Array",elements:o[a-1],range:this._$.range};break;case 143:this.$={type:"Array",elements:o[a-2],range:this._$.range};break;case 144:this.$={type:"Assertion",negation:!1,assertion:o[a],range:this._$.range};break;case 145:this.$={type:"Assertion",negation:!0,assertion:o[a],range:this._$.range};break;case 146:this.$={type:"Assertion",negation:!1,assertion:o[a-1],range:this._$.range};break;case 147:this.$={type:"Assertion",negation:!0,assertion:o[a-1],range:this._$.range};break;case 150:this.$={type:"Method",reference:{type:"Reference",name:o[a]},arguments:[],range:this._$.range};break;case 151:this.$={type:"Identifier",name:String(o[a]),range:this._$.range};break;case 153:case 154:o[a-2].push(o[a-1],o[a]);break;case 157:this.$={type:"Compare",query:o[a-1],order:o[a],range:this._$.range};break;case 159:this.$=[null,o[a-1],o[a]];break;case 161:this.$=[o[a-2],o[a-1],o[a]];break}},trace(...t){this.DEBUG&&Jison.print(...t)},parseError(t,e){if(e.recoverable)this.trace(t);else{let r=new Error(t);throw r.hash=e,r}},parse(t,...e){let a=w=>{g.length-=2*w,A.length-=w,h.length-=w},l=()=>{let w=c.lex()||1;return typeof w!="number"&&(w=this.symbols_[w]||w),w},c=Object.create(this.lexer),p=c.options&&c.options.ranges,u={...this.yy,parser:this,lexer:c};c.setInput(t,u),typeof u.parseError=="function"&&(this.parseError=u.parseError),typeof c.yylloc>"u"&&(c.yylloc={});let f=this.table,m={},d=c.yylloc,g=[0],A=[null],h=[d],y=[],T="",C=0,b=0,E=0,S,k;for(;;){let w=g[g.length-1],F;if(this.defaultActions[w]?F=this.defaultActions[w]:((S===null||typeof S>"u")&&(S=l()),F=f[w]&&f[w][S]),!F||!F[0]){let P=function(M){let x=g.length-1,N=0;for(;;){if("2"in f[M])return N;if(M===0||x<2)return!1;x-=2,M=g[x],++N}},_,I="";if(!E){let M=[];for(let x in f[w])x in this.terminals_&&x>2&&M.push("'"+this.terminals_[x]+"'");I=c.showPosition?"Parse error on line "+(C+1)+`:
`+c.showPosition()+`
Expecting `+M.join(", ")+", got '"+(this.terminals_[S]||S)+"'":"Parse error on line "+(C+1)+": Unexpected "+(S===1?"end of input":"'"+(this.terminals_[S]||S)+"'"),this.parseError(I,{text:c.match,token:this.terminals_[S]||S,line:c.yylineno,loc:d,expected:M})}if(E===3){if(S===1||k===1)throw new Error(I||"Parsing halted while starting to recover from another error.");b=c.yyleng,T=c.yytext,C=c.yylineno,d=c.yylloc,S=l()}if(_===!1)throw new Error(I||"Parsing halted. No suitable error recovery rule available.");a(_),k=S==2?null:S,S=2,w=g[g.length-1],F=f[w]&&f[w][2],E=3}if(Array.isArray(F[0])&&F.length>1)throw new Error("Parse Error: multiple actions possible at state: "+w+", token: "+S);switch(F[0]){case 1:g.push(S),A.push(c.yytext),h.push(c.yylloc),g.push(F[1]),S=null,k?(S=k,k=null):(b=c.yyleng,T=c.yytext,C=c.yylineno,d=c.yylloc,E>0&&E--);break;case 2:{let _=this.productions_[F[1]][1],I=h[h.length-(_||1)],P=h[h.length-1];m.$=A[A.length-_],m._$={first_line:I.first_line,last_line:P.last_line,first_column:I.first_column,last_column:P.last_column},p&&(m._$.range=[I.range[0],P.range[1]]);let M=this.performAction.call(m,T,b,C,u,F[1],A,h,...e);if(typeof M<"u")return M;_&&a(_),g.push(this.productions_[F[1]][0]),A.push(m.$),h.push(m._$),g.push(f[g[g.length-2]][g[g.length-1]]);break}case 3:return!0}}}};var cl=function(e){function r(y,T){Object.entries(T).forEach(([C,b])=>y[C]=b(y[C]))}let n=new Map([["EOF",["<end of input>"]],["IDENT",["ident"]],["$IDENT",["$ident"]],["NOT",["'not'"]],["NO",["'no'"]],["IS",["'is'"]],["IN",["'in'"]],["HAS",["'has'"]],["NOTIN",["'not in'"]],["HASNO",["'has no'"]],["AND",["'and'"]],["OR",["'or'"]],["STRING",["string"]],["TPL_START",["template"]],["TEMPLATE",["template"]],["NUMBER",["number"]],["REGEXP",["regexp"]],["LITERAL",["'true'","'false'","'null'","'undefined'","'NaN'","'Infinity'"]],["ORDER",["'asc'","'desc'","'ascN'","'descN'"]],["METHOD(",["'method('"]],["$METHOD(",["'$method('"]]]),s=y=>n.get(y)||`'${y}'`,o=function(y,T={},C){if(T.recoverable)this.trace(y);else{if(Array.isArray(T.inside)){let w=C.lexer.offset-C.lexer.match.length;C.lexer.setMatch(w+T.inside[0],w+T.inside[1])}let b=C.lexer.yylloc,E=[y.split(/\n/)[0],"",C.lexer.showPosition()],S=Array.isArray(T.expected)?[...new Set([].concat(...T.expected.map(w=>s(w.slice(1,-1)))))]:null;S&&E.push("","Expecting "+S.join(", ")+" got "+s(T.token));let k=new SyntaxError(E.join(`
`));throw k.details={rawMessage:y,text:T.text,token:T.token,expected:S,loc:{range:b.range,start:{line:b.first_line,column:b.first_column,offset:b.range[0]},end:{line:b.last_line,column:b.last_column,offset:b.range[1]}}},k}},i=new Set([`
`,"\r","\u2028","\u2029"]),a=new Map([["undefined",void 0],["null",null],["false",!1],["true",!0],["Infinity",1/0],["NaN",NaN]]);Object.assign(e.lexer,{ident:y=>y.replace(/\\u[0-9a-fA-F]{4}/g,T=>String.fromCharCode(parseInt(T.slice(2),16))),toLiteral:y=>a.get(y),toNumberLiteral(y,T,C=!1){if(T){let b=y.match(C?/(?:^|[^0-9a-fA-F])_|_(?:[^0-9a-fA-F]|$)/:/(?:^|\D)_|_(?:\D|$)/);if(b){let E=b[0],S=b.index+ +(E[1]==="_"),k=E==="__"?"Only one underscore is allowed":"Wrong underscore";this.parseError(k+" as numeric separator",{inside:[S,S+1]})}y=y.replace(/_/g,"")}return C?parseInt(y,16):parseFloat(y)},toStringLiteral(y,T=!1,C=1){let b=y.length-C,E="";for(let S=1;S<b;S++){if(!T&&i.has(y[S])&&this.parseError("Invalid line terminator",{inside:[S,S+1]}),y[S]!=="\\"){E+=y[S];continue}S===b-1&&this.parseError("Invalid backslash",{inside:[S,S+1]});let k=y[++S];switch(k){case"\r":S+=y[S+1]===`
`;break;case`
`:case"\u2028":case"\u2029":break;case"0":E+="\0";break;case"b":E+="\b";break;case"n":E+=`
`;break;case"r":E+="\r";break;case"f":E+="\f";break;case"t":E+="	";break;case"v":E+="\v";break;case"u":{let[w=""]=y.slice(S+1,S+5).match(/^[0-9a-f]*/i)||[];if(w.length===4){E+=String.fromCharCode(parseInt(w,16)),S+=4;break}this.parseError("Invalid Unicode escape sequence",{inside:[S-1,Math.min(S+1+w.length,b)]});break}case"x":{let[w=""]=y.slice(S+1,S+3).match(/^[0-9a-f]*/i)||[];if(w.length===2){E+=String.fromCharCode(parseInt(w,16)),S+=2;break}this.parseError("Invalid hexadecimal escape sequence",{inside:[S-1,Math.min(S+1+w.length,b)]});break}default:E+=k}}return E},toRegExp(y){let T=y.lastIndexOf("/")+1,C=y.substr(T);return C.split("").forEach((b,E,S)=>{let k=S.indexOf(b,E+1);k!==-1&&this.parseError("Duplicate flag in regexp",{inside:[T+k,T+k+1]})}),new RegExp(y.substr(1,y.lastIndexOf("/")-1),C)}}),r(e.lexer,{setInput:y=>function(T,C){let b=[];return C.commentRanges=b,C.buildResult=E=>({ast:E,commentRanges:b}),C.parseError=function(...E){return o.call(this,...E,C)},C.pks=()=>{this.eof()||this.begin("preventKeyword")},C.pps=()=>{this.eof()||this.begin("preventPrimitive")},this.bracketStack=[],this.prevToken=null,this.prevYylloc={first_line:1,last_line:1,first_column:0,last_column:0,range:[0,0]},y.call(this,T,C)}});let l=new e.Parser;l.lexer={...e.lexer},l.yy={...e.yy};let c=["AND","OR","IN","NOTIN","HAS","HASNO","IS"],p=[...c,"NOT","NO","ORDER"],u=["+","-","*","/","%","|","=","!=","~=",">=","<=","<",">"],f=[null,"?",":",";",",",".","..","(",".(","..(","METHOD(","$METHOD(","[",".[","=>",...u,...c,"NOT","NO"],m=[",","?",":",";","EOF","]",")","}","TPL_CONTINUE","TPL_END",...u,...c,"ORDER"],d=new Map(f.map(y=>[y,new Set(m)]));for(let y of[".(","..(","METHOD(","$METHOD("])d.get(y).delete(")");for(let y of["[",".["])d.get(y).delete("]");r(l.lexer,{lex:y=>function(){let C=this.offset,b=y.call(this);if(d.has(this.prevToken)&&d.get(this.prevToken).has(b)){let E={first_line:this.prevYylloc.last_line,last_line:this.yylloc.first_line,first_column:this.prevYylloc.last_column,last_column:this.yylloc.first_column,range:[this.prevYylloc.range[1],this.yylloc.range[0]]};if(this.unput(this.match),this.pushState("preventPrimitive"),this.done=!1,this.yytext="",this.yylloc=this.prevYylloc=E,C!==this.offset&&p.includes(b))switch(this._input[C]){case" ":case"	":E.last_column--,E.range[1]--;break;case`
`:{let S=this._input.lastIndexOf(`
`,C-1);E.last_line--,E.last_column=S===-1?E.last_column-1:C-S,E.range[1]--;break}}return this.prevToken="IDENT"}if(this.prevYylloc=this.yylloc,p.includes(b))switch(this._input[this.offset]){case" ":case"	":this.prevYylloc={...this.prevYylloc,last_column:this.prevYylloc.last_column+1,range:[this.prevYylloc.range[0],this.prevYylloc.range[1]+1]};break;case`
`:this.prevYylloc={...this.prevYylloc,last_line:this.prevYylloc.last_line+1,last_column:0,range:[this.prevYylloc.range[0],this.prevYylloc.range[1]+1]};break}return this.prevToken=b}});let g=new Map([["(",")"],[".(",")"],["..(",")"],["METHOD(",")"],["$METHOD(",")"],["[","]"],[".[","]"],["{","}"],["TPL_START","TPL_END"]]),A=new Set([")","]","}","TPL_END"]),h=y=>function(){let C=y.call(this);if(A.has(C)){let b=this.bracketStack.pop();b!==C&&this.parseError(`Expected "${b}" got "${C}"`)}return g.has(C)&&this.bracketStack.push(g.get(C)),C};return r(e.lexer,{lex:h}),r(l.lexer,{lex:h}),{parse(y,T){return T?l.parse(y):e.parse(y)},*tokenize(y,T,C){let b=T?l:e,E=Object.create(b.lexer);for(E.setInput(y,{parser:b});!E.done;){let S={type:E.lex(),value:E.match,offset:E.yylloc.range[0]};C&&(S.loc={range:E.yylloc.range,start:{line:E.yylloc.first_line,column:E.yylloc.first_column},end:{line:E.yylloc.last_line,column:E.yylloc.last_column}}),yield S}}}}(new mr),gt=cl;var dr={};O(dr,{compile:()=>ul,stringify:()=>fl,walk:()=>pl});function ul(t,e){e.put(e.scope.arg1?"arguments[1]":"undefined")}function pl(){}function fl(t,e){e.put("$$")}var hr={};O(hr,{compile:()=>dl,stringify:()=>gl,suggest:()=>ml,walk:()=>hl});function ml(t,e){t.elements.length===0&&e.queryRoot(t.range[0]+1,t.range[1]-1)}function dl(t,e){e.put("["),e.list(t.elements,","),e.put("]")}function hl(t,e){e.list(t.elements)}function gl(t,e){e.put("["),e.list(t.elements,","),e.put("]")}var gr={};O(gr,{compile:()=>Al,stringify:()=>bl,suggest:()=>yl,walk:()=>Tl});function yl(t,e){Array.isArray(t.assertion)||(e.range(t.assertion.range,"var"),e.range(t.assertion.range,"assertion"))}function Al(t,e){if(Array.isArray(t.assertion)){e.put(t.negation?"!(":"(");for(let r=0;r<t.assertion.length;r++)if(r%2===0)e.node(t.assertion[r]);else switch(t.assertion[r]){case"and":e.put("&&");break;case"or":e.put("||");break;default:e.error("Bad conjuction operator in assertion",t)}e.put(")")}else switch(t.negation&&e.put("!"),t.assertion.type){case"Identifier":t.assertion.name?(e.put("!!"),e.tolerant&&e.put("(typeof "),e.put("a."),e.put(t.assertion.name),e.tolerant&&(e.put('==="function"?a.'),e.put(t.assertion.name)),e.put(".call(mctx,"),e.nodeOrCurrent(),e.put(")"),e.tolerant&&e.put(":false)"),e.usedAssertions.has(t.assertion.name)?e.usedAssertions.get(t.assertion.name).push(t.assertion.range):e.usedAssertions.set(t.assertion.name,t.assertion.range)):e.put("false");break;case"Method":e.put("!!"),e.node(t.assertion);break;default:e.error('Unknown assertion node type "'+t.assertion.type+'"',t.assertion)}}function Tl(t,e){if(Array.isArray(t.assertion))for(let r=0;r<t.assertion.length;r++)r%2===0&&e.node(t.assertion[r]);else e.node(t.assertion)}function bl(t,e){if(t.negation&&e.put("not "),Array.isArray(t.assertion)){e.put("(");for(let r=0;r<t.assertion.length;r++)r%2===0?e.node(t.assertion[r]):(e.put(" "),e.put(t.assertion[r]),e.put(" "));e.put(")")}else e.node(t.assertion)}var yr={};O(yr,{compile:()=>Sl,stringify:()=>kl,suggest:()=>Cl,walk:()=>El});var $o={in:"in","not in":"notIn",has:"has","has no":"hasNo",and:"and",or:"or","??":"nullish","+":"add","-":"sub","*":"mul","/":"div","%":"mod","=":"eq","!=":"ne","<":"lt","<=":"lte",">":"gt",">=":"gte","~=":"match"};function yt(t,e,r){if(r.type==="Array"){if(r.elements.length===0){t.range([r.range[0]+1,r.range[1]-1],"value-subset",e,!1);return}let n=[];for(let{type:o,range:i,value:a}of r.elements)i&&(o==="Literal"||o==="Identifier")&&n.push(a);let s=n.length?t.literalList(n):!1;for(let{type:o,range:i,value:a}of r.elements)i&&(o==="Literal"||o==="Identifier"||o==="GetProperty"&&a===null)&&t.range(i,"value-subset",e,s)}}function Cl(t,e){switch(t.operator){case"in":e.range(t.left.range,"in-value",t.right,null),yt(e,t.left,t.right);break;case"not in":yt(e,t.left,t.right);break;case"has":e.range(t.right.range,"in-value",t.left,null),yt(e,t.right,t.left);break;case"has no":yt(e,t.right,t.left);break;case"=":case"!=":e.range(t.right.range,"value",t.left,null);break}}function Sl(t,e){if(!(t.operator in $o)){e.error('Unknown operator "'+t.operator+'"',t);return}switch(t.operator){case"and":e.put("!");case"or":{let r=e.allocateVar();e.put(`${e.buildinFn("bool")}(${r}=`),e.node(t.left),e.put(`)?${r}:`),e.createScope(()=>e.node(t.right),n=>(e.put(")"),"("+n+","),e.scope.$ref);break}case"??":{let r=e.allocateVar();e.put(`(${r}=`),e.node(t.left),e.put(`,${r}!==null&&${r}!==undefined)?${r}:`),e.createScope(()=>e.node(t.right),n=>(e.put(")"),"("+n+","),e.scope.$ref);break}case"has no":e.put("!");case"has":e.put(e.buildinFn("in")),e.put("("),e.node(t.right),e.put(","),e.node(t.left),e.put(")");break;default:e.put(e.buildinFn($o[t.operator])),e.put("("),e.node(t.left),e.put(","),e.node(t.right),e.put(")")}}function El(t,e){e.node(t.left),e.node(t.right)}function kl(t,e){e.node(t.left),/^[a-z]/i.test(t.operator)?(e.put(" "),e.put(t.operator),e.put(" ")):e.put(t.operator),e.node(t.right)}var Ar={};O(Ar,{compile:()=>xl,stringify:()=>Pl,suggest:()=>wl,walk:()=>_l});function wl(t,e){t.body===null&&e.queryRoot(t.range[1])}function xl(t,e){t.definitions.length?(e.put("(()=>{"),e.createScope(()=>{for(let r of t.definitions)e.scope.awaitInit.add(r.declarator.name);e.list(t.definitions),e.put("return "),e.nodeOrCurrent(t.body)},r=>r+";",e.scope.$ref),e.put("})()")):t.body&&t.body.type==="Object"?(e.put("("),e.nodeOrCurrent(t.body),e.put(")")):e.nodeOrCurrent(t.body)}function _l(t,e){e.list(t.definitions),e.nodeOrNothing(t.body)}function Pl(t,e){e.list(t.definitions),e.nodeOrNothing(t.body)}var Tr={};O(Tr,{compile:()=>Nl,stringify:()=>Ol,walk:()=>Il});var Ho={"":"cmp",N:"cmpNatural",A:"cmpAnalytical",NA:"cmpNaturalAnalytical",AN:"cmpNaturalAnalytical"};function Nl(t,e){let r=t.order.startsWith("desc"),n=Ho[t.order.slice(r?4:3)]||Ho[""];r&&e.put("-"),e.put(e.buildinFn(n)),e.put("((_q=$=>("),e.createScope(()=>e.node(t.query),s=>s+","),e.put("))(_a),_q(_b))")}function Il(t,e){e.node(t.query)}function Ol(t,e){e.node(t.query),e.put(" "),e.put(t.order)}var br={};O(br,{compile:()=>Ml,stringify:()=>Rl,walk:()=>Fl});function Ml(t,e){e.put("(_a, _b)=>{let _q;return "),e.list(t.compares,"||"),e.put("||0}")}function Fl(t,e){e.list(t.compares)}function Rl(t,e){e.list(t.compares,",")}var Cr={};O(Cr,{compile:()=>Dl,stringify:()=>vl,walk:()=>Bl});function Dl(t,e){e.put(e.buildinFn("bool")),e.put("("),e.nodeOrCurrent(t.test),e.put(")?"),e.createScope(()=>e.nodeOrCurrent(t.consequent),r=>(e.put(")"),"("+r+","),e.scope.$ref),e.put(":"),e.createScope(()=>{t.alternate?t.alternate.type==="Placeholder"?(e.put("("),e.node(t.alternate),e.put(",undefined)")):e.node(t.alternate):e.put("undefined")},r=>(e.put(")"),"("+r+","),e.scope.$ref)}function Bl(t,e){e.nodeOrNothing(t.test),e.nodeOrNothing(t.consequent),e.nodeOrNothing(t.alternate)}function vl(t,e){e.nodeOrNothing(t.test),e.put("?"),e.nodeOrNothing(t.consequent),t.alternate&&(e.put(":"),e.node(t.alternate))}var Sr={};O(Sr,{compile:()=>Ul,stringify:()=>jl,walk:()=>Ll});function Ul(t,e){e.put("context")}function Ll(){}function jl(t,e){e.put("#")}var Er={};O(Er,{compile:()=>ql,stringify:()=>$l,suggest:()=>Vl,walk:()=>zl});function Vl(t,e){t.range&&e.range(t.range,"var")}function ql(t,e){e.put(e.scope.$ref)}function zl(){}function $l(t,e){e.put("$")}var kr={};O(kr,{compile:()=>Hl,stringify:()=>Wl,walk:()=>Gl});function Hl(t,e){e.put("data")}function Gl(){}function Wl(t,e){e.put("@")}var wr={};O(wr,{compile:()=>Yl,stringify:()=>Kl,walk:()=>Jl});function Yl(t,e){t.name&&e.put("$"+t.name)}function Jl(){}function Kl(t,e){e.put(t.name?"$"+t.name:"$")}var xr={};O(xr,{compile:()=>Ql,stringify:()=>tc,suggest:()=>Zl,walk:()=>ec});function Ue(t,e){return{type:"GetProperty",value:t,property:e}}function Le(t){return{type:"Identifier",name:t}}var Xl=["data","context","ctx","array","idx","index"];function Zl(t,e){t.value===null&&e.range(t.declarator.range,"path")}function Ql(t,e){if(t.declarator.name===null){e.node(t.declarator),e.nodeOrCurrent(t.value),e.put(";");return}if(e.scope.own.has(t.declarator.name)){e.error(`Identifier "$${t.declarator.name}" has already been declared`,t.declarator);return}if(Xl.includes(t.declarator.name)){e.error(`Identifier "$${t.declarator.name}" is reserved for future use`,t.declarator);return}e.put("const "),e.node(t.declarator),e.put("="),e.node(t.value||Ue(null,Le(t.declarator.name))),e.put(";"),e.scope.add(t.declarator.name),e.scope.own.add(t.declarator.name),e.scope.awaitInit.delete(t.declarator.name)}function ec(t,e){e.node(t.declarator),e.nodeOrNothing(t.value)}function tc(t,e){e.node(t.declarator),t.value!==null&&(e.put(":"),e.node(t.value)),e.put(";")}var _r={};O(_r,{compile:()=>rc,stringify:()=>oc,walk:()=>nc});function rc(t,e){e.put(e.buildinFn("filter")),e.put("("),e.nodeOrCurrent(t.value),e.put(",$=>"),e.createScope(()=>e.node(t.query),r=>(e.put(")"),"("+r+",")),e.put(")")}function nc(t,e){e.nodeOrNothing(t.value),e.node(t.query)}function oc(t,e){e.nodeOrNothing(t.value),e.put(".["),e.node(t.query),e.put("]")}var Pr={};O(Pr,{compile:()=>sc,stringify:()=>ac,walk:()=>ic});function sc(t,e){let r=t.arguments.map(s=>"$"+s.name),n=t.arguments.find((s,o)=>o>0&&r.lastIndexOf("$"+s.name,o-1)!==-1);n&&e.error('Duplicate parameter name "$'+n.name+'" is not allowed',n),e.put("function("),e.put(String(r)||"$"),e.put("){return "),e.createScope(()=>{e.scope.arg1=!0,e.scope.$ref=r[0]||"$";for(let s of t.arguments)e.scope.add(s.name);e.node(t.body)},s=>s+","),e.put("}")}function ic(t,e){e.node(t.body)}function ac(t,e){e.put("=>"),e.node(t.body)}var Nr={};O(Nr,{compile:()=>cc,stringify:()=>pc,suggest:()=>lc,walk:()=>uc});function lc(t,e){e.range(t.property.range,"path",t.value||void 0,!t.value),t.value===null&&e.range(t.property.range,"var"),t.range&&t.value===null&&t.property.range[0]!==t.range[0]&&e.queryRoot(t.range[0])}function cc(t,e){e.put(e.buildinFn("map")),e.put("("),e.nodeOrCurrent(t.value),e.put(","),t.property.type==="Identifier"?e.put(JSON.stringify(t.property.name)):e.node(t.property),e.put(")")}function uc(t,e){e.nodeOrNothing(t.value),e.node(t.property)}function pc(t,e){e.nodeOrNothing(t.value)&&e.put("."),e.node(t.property)}var Ir={};O(Ir,{compile:()=>fc,stringify:()=>dc,walk:()=>mc});function fc(t,e){e.put(t.name)}function mc(){}function dc(t,e){e.put(t.name)}var Or={};O(Or,{compile:()=>hc,stringify:()=>yc,walk:()=>gc});function hc(t,e){e.put(typeof t.value=="string"?JSON.stringify(t.value):String(t.value))}function gc(){}function yc(t,e){e.put(typeof t.value=="string"?JSON.stringify(t.value):String(t.value))}var Mr={};O(Mr,{compile:()=>Ac,stringify:()=>bc,walk:()=>Tc});function Ac(t,e){e.put(e.buildinFn("map")),e.put("("),e.nodeOrCurrent(t.value),e.put(",$=>"),e.createScope(()=>e.node(t.query),r=>(e.put(")"),"("+r+",")),e.put(")")}function Tc(t,e){e.nodeOrNothing(t.value),e.node(t.query)}function bc(t,e){e.nodeOrNothing(t.value),e.put(".("),e.node(t.query),e.put(")")}var Fr={};O(Fr,{compile:()=>Cc,stringify:()=>Ec,walk:()=>Sc});function Cc(t,e){e.put(e.buildinFn("mapRecursive")),e.put("("),e.nodeOrCurrent(t.value),e.put(",$=>"),e.createScope(()=>e.node(t.query),r=>(e.put(")"),"("+r+",")),e.put(")")}function Sc(t,e){e.nodeOrNothing(t.value),e.node(t.query)}function Ec(t,e){e.nodeOrNothing(t.value),e.put(".."),e.isSimpleGetPropertyQuery(t.query)||e.isSimpleMethodCallQuery(t.query)?e.node(t.query):(e.put("("),e.node(t.query),e.put(")"))}var Rr={};O(Rr,{compile:()=>wc,stringify:()=>_c,suggest:()=>kc,walk:()=>xc});function kc(t,e){t.arguments.length===0&&e.queryRoot(t.range[1]-1)}function wc(t,e,r){let n=t.reference.type==="Identifier";e.tolerant&&e.put("(typeof "),n&&(e.usedMethods.has(t.reference.name)?e.usedMethods.get(t.reference.name).push(t.reference.range):e.usedMethods.set(t.reference.name,[t.reference.range]),e.put("m.")),e.node(t.reference),e.tolerant&&(e.put('==="function"?'),n&&e.put("m."),e.node(t.reference)),e.put(n?".call(mctx,":"("),e.nodeOrCurrent(r),t.arguments.length&&(e.put(","),e.list(t.arguments,",")),e.put(")"),e.tolerant&&e.put(":undefined)")}function xc(t,e){e.node(t.reference),e.list(t.arguments)}function _c(t,e){e.node(t.reference),e.put("("),e.list(t.arguments,","),e.put(")")}var Dr={};O(Dr,{compile:()=>Pc,stringify:()=>Ic,walk:()=>Nc});function Pc(t,e){e.node(t.method,t.value)}function Nc(t,e){e.nodeOrNothing(t.value),e.node(t.method)}function Ic(t,e){e.nodeOrNothing(t.value)&&e.put("."),e.node(t.method)}var Br={};O(Br,{compile:()=>Mc,stringify:()=>Rc,suggest:()=>Oc,walk:()=>Fc});function Oc(t,e){t.properties.length===0&&e.queryRoot(t.range[0]+1,t.range[1]-1)}function Mc(t,e){e.put("{"),e.list(t.properties,","),e.put("}")}function Fc(t,e){e.list(t.properties)}function Rc(t,e){e.put("{"),e.list(t.properties,","),e.put("}")}var vr={};O(vr,{compile:()=>vc,stringify:()=>Lc,suggest:()=>Bc,walk:()=>Uc});var Dc=new Set(["Literal","Identifier","Reference","Current"]);function Bc(t,e){if(t.value===null)switch(t.key.type){case"Literal":case"Identifier":e.range(t.range,"path"),e.range(t.range,"var");break;case"Current":case"Reference":e.range(t.range,"var");break}}function vc(t,e){let r=t.value;switch(t.key.type){case"Current":e.put("...null");return;case"Literal":e.node(t.key),r=r||Ue(null,Le(String(t.key.value)));break;case"Identifier":e.node(t.key),r=r||Ue(null,Le(t.key.name));break;case"Reference":e.node(t.key.name),r=r||t.key;break;default:e.put("["),e.node(t.key),e.put("]")}e.put(":"),e.node(r)}function Uc(t,e){e.node(t.key),e.nodeOrNothing(t.value)}function Lc(t,e){if(Dc.has(t.key.type)){if(e.node(t.key),t.value===null)return}else e.put("["),e.node(t.key),e.put("]");e.put(":"),e.node(t.value)}var Ur={};O(Ur,{compile:()=>jc,stringify:()=>qc,walk:()=>Vc});function jc(t,e){e.put("("),e.node(t.body),e.put(")")}function Vc(t,e){e.node(t.body)}function qc(t,e){e.put("("),e.node(t.body),e.put(")")}var Lr={};O(Lr,{compile:()=>$c,stringify:()=>Gc,suggest:()=>zc,walk:()=>Hc});function zc(t,e){if(t.getter===null){let r=t.range[1]-1;e.range([r,r],"key",t.value,!1),e.queryRoot(r)}else(t.getter.type==="GetProperty"||t.getter.type==="Reference"||t.getter.type==="Literal"&&typeof t.getter.value=="string")&&e.range(t.getter.range,"key",t.value,!1)}function $c(t,e){e.put(e.buildinFn("pick")),e.put("("),e.node(t.value),t.getter&&(e.put(","),e.node(t.getter)),e.put(")")}function Hc(t,e){e.node(t.value),t.getter!==null&&e.node(t.getter)}function Gc(t,e){e.node(t.value),e.put("["),t.getter!==null&&e.node(t.getter),e.put("]")}var jr={};O(jr,{compile:()=>Wc,stringify:()=>Jc,walk:()=>Yc});function Wc(t,e){e.put("($=>("),e.createScope(()=>e.node(t.right),r=>r+","),e.put("))"),e.put("("),e.nodeOrCurrent(t.left),e.put(")")}function Yc(t,e){e.node(t.left),e.node(t.right)}function Jc(t,e){e.node(t.left),e.put("|"),e.node(t.right)}var Vr={};O(Vr,{compile:()=>Xc,stringify:()=>Qc,suggest:()=>Kc,walk:()=>Zc});function Kc(t,e){e.queryRoot(t.range[1])}function Xc(t,e){e.put(e.scope.$ref)}function Zc(){}function Qc(){}var qr={};O(qr,{compile:()=>eu,stringify:()=>ru,walk:()=>tu});function eu(t,e){if(t.operator&&t.operator.type){e.put("($=>("),e.createScope(()=>e.node(t.operator),r=>r+","),e.put("))"),e.put("("),e.node(t.argument),e.put(")");return}e.error('Unknown operator "'+t.operator+'"',t)}function tu(t,e){e.node(t.argument),t.operator&&t.operator.type&&e.node(t.operator)}function ru(t,e){e.node(t.argument),e.put(" "),e.node(t.operator)}var zr={};O(zr,{compile:()=>nu,stringify:()=>su,walk:()=>ou});function nu(t,e){switch(t.operator){case"no":case"not":e.put("!"),e.put(e.buildinFn("bool")),e.put("("),e.node(t.argument),e.put(")");break;case"+":case"-":e.put(t.operator),e.node(t.argument);break;case"is":e.put("!!("),e.node(t.argument),e.put(")");break;default:e.error('Unknown operator "'+t.operator+'"',t)}}function ou(t,e){e.node(t.argument),t.operator&&t.operator.type&&e.node(t.operator)}function su(t,e){e.put(t.operator),t.operator!=="-"&&t.operator!=="+"&&e.put(" "),e.node(t.argument)}var $r={};O($r,{compile:()=>au,stringify:()=>cu,suggest:()=>iu,walk:()=>lu});function iu(t,e){t.range&&e.range(t.range,"var")}function au(t,e){let r=t.name,n=e.scope.has(r.name),s=e.scope.awaitInit.has(r.name);if(!n||s){s?(e.put("f.unsafeRef(()=>$"),e.node(r),e.tolerant||(e.put(","),e.put(JSON.stringify(r.name)),e.put(","),e.put(JSON.stringify(r.range))),e.put(")")):e.tolerant?e.put("undefined"):e.error(`$${r.name} is not defined`,r);return}e.put("$"),e.node(r)}function lu(t,e){e.node(t.name)}function cu(t,e){e.put("$"),e.node(t.name)}var Hr={};O(Hr,{compile:()=>uu,stringify:()=>fu,walk:()=>pu});function uu(t,e){e.put(e.buildinFn("slice")),e.put("("),e.nodeOrCurrent(t.value),t.arguments.slice(0,3).forEach(r=>{e.put(","),r?e.node(r):e.put("undefined")}),e.put(")")}function pu(t,e){e.nodeOrNothing(t.value);for(let r of t.arguments.slice(0,3))r&&e.node(r)}function fu(t,e){let[r,n,s]=t.arguments;e.nodeOrNothing(t.value),e.put("["),r&&e.node(r),e.put(":"),n&&e.node(n),s&&(e.put(":"),e.node(s)),e.put("]")}var Gr={};O(Gr,{compile:()=>du,stringify:()=>gu,suggest:()=>mu,walk:()=>hu});function mu(t,e){t.query===null&&e.queryRoot(t.range[1])}function du(t,e){if(t.array){e.put("..."),e.put(e.buildinFn("ensureArray")),e.put("("),e.nodeOrCurrent(t.query),e.put(")");return}e.put("..."),e.nodeOrCurrent(t.query)}function hu(t,e){e.nodeOrNothing(t.query)}function gu(t,e){e.put("..."),e.nodeOrNothing(t.query)}var Wr={};O(Wr,{compile:()=>Au,stringify:()=>bu,suggest:()=>yu,walk:()=>Tu});function yu(t,e){for(let[r,n]of Object.entries(t.values))n===null&&e.queryRoot(t.values[Number(r)-1].range[1])}function Au(t,e){for(let[r,n]of Object.entries(t.values)){let s=Number(r);n!==null&&(s!==0&&e.put("+"),s%2===0?e.put('"'+Go(n.value,Cu)+'"'):(e.put("("),e.node(n),e.put(")")))}}function Tu(t,e){for(let r of t.values)r!==null&&e.node(r)}function bu(t,e){let r=t.values.length-1;for(let[n,s]of Object.entries(t.values)){let o=Number(n);o%2===0?(e.put(o===0?"`":"}"),e.put(Go(s.value,Su)),e.put(o===r?"`":"${")):s!==null&&e.node(s)}}var Cu=new Map([["\b","\\b"],[`
`,"\\n"],["\r","\\r"],["\f","\\f"],["	","\\t"],["\v","\\v"],["\u2028","\\u2028"],["\u2029","\\u2029"],["\\","\\\\"],['"','\\"']]),Su=new Map([["\b","\\b"],["\f","\\f"],["	","\\t"],["\v","\\v"],["\\","\\\\"],["$","\\$"]]);function Go(t,e){let r="";for(let n=0;n<t.length;n++)r+=e.get(t[n])||t[n];return r}var Eu={Arg1:dr,Array:hr,Assertion:gr,Binary:yr,Block:Ar,Compare:Tr,Conditional:Cr,Context:Sr,Current:Er,Data:kr,Declarator:wr,Definition:xr,Filter:_r,Function:Pr,GetProperty:Nr,Identifier:Ir,Literal:Or,Map:Mr,MapRecursive:Fr,Method:Rr,MethodCall:Dr,Object:Br,ObjectEntry:vr,Parentheses:Ur,Pick:Lr,Pipeline:jr,Placeholder:Vr,Postfix:qr,Prefix:zr,Reference:$r,SliceNotation:Hr,CompareFunction:br,Spread:Gr,Template:Wr},je=t=>new Map(Object.entries(Eu).map(([e,r])=>[e,r[t]]).filter(([,e])=>typeof e=="function")),ku={};je("build").forEach((t,e)=>ku[e]=t);var Yr=je("compile"),Jr=je("walk"),Kr=je("stringify"),Xr=je("suggest");function Ve(t,e){function r(i){if(Jr.has(i.type))s(i),Jr.get(i.type)(i,n),o(i);else throw new Error('Unknown node type "'+i.type+'"')}let n={node:r,nodeOrNothing(i){i!==null&&r(i)},list(i){i.forEach(r)}},s=()=>{},o=()=>{};typeof e=="function"&&(e={enter:e}),e&&(typeof e.enter=="function"&&(s=e.enter),typeof e.leave=="function"&&(o=e.leave)),r(t)}function Wo(t,e){return e>=0&&e<t.length&&/[a-zA-Z_$0-9]/.test(t[e])}function Zr(t,e){let r=t.charCodeAt(e);return r===9||r===10||r===13||r===32}function wu(t,e,r){for(;e<r;e++)if(!Zr(t,e))return!1;return!0}function xu(t,e,r,n,s){let o=[];for(let i=0;i<n.length;i++){let[a,l]=n[i];if(a>=e)break;a<t||(o.push(t,a),t=l)}return(t!==r.length||!s)&&o.push(t,e),o}function _u(t,e,r,n){let s=[];for(let o=0;o<t.length;o++){let[i,a,l,c]=t[o];if(wu(e,i,a)){for(;i>=0&&Zr(e,i-1);)i--;for(;a<e.length&&Zr(e,a);)a++;if(Wo(e,i-1)){if(i===a)continue;i++}if(Wo(e,a)){if(i===a)continue;a--}}let p=xu(i,a,e,r,n);for(let u=0;u<p.length;u+=2)s.push([p[u],p[u+1],l,c])}return s}function Pu(t){let e=null,r=[],n=Object.assign(new Map,{literalList:r}),s=(i,a)=>{n.has(i)?n.get(i).push(a):n.set(i,[a])},o={range(i,a,l=e,c=!0){s(l,[...i,a,c])},literalList(i){let a="l"+r.length;return r.push([a,i]),a},queryRoot(i,a=i){s(e,[i,a,"var",!0]),s(e,[i,a,"path",!0])}};return Ve(t,i=>{if(Xr.has(i.type)){let a=e;e=i,Xr.get(i.type)(i,o),e=a}}),n}function At(t,{ast:e,commentRanges:r}){let n=Pu(e),s=r.length&&r[r.length-1][1]===t.length&&!/[\r\n]$/.test(t);for(let[o,i]of n)n.set(o,_u(i,t,r,s));return n}function Nu(t){return t.type==="GetProperty"}function Iu(t){return t.type==="MethodCall"}function Tt(t){function e(s){if(Kr.has(s.type))Kr.get(s.type)(s,n);else throw new Error('Unknown node type "'+s.type+'"')}let r=[],n={isSimpleGetPropertyQuery:Nu,isSimpleMethodCallQuery:Iu,put(s){r.push(s)},node:e,nodeOrNothing(s){if(s!==null)return e(s),!0},list(s,o){if(!o){s.forEach(e);return}s.forEach((i,a)=>{a>0&&n.put(o),e(i)})}};return e(t),r.join("")}function Qr(t,e,r){let n=Object.assign(Object.create(SyntaxError.prototype),r),s=new Error;return n.name=t,n.message=e,Object.defineProperty(n,"stack",{get:function(){return(s.stack||"").replace(/^(.+\n){1,3}/,t+": "+e+`
`)}}),n}function tn(t,e,r){return Yo(t,"query",e,r)}function rn(t,e,r){return Yo(t,"method",e,r)}var en=class t extends Set{constructor(e,r=[],n=!1,s="$"){super(e),this.own=new Set,this.awaitInit=new Set(r),this.firstCurrent=null,this.captureCurrent=[],this.arg1=n,this.$ref=s}spawn(e,r){return new t(this,this.awaitInit,e,r)}};function Yo(t,e,r=!1,n=null){function s(h){let y="s"+c.length;return c.push(h?[y,h]:[y]),y}function o(h){let y=p.get(h);return y||p.set(h,y=s()),y}function i(h,y,T,C,b){let E=[h,y,JSON.stringify(T)];if(T==="var"){if(!A.scope.size)return;E.push(JSON.stringify([...A.scope]))}else C||(C=s()),E.push(C),b&&E.push(typeof b=="string"?b:o(b));return f.push(E),C}function a(h,y,T="$"){let C=A.scope,b=m.length-1;if(A.scope=C.spawn(C.arg1||e==="method",T),h(),A.scope.captureCurrent.length){let S="stat("+A.scope.captureCurrent.reduce((k,w)=>i(...w,k),void 0)+","+A.scope.$ref+")";A.scope.firstCurrent?m[A.scope.firstCurrent]=S:m[b]+=y(S)}A.scope=C}function l(h,y){let T=!1;if(n!==null){if(n.has(h))for(let[C,b,E,S]of n.get(h))E==="var"?i(C,b,E):S===!0?A.scope.captureCurrent.push([C,b,E]):(T||(T=o(h),m.push("stat("+T+",")),E&&i(C,b,E,T,S));h.type==="Current"&&A.scope.firstCurrent===null&&(A.scope.firstCurrent=m.length)}if(Yr.has(h.type))Yr.get(h.type)(h,A,y);else throw new Error('Unknown node type "'+h.type+'"');T&&m.push(")")}let c=[],p=new WeakMap,u=[],f=[],m=[{toString(){if(e==="query")return["((data,context)=>{",...A.usedMethods.size||A.usedAssertions.size?["const method = (name,...args)=>m[name].apply(mctx,args);","const assertion = (name,...args)=>a[name].apply(mctx,args);","const mctx = Object.freeze({context,method,assertion});"]:[]].join(`
`)+`
`;if(e==="method")return["(function(data){","const mctx = this;","const context = mctx.context;"].join(`
`)+`
`;throw new Error("Unknown kind: "+e)}},{toString(){return u.length>0?"let "+u+`;
`:""}},{toString(){return c.length>0?[`const stat=(s,v)=>(s.add(v),v);
`,"const "+c.map(([h,y])=>h+"=new Set("+(y?JSON.stringify(y):"")+")")+`;
`].join(""):""}},{toString(){let h=n&&Array.isArray(n.literalList)&&n.literalList.map(([y,T])=>y+"="+JSON.stringify(T));return h&&h.length?"const "+h+`;
`:""}},n===null?"return ":`return{
value: `],d={},g=new Set,A={tolerant:r,usedAssertions:new Map,usedMethods:new Map,suggestions:n!==null,buildinFn(h){return g.add(h),"f."+h},scope:new en,createScope:a,error:(h,y)=>{let T=new SyntaxError(h);if(y&&y.range&&(T.details={loc:{range:y.range}}),!r)throw T},allocateVar(){let h="tmp"+u.length;return u.push(h),h},put:h=>m.push(h),node:l,nodeOrCurrent(h,y){l(h||{type:"Current"},y)},list(h,y,T){h.forEach((C,b)=>{b>0&&m.push(y),l(C,T)})}};if(a(()=>l(t),h=>(m.push(")"),"("+h+","),"data"),!r){let{usedMethods:h,usedAssertions:y}=A;y.size&&(m.unshift(" this.assertAssertions(a)||"),d.assertAssertions=function(T){for(let[C,b]of y.entries())if(!z(T,C))return()=>{throw Object.assign(new Error(`Assertion "${C}" is not defined`),{details:{loc:{range:b}}})}}),h.size&&(m.unshift(" this.assertMethods(m)||"),d.assertMethods=function(T){for(let[C,b]of h.entries())if(!z(T,C))return()=>{throw Object.assign(new Error(`Method "${C}" is not defined. If that's a custom method make sure you added it with "methods" section in options`),{details:{loc:{range:b[0]}}})}})}n!==null&&m.push(`,
stats: [`+f.map(h=>"["+h+"]")+`],
methods: m,
assertions: a
}`);try{let h=new Function("f,m,a","return"+m.join("")+"})");return Object.assign(h.bind(d),{toString(){return h.toString().replace(/^(\S+\s+)anonymous([^)\s]+)\s*\)/,"$1query$2)")}})}catch(h){throw Qr("SyntaxError","Jora query compilation error",{compiledSource:m.join(""),details:h})}}var Jo=t=>typeof t=="number"||typeof t=="string",Q=(t,e)=>e<t.length?t.charCodeAt(e):0,qe=t=>t===43||t===45,re=t=>t>=48&&t<=57,nn=t=>t===9||t===10||t===12||t===13||t===32,on=t=>t>32&&t<256&&(t<65||t>90)&&(t<97||t>122)&&!re(t)&&!qe(t)||t===8470,Ou=t=>t&&!nn(t)&&!on(t)&&!re(t),Mu=(t,e,r)=>qe(t)?re(e)?2:e===46&&re(r)?3:0:re(t)?1:0,Ee=(t,e,r)=>{for(;r(Q(t,++e)););return e},Fu=(t,e,r)=>{let n=Q(t,e);if(qe(n)&&(n=Q(t,e+=1)),re(n)&&(e=Ee(t,e,re),n=Q(t,e)),n===46&&re(Q(t,e+1))){if(r)return e;let s=Ee(t,e+1,re);if(n=Q(t,s),n===46)return e;e=s}if(n===69||n===101){let s=1;n=Q(t,e+1),qe(n)&&(s=2,n=Q(t,e+2)),re(n)&&(e=Ee(t,e+s,re))}return e},Ko=(t,e,r,n)=>{if(e>=t.length)return 0;let s=Q(t,e);return nn(s)?1|Ee(t,e,nn)-e<<4:on(s)||n&&qe(s)?2|Ee(t,e,on)-e<<4:Mu(s,Q(t,e+1),Q(t,e+2))?4|Fu(t,e,r)-e<<4:8|Ee(t,e,Ou)-e<<4},Ru=(t,e,r)=>{let n=0,s=0,o=!1,i=!1,a=0,l=0,c=!0;for(;;){let p=Ko(t,n,o,i),u=Ko(e,s,o,i),f=p&15,m=p>>4,d=u&15,g=u>>4;if(f!==d){if(c&&f&3&&d&12){a=1,l=f,n+=m;continue}if(c&&d&3&&f&12){a=-1,l=d,s+=g;continue}return f-d}if(f===0)return a;c=!1,o=!1,i=!1;let A=m<g?m:g,h=m-g,y="",T="";for(let C=0;C<A;C++)if(y=t[n+C],T=e[s+C],y!==T){h=y<T?-1:1;break}if(f&3)o=t[n+m-1]===".",h!==0&&f>l&&(l=f,a=h);else if(f&4){if(i=!0,h!==0){let C=t.substr(n,m)-e.substr(s,g);if(C!==0)return r?-C:C;if(f>l){let b=Q(t,n),E=Q(e,s),S=b===45?-1:1;l=f,a=b!==E&&(b===45||E===43)?-1:b!==E&&(b===43||E===45)?1:(m-g||h)<0?-S:S,r&&(a=-a)}}}else if(h!==0){if(y!==T){let C=t.substr(n,m),b=e.substr(s,g),E=C.toLowerCase(),S=b.toLowerCase();return E!==S?E<S?-1:1:C<b?-1:1}return h}n+=m,s+=g}},Xo=t=>(e,r)=>Jo(e)&&Jo(r)?Math.sign(Ru(String(e),String(r),t)):0,Zo=Xo(!1),Qo=Xo(!0);var Du=1,Bu=2,ke=3,ze=4,vu=5,Uu=6,Lu=7,ju=8;function ae(t){switch(typeof t){case"boolean":return Du;case"number":return t!==t?Bu:ke;case"string":return ze;case"object":return t===null?vu:Uu;case"undefined":return ju;default:return Lu}}function we(t,e){let r=ae(t),n=ae(e);return r!==n?r<n?-1:1:t<e?-1:t>e?1:0}function es(t,e){let r=ae(t),n=ae(e);return r!==n?r<n?-1:1:r===ke?e-t:t<e?-1:t>e?1:0}function fe(t,e){let r=ae(t),n=ae(e);return(r===ke||r===ze)&&(n===ke||n===ze)?Zo(t,e):r!==n?r<n?-1:1:t<e?-1:t>e?1:0}function ts(t,e){let r=ae(t),n=ae(e);return(r===ke||r===ze)&&(n===ke||n===ze)?Qo(t,e,!0):r!==n?r<n?-1:1:t<e?-1:t>e?1:0}function sn(t,e){return t.length===1?(r,n)=>e(t(r),t(n)):t}var J=Object.freeze({unsafeRef:Vu,ensureArray:qu,bool:Z,and:(t,e)=>Z(t)?e:t,or:(t,e)=>Z(t)?t:e,add:zu,sub:$u,mul:Hu,div:Gu,mod:Wu,eq:Yu,ne:Ju,lt:Ku,lte:Xu,gt:Zu,gte:Qu,in:bt,notIn:(t,e)=>!bt(t,e),has:(t,e)=>bt(e,t),hasNo:(t,e)=>!bt(e,t),cmp:we,cmpAnalytical:es,cmpNatural:fe,cmpNaturalAnalytical:ts,match:ep,pick:tp,indexOf:rp,lastIndexOf:np,map:an,mapRecursive:sp,some:ln,filter:ip,slice:ap});function Vu(t,e,r){try{return t()}catch{if(e)throw Object.assign(new ReferenceError(`Cannot access $${e} before initialization`),{details:{name:e,loc:{range:r}}})}}function qu(t){return D(t)?t:[t]}function zu(t,e){return D(t)||D(e)?[...new Set([...D(t)?t:[t],...D(e)?e:[e]])]:t+e}function $u(t,e){if(D(t)){let r=new Set(t);return D(e)?e.forEach(n=>r.delete(n)):r.delete(e),[...r]}return t-e}function Hu(t,e){return t*e}function Gu(t,e){return t/e}function Wu(t,e){return t%e}function Yu(t,e){return Object.is(t,e)}function Ju(t,e){return!Object.is(t,e)}function Ku(t,e){return t<e}function Xu(t,e){return t<=e}function Zu(t,e){return t>e}function Qu(t,e){return t>=e}function bt(t,e){return te(e)?z(e,t):e?rs(e,t)!==-1:!1}function ep(t,e){return typeof e=="function"?ln(t,e):ie(e)?ln(t,e.test.bind(e)):e==null}function tp(t,e=()=>!0){if(t){if(typeof e=="function"){if(D(t)||typeof t=="string"){for(let r=0;r<t.length;r++)if(Z(e(t[r],r)))return t[r]}for(let r in t)if(z(t,r)&&Z(e(t[r],r)))return t[r];return}return D(t)||typeof t=="string"?isFinite(e)?t[e<0?t.length+Number(e):Number(e)||0]:void 0:z(t,e)?t[e]:void 0}}function rp(t,e,r){return t?rs(t,e,r):-1}function rs(t,e,r=0){if(Number.isNaN(e)&&se(t)){for(let n=pe(r,0);n<t.length;n++)if(Number.isNaN(t[n]))return n}return typeof t.indexOf=="function"?t.indexOf(e,r):-1}function np(t,e,r){return t?op(t,e,r):-1}function op(t,e,r){if(Number.isNaN(e)&&se(t)){for(let n=pe(r,t.length-1);n>=0;n--)if(Number.isNaN(t[n]))return n}return typeof t.lastIndexOf=="function"?t.lastIndexOf(e,pe(r,t.length-1)):-1}function an(t,e){let r=typeof e=="function"?e:n=>zo(n,e);return D(t)?[...t.reduce((n,s)=>Se(n,r(s)),new Set)]:t!==void 0?r(t):t}function sp(t,e){let r=new Set;return Se(r,an(t,e)),r.forEach(n=>Se(r,an(n,e))),[...r]}function ln(t,e){return D(t)?t.some(r=>Z(e(r))):Z(e(t))}function ip(t,e){return D(t)?t.filter(r=>Z(e(r))):Z(e(t))?t:void 0}function ap(t,e,r,n=1){if(!se(t))return[];if(e=pe(e,0),r=pe(r,t.length),n=pe(n,1)||1,e=e<0?Math.max(0,t.length+e):Math.min(t.length,e),r=r<0?Math.max(0,t.length+r):Math.min(t.length,r),e>=0&&r>=0&&e<=r&&n===1)return typeof t=="string"?t.slice(e,r):Array.prototype.slice.call(t,e,r);e>r&&([e,r]=[r,e],n=-n);let s=[];if(n>0)for(let o=e;o<r;o+=n)s.push(t[o]);else for(let o=r-1;o>=e;o+=n)s.push(t[o]);return typeof t=="string"?s.join(""):s}var lp=ns(20)?1/0:ns(10)?10:0;function ns(t){return Array.from({length:t},(e,r)=>({idx:r})).sort((e,r)=>e.idx%2-r.idx%2).every((e,r)=>r<t/2?e.idx>>1===r:Math.ceil(t/2)+(e.idx>>1)===r)}function os(t,e){return t.length<=lp?t.slice().sort(e):t.map((r,n)=>({value:r,idx:n})).sort((r,n)=>(r.value===void 0?n.value!==void 0:n.value===void 0?-1:e(r.value,n.value))||r.idx-n.idx).map(r=>r.value)}var cp=(t,e)=>t-e,up=(t,e)=>e-t,Ct=class{constructor(e,r,n,s=!1){this.maxSize=e||1/0,this.compare=r||up,this.accept=n||null,this.values=[],this.valuesSet=s?new Set:null}add(e){this.accept!==null&&!this.accept(e)||this.valuesSet!==null&&this.valuesSet.has(e)||(this.values.length<this.maxSize?(this.valuesSet!==null&&this.valuesSet.add(e),this.values.push(e),this.heapifyUp(this.values.length-1)):this.compare(this.values[0],e)>0&&(this.valuesSet!==null&&(this.valuesSet.delete(this.values[0]),this.valuesSet.add(e)),this.values[0]=e,this.heapifyDown()))}addArray(e){for(let r=0;r<e.length;r++)this.add(e[r])}extract(){let e=this.values[0],r=this.values.pop();return this.values.length>0&&(this.values[0]=r,this.heapifyDown()),this.valuesSet!==null&&this.valuesSet.delete(e),e}heapifyUp(e){let r=this.values,n=r[e];for(;e>0;){let s=e-1>>1,o=r[s];if(this.compare(o,n)>0)break;r[s]=n,r[e]=o,e=s}}heapifyDown(){let e=this.values,r=e.length,n=r>>1,s=0,o=e[s],i=s,a=o;for(;s<n;){let l=2*s+1,c=e[l],p=l+1;if(this.compare(c,o)>0&&(i=l,a=c),p<r){let u=e[p];this.compare(u,a)>0&&(i=p,a=u)}if(i===s)break;e[s]=a,e[i]=o,s=i,a=o}}[Symbol.iterator](){return this.values.slice().sort(this.compare)[Symbol.iterator]()}},le=class extends Ct{},St=class extends Ct{constructor(e,r,n,s){super(e,r?(o,i)=>-r(o,i):cp,n,s)}};var pp=t=>t;function fp(t){return t!==null&&typeof t=="object"?NaN:Number(t)}function xe(t,e,r){if(se(t)){typeof e!="function"&&(e=pp);for(let n of t){let s=e(n);s!==void 0&&r(fp(s))}}}function ss(t,e,r,n,s){if(t.length===0||!isFinite(e)||e<0||e>100)return;let o=0,i=e*(t.length-1)/100,a=Math.floor(i),l=Math.ceil(i),c=!1,p=e<50?new St(l+1,s):new le(t.length-a,s);if(xe(t,r,u=>{Number.isNaN(u)&&(c=!0),p.add(u),o++}),c)return NaN;if(t.length!==o){if(o===0)return;i=e*(o-1)/100,a=Math.floor(i),l=Math.ceil(i);let u=e<50?l+1:o-a;for(let f=p.values.length;f>u;f--)p.extract()}if(a!==l){let u=p.extract(),f=p.values[0];return u<=f?u+(f-u)*(i-a):f+(u-f)*(i-a)}return p.values[0]}var mp=t=>t;function is(t,e){let r,n=0,s=0;return xe(t,e,o=>{if(s++,r===void 0)r=o;else{let i=r,a=Math.abs(i),l=Math.abs(o);r+=o,a!==1/0&&l!==1/0&&(a>=l?n+=i-r+o:n+=o-r+i)}}),r!==void 0&&(r+=n),{sum:r,count:s}}function as(t,e){let r=[];return xe(t,e,r.push.bind(r)),r}function ls(t,e){let r=0;if(se(t)){typeof e!="function"&&(e=mp);for(let n of t)e(n)!==void 0&&r++}return r}function cs(t,e){return is(t,e).sum}function us(t,e){let{sum:r,count:n}=is(t,e);if(n>0)return r/n}function cn(t,e){let r=0,n=0,s=0;if(xe(t,e,o=>{r+=1;let i=o-n;n+=i/r,s+=i*(o-n)}),r>0)return s/r}function ps(t,e){let r=cn(t,e);if(r!==void 0)return Math.sqrt(r)}function fs(t,e=fe){let r;if(t&&isFinite(t.length)&&typeof e=="function"){e=sn(e,fe);for(let n=0;n<t.length;n++){let s=t[n];(r===void 0||e(s,r)<0)&&e(s,void 0)!==0&&(r=s)}}return r}function ms(t,e=fe){let r;if(t&&isFinite(t.length)&&typeof e=="function"){e=sn(e,fe);for(let n=0;n<t.length;n++){let s=t[n];(r===void 0||e(s,r)>=0)&&e(s,void 0)!==0&&(r=s)}}return r}function Et(t,e,r){if(se(t))return ss(t,e,r)}function ds(t,e){return Et(t,50,e)}function dp(){}function hp(t){return t}function hs(t){return t===null?null:{matched:t.slice(),start:t.index,end:t.index+t[0].length,input:t.input,groups:t.groups||null}}function gp(t){let e=t.pop(),r=typeof e=="string"?null:e,n=r===null?e:t.pop(),s=t.pop();return{matched:t,start:s,end:s+t[0].length,input:n,groups:r}}var yp=String.prototype.replaceAll||function(t,e){return ie(t)?this.replace(t,e):this.split(t).join(String(e))},$e=Object.freeze({bool:J.bool,filter:J.filter,map:J.map,pick:J.pick,indexOf:J.indexOf,lastIndexOf:J.lastIndexOf,keys(t){return Object.keys(t||{})},values(t){let e=new Set;for(let r in t)z(t,r)&&Se(e,t[r]);return[...e]},entries(t){let e=[];for(let r in t)z(t,r)&&e.push({key:r,value:t[r]});return e},fromEntries(t){let e=Object.create(null);if(Array.isArray(t))for(let r of t)r&&(e[r.key]=r.value);return e},size(t){return te(t)?Object.keys(t).length:t&&t.length||0},sort(t,e=we){if(!D(t))return t;if(typeof e=="function"&&e.length!==2){let r=e;e=(n,s)=>{if(n=r(n),s=r(s),Array.isArray(n)&&Array.isArray(s)){if(n.length!==s.length)return n.length<s.length?-1:1;for(let o=0;o<n.length;o++){let i=we(n[o],s[o]);if(i!==0)return i}return 0}return we(n,s)}}return os(t,e)},reverse(t){return D(t)?t.slice().reverse():t},slice(t,e,r){return typeof t=="string"||D(t)?t.slice(e,r):Array.prototype.slice.call(t,e,r)},group(t,e,r){let n=new Map,s=[];typeof e!="function"&&(e=dp),typeof r!="function"&&(r=hp),D(t)||(t=[t]);for(let o of t){let i=e(o);if(D(i))if(i.length>0){let a=r(o);for(let l of i)ht(n,l,a)}else ht(n,void 0,r(o));else ht(n,i,r(o))}for(let[o,i]of n)s.push({key:o,value:[...i]});return s},join(t,e){return D(t)?t.join(e):String(t)},match(t,e,r){let n=String(t),s=ie(e)?e.flags:"";if(r||s.includes("g")){let o=[],i=new RegExp(e,(s||"").replace(/g|$/,"g")),a;for(;a=i.exec(n);)o.push(hs(a));return o}return hs(n.match(e))},reduce(t,e,r=void 0){return D(t)?r!==void 0?t.reduce((n,s)=>e(s,n),r):t.reduce((n,s)=>e(s,n)):e(t,r)},split(t,e){if(D(t)){let r=typeof e=="function"?e:Object.is.bind(null,e),n=[],s=0,o=0;for(;o<t.length;o++)r(t[o])&&(n.push(t.slice(s,o)),s=o+1);return n.push(t.slice(s,o)),n}return String(t).split(e)},replace(t,e,r){if(D(t)){let n=typeof e=="function"?e:Object.is.bind(null,e),s=[...t];for(let o=0;o<s.length;o++){let i=s[o];n(i)&&(s[o]=typeof r=="function"?r(i):r)}return s}return ie(e)&&!e.flags.includes("g")&&(e=new RegExp(e,e.flags+"g")),yp.call(String(t),e,typeof r=="function"?(...n)=>r(gp(n)):r)},toLowerCase(t,e){return String(t).toLocaleLowerCase(e)},toUpperCase(t,e){return String(t).toLocaleUpperCase(e)},trim(t){return String(t).trim()},...["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log10","log2","pow","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].reduce((t,e)=>(t[e]=Math[e],t),{}),ln:Math.log,ln1p:Math.log1p,numbers:as,count:ls,sum:cs,avg:us,variance:cn,stdev:ps,min:fs,max:ms,percentile:Et,p:Et,median:ds});var He=Object.freeze({function:t=>typeof t=="function",symbol:t=>typeof t=="symbol",primitive:t=>t===null||typeof t!="object"&&typeof t!="function",string:t=>typeof t=="string",number:t=>typeof t=="number",int:Number.isInteger,finite:t=>Number.isFinite(t),nan:t=>Number.isNaN(t),infinity:t=>t===1/0||t===-1/0,boolean:t=>t===!0||t===!1,null:t=>t===null,undefined:t=>t===void 0,nullish:t=>t==null,object:te,array:D,regexp:ie,truthy:Z,falsy:t=>!Z(t)});var Ap={path:"property",key:"value",value:"value","in-value":"value","value-subset":"value",var:"variable",assertion:"assertion"};function kt(t,e){Object.keys(t).forEach(e.add,e)}function Tp(t,e,r,n=new Set){let s=o=>{switch(typeof o){case"string":case"number":n.add(o);break}};switch(t){case"path":{let o=new Set;for(let i of e)if(Array.isArray(i))for(let a of i)te(a)&&kt(a,o);else te(i)&&kt(i,o);o.forEach(n.add,n);break}case"key":{let o=new Set;for(let i of e)i!==null&&typeof i=="object"&&!Array.isArray(i)&&kt(i,o);o.forEach(n.add,n);break}case"value":for(let o of e)s(o);break;case"in-value":{let o=new Set;for(let i of e)D(i)?i.forEach(s):te(i)&&kt(i,o);o.forEach(n.add,n);break}case"var":for(let o of e)n.add("$"+o);break;case"value-subset":{let o=new Set(r);for(let i of e)o.has(i)||s(i);break}}return n}function gs(t,e,r,n=!1){let s=[];for(let[o,i,a,l,c=null]of r)if(e>=o&&e<=i&&(n||l.size||l.length)){let p=t.substring(o,i);/\S/.test(p)||(o=i=e,p=""),s.push({context:a,from:o,to:i,text:p,values:l,related:c})}return s}function ys(t,e){return typeof t=="function"?t:t===!0?e:!1}function As(t){if(/^(["']).*\1$/.test(t))try{return t[0]==="'"&&(t=`"${t.slice(1,-1).replace(/\\.|"/g,e=>e==="\\'"?"'":e==='"'?'\\"':e)}"`),JSON.parse(t)}catch{}return t}function bp(t){return e=>(typeof e=="string"?e:String(e)).toLowerCase().indexOf(t)!==-1}var un=(t,{value:e,stats:r,assertions:n})=>({get value(){return e},stat(s,o){return gs(t,s,r,o)},suggestion(s,o){let{limit:i=1/0,sort:a,filter:l}=o||{};a=ys(a,J.cmp),l=ys(l,bp);let c=a&&isFinite(i)?le:Set,p=gs(t,s,r,!0),u=new Map,f=[];for(let m of p){let{context:d,text:g,from:A,to:h,values:y,related:T}=m,C=Ap[d];if(!u.has(C)){let E;switch(c){case le:E=new le(i,a,l&&l(As(g)),!0);break;case Set:E=new Set;break}u.set(C,{type:C,from:A,to:h,text:g,suggestions:E})}let{suggestions:b}=u.get(C);switch(d){case"assertion":if(b.size===0||b.values&&b.values.length===0)for(let E of Object.keys(n))b.add(E);break;default:Tp(d,y,T,b)}}if(c===Set)for(let m of u.values()){let{suggestions:d}=m;if(a&&(d=[...d].sort(a)),l||isFinite(i)){let g=[],A=l?l(As(m.text)):()=>!0;for(let h of d)if(A(h)&&g.push(h)>=i)break;d=g}m.suggestions=d}for(let m of u.values())m.suggestions=Array.isArray(m.suggestions)?m.suggestions:[...m.suggestions],m.suggestions.length&&f.push(m);return f.length?f:null}});var Cp=new Map,Sp=new Map,Ep=new Map,kp=new Map;function Ts(t,e,r,n,s){typeof r=="string"?Object.defineProperty(t,e,{configurable:!0,get(){let i=pn(r,"method")(J,n,s);return Object.defineProperty(t,e,{enumerable:!0,value:i}),i}}):typeof r=="function"&&Object.defineProperty(t,e,{enumerable:!0,value:r})}function bs(t,e){if(!t&&!e)return{queryMethods:$e,queryAssertions:He};let r={...$e},n={...He};for(let[s,o]of Object.entries(t||{})){if(z($e,s))throw new Error(`Builtin method "${s}" can't be overridden`);Ts(r,s,o,r,n)}for(let[s,o]of Object.entries(e||{})){if(z(He,s))throw new Error(`Builtin assertion "${s}" can't be overridden`);Ts(n,s,o,r,n)}return{queryMethods:r,queryAssertions:n}}function wp(t,e){console.log(`[${t}]`),typeof e=="string"?console.log(e):e!==void 0&&console.dir(e,{depth:null}),console.log()}function pn(t,e,r,n,s){s=typeof s=="function"?s:s?wp:!1,s&&(s("========================="),s("Compile query from source",t));let o=gt.parse(t,n);s&&(s("AST",o.ast),s("Restored source",Tt(o.ast)));let i=r?At(t,o):null;if(s&&i){let l=f=>JSON.stringify(f).slice(1,-1),c=[].concat(...[...i.entries()].map(([f,m])=>m.map(d=>[f,...d]))),p=[],u=null;s("Stat/suggestion ranges",c.sort((f,m)=>f[1]-m[1]).map(([f,...m])=>{let[d,g,A,h]=m,y;if(d===p[0]&&g===p[1])y=" ".repeat(u.length);else{let T=l(t.slice(0,d)).length,C=l(t.substring(d,g)).length;p=m,u=" ".repeat(T)+(C?"~".repeat(C):"\\")+" "+d+":"+g,y=l(t)+`
`+u}return y+" ["+A+"] on "+f.type+(h===!0?" (current)":h&&h.type?" & "+h.type:"")}).join(`
`))}let a=e==="method"?rn(o.ast,n,i):tn(o.ast,n,i);return s&&s("Compiled code",a.toString()),a}function xp(t,e){e=e||{};let r=!!e.stat,n=!!e.tolerant,s=r?n?kp:Sp:n?Ep:Cp,{methods:o,assertions:i}=e||{},{queryMethods:a,queryAssertions:l}=bs(o,i),c;return t=String(t),s.has(t)&&!e.debug?c=s.get(t):(c=pn(t,"query",r,n,e.debug),s.set(t,c)),c=c(J,a,l),r?Object.assign((p,u)=>un(t,c(p,u)),{query:c}):c}function _p(t){let e=new Map,r=new Map,n=new Map,s=new Map,{methods:o,assertions:i}=t||{},{queryMethods:a,queryAssertions:l}=bs(o,i);return function(p,u){u=u||{};let f=!!u.stat,m=!!u.tolerant,d=f?m?s:r:m?n:e,g;if(p=String(p),d.has(p)&&!u.debug)g=d.get(p);else{let A=pn(p,"query",f,m,u.debug)(J,a,l);g=f?Object.assign((h,y)=>un(p,A(h,y)),{query:A}):A,d.set(p,g)}return g}}var K=Object.assign(xp,{version:qo,buildin:J,methods:$e,assertions:He,setup:_p,syntax:{tokenize:gt.tokenize,parse:gt.parse,suggest:At,walk:Ve,stringify:Tt,compile:tn,compileMethod:rn}});var wt=["js","garbage collector","parser","bytecode compiler","compiler","other","external","idle","atomics wait","logging"];var Op=1048576,fn=8;function Cs(t,e,r=0){return{id:t,callFrame:e,parentScriptOffset:r,children:[]}}function Ss(t,e,r,n,s){let o=r[5],i=n.length-1,a=Cs(1,0),l=[a],c=new Map,p=new Array(t.length),u=new Array(t.length),f=new Array(t.length),m=t.slice().sort((T,C)=>T.tm-C.tm),d=0;for(let T=0;T<m.length;T++){let C=m[T],b=C.s,E=C.vm,S=r[E],k=a,w=-1;if(E!==1&&E!==7)for(let F=b.length-2;F>=0;F-=2){let _=b[F];if(_<0||_>i)continue;let I=n[_];if(I===0)continue;k=A(k,I,w);let P=s[_];if(P!==null){let M=uo(P.positions,b[F+1]-(F>0&&P.pcOnNextInstruction?1:0));if(w=P.positions[M+1],P.inlined!==null){let x=P.positions[M+2];x!==-1&&(k=y(k,P.inlined,x))}}else w=-1}S===0&&k===a&&(S=o),S!==0&&(k=A(k,S,w),w=-1),p[T]=k.id,u[T]=C.tm-d,f[T]=w,d=C.tm}return{firstTimestamp:m[0].tm,lastTimestamp:d,nodes:l,samples:p,timeDeltas:u,samplePositions:f};function g(T,C){return T+C*Op}function A(T,C,b){let E=T.children.length;if(E===0)return h(T,C,b);if(E<fn){for(let S of T.children){let k=l[S-1];if(k.callFrame===C&&k.parentScriptOffset===b)return k}return h(T,C,b)}return c.get(T).get(g(C,b))||h(T,C,b)}function h(T,C,b){let E=Cs(l.length+1,C,b),S=T.children.push(E.id);return l.push(E),S>=fn&&(S===fn?c.set(T,new Map(T.children.map(k=>{let w=l[k-1];return[g(w.callFrame,w.parentScriptOffset),w]}))):c.get(T).set(g(C,b),E)),E}function y(T,C,b){let E=C[b*3],S=C[b*3+1],k=C[b*3+2],w=k!==-1?y(T,C,k):T;return A(w,E,S)}}function mn(t){let e=t.match(/\:(\d+)\:(\d+)$/),r=e?e[0]:null,n=e!==null?e[1]==="0"?0:Number(e[1])-1:-1,s=e!==null?Number(e[2])-1:-1;return{loc:r,line:n,column:s}}function Es(t){return t.trim()}function Mp(t,e=null){if(t.startsWith("wasm-function")&&!t.includes("wasm:")&&(e="wasm://wasm/unknown-script",t+=" "+e),e===""||e==="<unknown>"){let{loc:l,line:c,column:p}=mn(t);return{functionName:Es(l!==null?t.slice(0,-l.length):t),scriptUrl:"",line:c,column:p}}if(e!==null){let[l,c=""]=t.split(e),{line:p,column:u}=mn(c);return{functionName:Es(l),scriptUrl:e,line:p,column:u}}let r=t.match(/^((?:get |set )?[#.<>\[\]_$a-zA-Z\xA0-\uFFFF][#.<>\[\]\-_$a-zA-Z0-9\xA0-\uFFFF]*) /),n=r!==null?r[1]:"",s=r!==null?t.slice(r[0].length):t[0]===" "?t.slice(1):t,{loc:o,line:i,column:a}=mn(s);return{functionName:n,scriptUrl:o!==null?s.slice(0,-o.length):s,line:i,column:a}}function ks(t,e,r){let n=new Map,s=l=>{let c=n.get(l);return c===void 0&&(c={id:r.length,url:l,source:""},r.push(c),n.set(l,c)),c},o=[],i=new Uint32Array(t.length),a=new Map;for(let l=0;l<t.length;l++){let c=t[l],p=e[c.codes[0]].source,u=p&&r[p.script],{functionName:f,scriptUrl:m,line:d,column:g}=Mp(c.name,u?.url),A=u||s(m),h=d===0&&g===0,y=h&&a.get(A)||-1,T=y;y===-1&&(T=o.push({scriptId:A.id,name:f,start:p?.start??-1,end:p?.end??-1,line:d,column:g})-1,h&&a.set(A,T)),i[l]=T}return{functions:o,functionsIndexMap:i}}function ws(t,e,r){let n=[];for(let s=e;s<t.length;s++){if(n.length===0){if(t[s]===r)return s}else if(n[n.length-1]===t[s]){n.pop();continue}switch(t[s]){case"<":n.push(">");break;case"(":n.push(")");break;case"[":n.push("]");break}}return t.length}function Fp(t){t=t.replace(/::\(.+?\)/g,"");for(let r=0;r<t.length;r++)switch(t[r]){case"<":t=t.slice(0,r)+t.slice(ws(t,r+1,">")+1),r--;break;case"(":t=t.slice(0,r)+t.slice(ws(t,r+1,")")+1),r--;break}let e=t.lastIndexOf(" ");return t=e!==-1?t.slice(e+1):t,t}function Rp(t){if(!t||!t.type)return"(unknown)";if(t.type==="JS")throw new Error("Wrong code type: JS");let e=t.name,r=!1;switch(t.type){case"CPP":{e[1]===" "&&(e=Fp(e.slice(2))),e="(CPP) "+e;break}case"SHARED_LIB":{e="(LIB) "+e,r=!0;break}case"CODE":{switch(t.kind){case"RegExp":e="RegExp: "+e;break;case"Builtin":/IC/.test(e)?(e="(IC) "+e,r=!0):(e="(builtin) "+e,r=!0);break;case"BytecodeHandler":e="(bytecode) "+e,r=!0;break;case"Stub":e="(stub) "+e,r=!0;break;case"LoadIC":case"StoreIC":case"KeyedStoreIC":case"KeyedLoadIC":case"LoadGlobalIC":case"Handler":e="(IC) "+e,r=!0;break}break}default:e=`(${t.type}) ${e}`}return r?null:e}function Ge(t,e=0,r=-1,n=-1,s=""){return{scriptId:e,functionName:t,url:s,lineNumber:r,columnNumber:n}}function Dp(t){let e=new Uint32Array(wt.length),r=t.push(Ge("(program)"))-1;for(let n=0;n<wt.length;n++){let s=wt[n];s!=="js"&&(e[n]=s=="other"||s==="external"||s==="logging"?r:t.push(Ge(`(${s})`))-1)}return e}function Bp(t,e){let r=new Uint32Array(e.length);for(let n=0;n<e.length;n++){let s=e[n];r[n]=t.push(Ge(s.name,s.scriptId,s.line,s.column))-1}return r}function vp(t,e,r,n=null){let s=new Uint32Array(e.length);for(let o=0;o<e.length;o++){let i=e[o],a=i.func;if(a!==void 0){let l=n!==null?n[a]:a;s[o]=r[l]}else{let l=Rp(i);l!==null&&(s[o]=t.push(Ge(l))-1)}}return s}function xs(t,e,r=null){let n=[Ge("(root)")],s=Dp(n),o=Bp(n,t),i=vp(n,e,o,r);return{callFrames:n,callFrameIndexByVmState:s,callFrameIndexByFunction:o,callFrameIndexByCode:i}}function _s(t){return t.map(e=>{if(e===null)return null;let{id:r,url:n,source:s}=e;return{id:r,url:n==="<unknown>"?"":n[0]==="["&&n[n.length-1]==="]"?n.slice(1,-1):n,source:s}})}function xt(t){let e=t;return Array.isArray(e.code)&&Array.isArray(e.functions)&&Array.isArray(e.ticks)}function Up(t){let e=t.match(/^([a-z\-]+):/i)?.[1]||"";return e.length===1&&e>="A"&&e<="Z"&&(e="",t=t.slice(2)),e===""&&/^[\\/]/.test(t)?"file://"+t.replace(/\\/g,"/"):t}function Lp(t,e){for(let r of t)r!==null&&r.url!==""&&(r.url=Up(r.url));for(let r of e)r.scriptId!==0&&(r.url=t[r.scriptId]?.url||"")}function jp(t,e){let r=[],n=new Int32Array(e.length);for(let s of t){let o=s.callFrame,i=e[o],a=n[o];a===0&&(a=r.length,n[o]=a,r.push(i)),s.callFrame=a}return r}function Ps(t){let e=_s(t.scripts),{functions:r,functionsIndexMap:n}=ks(t.functions,t.code,e),s=co(t.functions,t.code,n),{callFrames:o,callFrameIndexByVmState:i,callFrameIndexByCode:a}=xs(r,t.code,n),l=po(t.code,t.functions,a),{nodes:c,samples:p,timeDeltas:u,samplePositions:f,lastTimestamp:m}=Ss(t.ticks,o,i,a,l),d=jp(c,o),g=K.methods.median(u);return Lp(e,o),{startTime:0,endTime:m+g,nodes:c,samples:p,timeDeltas:u,_samplesInterval:g,_samplePositions:f,_scripts:e.filter(A=>A!==null),_functions:r,_functionCodes:s,_callFrames:d,_heap:t.heap}}var Ns=["* [V8 log](https://v8.dev/docs/profile) (.log)","* [V8 log preprocessed](https://v8.dev/docs/profile#web-ui-for---prof) with --preprocess (.json)","* [V8 CPU profile](https://nodejs.org/docs/latest/api/cli.html#--cpu-prof) (.cpuprofile)","* [Chromium Performance Profile](https://developer.chrome.com/docs/devtools/performance/reference#save) (.json)","* [Edge Enhanced Performance Traces](https://learn.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/experimental-features/share-traces) (.devtools)"],_g=Ns.map(t=>t.replace(/\[(.+?)\]\(.*?\)/g,"$1"));function Is(t,e){let r={},n=null;if(t=t||{},Lo(t)){let{traceEvents:o,runtime:i,scripts:a,executionContexts:l}=jo(t);t=o,r={_runtime:i,_scripts:a,_executionContexts:l}}if(fr(t))n=Vo(t);else if(Array.isArray(t)){let o=t.map(i=>"profile"in i&&i.profile?i.profile:i);(xt(o[0])||dt(o[0]))&&(n={profiles:o})}else if(xt(t)||dt(t))n={profiles:[t]};else throw e("Unknown format"),new Error("Unknown format");let s={indexToView:n?.indexToView||0,profiles:[]};for(let o of n?.profiles||[])if(xt(o))s.profiles.push(Ps(o));else if(dt(o))o=Bo(o),o=Uo(o),Ro(o),Object.assign(o,r),s.profiles.push(o);else throw e("Bad format",{view:"md",source:["CPUpro supports the following formats:",...Ns]}),new Error("Bad format");return s.profiles.length===0&&e("CPU profiles not found"),oo?s:{...s,profiles:s.profiles.slice(0,1)}}function Vp(t,e){let r=e.split(/\//);r.pop();let n=t!==null?t.slice(0,Math.min(t.length,r.length)):r;r=r.slice(0,n.length);for(let s=n.length-1;s>=0;s--)n[s]!==r[s]&&n.pop();return n}function Os(t,e,r){let n=new Map;for(let o=0;o<t.length;o++){let i=t[o],a=i.length>0?i[0]:"",l=n.get(a);l!==void 0?(l.packages.push(e[o]),l.paths.push(i.slice(1))):n.set(a,{packages:[e[o]],paths:[i.slice(1)]})}let s=[];for(let[o,{packages:i,paths:a}]of n)if(r&&(i.length===1||o===""))s.push([`${o&&o+"."}${r}`,i]);else{let l=`${o}${r&&"."+r}`,c=Os(a,i,l);c.length===1&&r?s.push([l,i]):s.push(...c)}return s}function qp(t){let e=[],r=[];for(let n of t)n.path&&/^https?:/.test(n.path)&&e.push(n);for(let n of e)r.push(n.name.split(".").reverse());for(let[n,s]of Os(r,e,""))for(let o of s)o.shortName=n}function Ms(t,e){qp(t);let r=["script","devtools"],n=Object.create(null);for(let s of r)n[s]=Object.create(null);for(let s of e.values()){let o=s.path||"";if(o){let i=s.package;r.includes(i.type)&&i.path&&i.path.includes(":")&&!/^https?:/.test(i.path)&&(n[i.type][i.path]=Vp(n[i.type][i.path]||null,o))}}for(let[s,o]of Object.entries(n))for(let[i,a]of Object.entries(o))if(a!==null&&a.length>0){let l=a.join("/");for(let c of t.values())c.type===s&&c.path===i&&(c.path=l)}for(let s of e.values()){let o=s.path||"";s.package.path&&o.startsWith(s.package.path)&&(s.packageRelPath=o.slice(s.package.path.length).replace(/^[\/\\]+/,""))}}function zp(t){if(!t.name){switch(t.package.registry){case"npm":t.name=`${t.package.name}/${t.packageRelPath}`;return}switch(t.package.type){case"script":case"wasm":case"node":t.name=t.packageRelPath;break;case"webpack/runtime":t.name=t.path;break}}}function Fs(t){for(let e of t)zp(e)}function Rs(t,e,r){let n=new Uint32Array(r?.length||0);if(Array.isArray(r))for(let s=0;s<r.length;s++){let{scriptId:o,name:i,start:a,end:l,line:c,column:p}=r[s];n[s]=t.resolveCallFrameIndex({scriptId:o,url:"",functionName:i,lineNumber:c,columnNumber:p,start:a,end:l},e)}return n}function Ds(t,e){return t!==-1&&e!==-1?`:${t}:${e}`:null}var _e=class{dict;scriptById;#e;byUrl;#t;constructor(e,r){this.dict=e,this.scriptById=new Map,this.#e=new Map,this.byUrl=new Map,this.#t=new Map;for(let n of e.scripts){let{url:s}=n,o=this.#t.get(s||"");o===void 0?(o=[n],this.#t.set(s||"",o)):o.push(n)}this.#r(r)}#r(e){if(Array.isArray(e))for(let{id:r,url:n,source:s}of e)this.set(r,this.resolveScript(r,n,s))}get(e){return this.scriptById.get(e)}has(e){return this.scriptById.has(e)}set(e,r){return this.scriptById.set(e,r),this}entries(){return this.scriptById.entries()}#n(e,r){let n=this.byUrl.get(r),s=-1;return n===void 0?(s=0,n=[e],this.byUrl.set(r,n)):(s=n.indexOf(e),s===-1&&(s=n.push(e)-1)),s}resolveScript(e,r,n){if(e===0)return null;let s=this.get(e);if(s===void 0){r||="";let o=this.#n(e,r),i=this.#t.get(r);i===void 0&&(i=[],this.#t.set(r,i)),o<i.length?s=i[o]:(s=$p(this.dict.scripts.length+1,r,n),s.module=this.dict.resolveModule(s),i.push(s),this.dict.scripts.push(s)),this.set(e,s)}return s}normalizeScriptId(e){if(typeof e=="string")if(/^\d+$/.test(e))e=Number(e);else{let r=this.#e.get(e);r===void 0&&this.#e.set(e,r=/^:\d+$/.test(e)?Number(e.slice(1)):-this.#e.size-1),e=r}return e}};function Bs(t,e,r){if(t===0||t==="0")return null;let n=r.get(t);if(n===void 0){let s=r.normalizeScriptId(t);if(s===0)return null;n=r.resolveScript(s,e),r.set(t,n),r.set(s,n)}return n}function $p(t,e,r=null){return{id:t,url:e,source:r,module:null,callFrames:[]}}var Hp=[["(builtin) ","builtin"],["(IC) ","ic"],["(bytecode) ","bytecode"],["(LIB) ","lib"],["(CPP) ","cpp"]],Pt=class{callFrames;scripts;modules;packages;categories;#e;#t;#r;#n;#o=1;#i;#s;constructor(){this.scripts=[],this.callFrames=Object.assign([],{wellKnownIndex:Object.create(null)}),this.modules=[],this.packages=[],this.categories=[],this.#e=new Map,this.#t=new Map,this.#r=new Map,this.#n=new Map,this.#i=new Map,this.#s=new Map([...Object.entries(ao)]);for(let e of io)this.resolveCategory(e);for(let[e,r]of so)this.callFrames.wellKnownIndex[r]=this.resolveCallFrameIndex({scriptId:0,url:"",functionName:e,lineNumber:-1,columnNumber:-1},null)}callFrameToModule(e){return e.module}moduleToScript(e){return e.script}moduleToPackage(e){return e.package}packageToCategory(e){return e.category}setPackageNameForOrigin(e,r){let n=this.#s.get(e);n===void 0?this.#s.set(e,r):n!==r&&console.warn(`Package name for origin "${e}" already set "${n}", new name "${r}" ignored`)}resolveCallFrameIndex(e,r){let n=e.functionName||"",s=_t(e.lineNumber),o=_t(e.columnNumber),i=e.url||null,a=Bs(e.scriptId,i,r),l=this.#n.get(a);l===void 0&&this.#n.set(a,l=new Map);let c=l.get(n);c===void 0&&l.set(n,c=new Map);let p=c.get(s);p===void 0&&c.set(s,p=new Map);let u=p.get(o);if(u===void 0){let f=_t(e.start),m=_t(e.end),d=this.resolveModule(a,n),{name:g,kind:A,regexp:h}=this.#l(n,s,o),y={id:this.callFrames.length+1,script:a,kind:A||Yp(a,g,h),name:g,origName:n,line:s,column:o,loc:Ds(s,o),start:f,end:m,regexp:h,category:d.category,package:d.package,module:d};u=this.callFrames.push(y)-1,p.set(o,u),a?.callFrames.push(y)}return u}resolveCallFrame(e,r){return this.callFrames[this.resolveCallFrameIndex(e,r)]}resolveScript(e,r,n=null,s=null){return e.resolveScript(r,n,s)}resolveCategory(e){let r=e==="webpack/runtime"?"script":e,n=this.#r.get(r);return n===void 0&&(n={id:this.#r.size+1,name:r},this.#r.set(r,n),this.categories.push(n)),n}resolvePackage(e,r){let n=`${e}/${r}`,s=this.#t.get(n);if(s!==void 0)return s;let o="unknown",i="unknown",a="(unknown)",l=null,c=null,p=null,u=null;switch(r=r||"",e){case"script":case"bundle":{let f=Wp(r);if(f!==null&&(o=f.path,i=f.type,a=f.name,l=f.path,c=f.version,p=f.registry,u=f.cdn),o==="unknown")if(i="script",/^https?:/.test(r)){let{origin:m,host:d}=new URL(r);o=m,a=this.#s.get(d)||d,l=m}else if(r){let d=(r.match(/^[a-z\d]{2,}:/i)||["file:"])[0];d!=="file:"?(o=`(${d}script)`,a=o,l=d):Gp(r)?(i="devtools",o="vscode-js-debug",a=o,l=r.slice(0,r.indexOf(":")+1)):(o="(script)",a=o,l=r.slice(0,r.indexOf(":")+1))}else o="(compiled script)",a="(compiled script)";break}case"regexp":{o="(regexp)",i="regexp",a="(regexp)",l="";break}case"node":{o="(node)",i="node",a="(node.js modules)",l="node:";break}case"deno":{o="(deno)",i="deno",a="(deno modules)",l="ext:";break}case"v8":{o=`(${e})`,i="internals",a=`(${e} modules)`,l=`${e}/`;break}case"webpack/runtime":case"electron":{o=`(${e})`,i=e,a=`(${e} modules)`,l=`${e}/`;break}case"wasm":{o="(wasm)",i="wasm",a="(wasm)",l=r.startsWith("wasm://wasm/")?"wasm://wasm/":null;break}case"chrome-extension":{let{origin:f,host:m}=new URL(r);o=f,i="chrome-extension",a=this.#s.get(m)||m,l=f;break}case"root":case"program":case"gc":case"idle":case"internals":case"compilation":case"blocking":o=e,i=e,a=e!=="gc"?`(${e})`:"(garbage collector)";break}return s=this.#t.get(o),s===void 0&&(s={id:this.packages.length+1,type:i,name:a,shortName:a,path:l,version:c,registry:p,cdn:u,category:this.resolveCategory(i)},this.#t.set(n,s),this.#t.set(o,s),this.packages.push(s)),s}#a(e,r,n=null,s=null){let o=s??r,i=this.#e.get(o);if(i===void 0){let a=this.resolvePackage(e,n);i={id:this.#e.size+1,type:e,name:r,path:n,script:s,category:a.category,package:a,packageRelPath:null},this.#e.set(o,i),this.modules.push(i)}return i}resolveNoScriptModuleByFunctionName(e){let r=er.get(e)||null,n="unknown",s="unknown";return r!==null?(n=r,s=e):e.startsWith("RegExp: ")?(n="regexp",s="(regexp)"):(n="internals",s="(internals)"),this.#a(n,s)}resolveModuleByScript(e){let r=e.url,n="unknown",s=null,o=null;if(r==="extensions::SafeBuiltins"&&(r=""),!r||r.startsWith("evalmachine.")){let i=this.#i.get(e);i===void 0&&this.#i.set(e,i=`(anonymous module #${this.#i.size+1})`),n="script",s=i}else if(r.startsWith("v8/"))n="v8",o=r;else if(r.startsWith("node:electron/")||r.startsWith("electron/"))n="electron",o=r;else if(r.startsWith("webpack/runtime/"))n="webpack/runtime",o=r;else{let i=(r.match(/^([a-z\-]+):/i)||[])[1]||"";switch(i.length===1&&/[A-Z]/.test(i)&&(i="",r=r.slice(2).replace(/\\/g,"/")),i){case"":n="script",o="file://"+r;break;case"file":case"http":case"https":n="script",o=r;break;case"webpack":case"webpack-internal":n="bundle",o=r.replace(/\?$/,"");break;case"node":case"chrome-extension":case"wasm":n=i,o=r;break;case"ext":if(/^ext:(core|cli|runtime|deno)/.test(r)){n="deno",o=r;break}default:n=`protocol-${i}`,s=r}}return this.#a(n,s,o,e)}resolveModule(e,r=null){return e===null?this.resolveNoScriptModuleByFunctionName(r||""):this.resolveModuleByScript(e)}#l(e,r,n){let s=null,o=null,i=e;if(e.startsWith("RegExp: "))s=e.slice(8),i=s.length<=Qt?s:`${s.slice(0,Qt-1)}\u2026`;else{for(let[a,l]of Hp)if(e.startsWith(a)){o=l,i=e.slice(a.length);break}!o&&!i&&(i=r===0&&n===0?"(script)":`(anonymous function #${this.#o++})`)}return{name:i,kind:o,regexp:s}}};function Gp(t){return t.includes("bootloader.")&&/[\\\/](?:ms-vscode\.js-debug|vscode-js-debug-)/.test(t)&&/[\\\/](?:vscode-js-debug-)?bootloader\.(?:bundle\.)?js$/.test(t)}function Wp(t){let e=/^https?:\/\//.test(t)?new URL(t):null;if(e!==null&&Object.hasOwn(tr,e.origin)){let r=tr[e.origin],n=e.pathname;for(let s of r.endpoints){let o=n.match(s.pattern);if(o!==null){let i=o.groups?.pkg||"?",a=o.groups?.version||null,l=o.indices?.groups?.path?.[0]??n.length;return{type:"script",name:i,path:e.origin+(l!==void 0?n.slice(0,l):n),version:a,registry:s.registry,cdn:r.cdn}}}}if(/\/node_modules\//.test(t)){let r=t.split(/\/node_modules\//),s=(r.pop()||"").match(/(?:@[^/]+\/)?[^/]+/);if(s!==null){let o=s[0],i=[...r,o].join("/node_modules/");return{type:"script",name:o,path:i,version:null,registry:"npm",cdn:null}}}return null}function _t(t){return typeof t=="number"&&t>=0?t:-1}function Yp(t,e,r){if(t===null){if(e==="(root)")return"root";if(er.has(e))return"vm-state"}return r!==null?"regexp":e==="(script)"?"script":"function"}function vs(t,e,r){let n=new Uint32Array(t.length).fill(1),s=1;if(r!==null)for(let o=1;o<t.length;o++)t[o]!==t[o-1]||r[o]!==r[o-1]?(e[s]=e[o],t[s]=t[o],r[s]=r[o],s++):(e[s-1]+=e[o],n[s-1]++);else for(let o=1;o<t.length;o++)t[o]!==t[o-1]?(e[s]=e[o],t[s]=t[o],s++):(e[s-1]+=e[o],n[s-1]++);return s!==t.length?{samples:t.slice(0,s),sampleCounts:n.slice(0,s),samplePositions:r!==null?r.slice(0,s):r,timeDeltas:e.slice(0,s)}:{samples:t,sampleCounts:n,samplePositions:r,timeDeltas:e}}function Jp(t,e){let r=new Uint32Array(e.length),n=[],s=0;for(let o=0;o<t.length;o++){let i=t[o],a=r[i];a===0?(n.push(e[i]),r[i]=++s,t[o]=s-1):t[o]=a-1}return Re(n)}function Us(t,e,...r){let n=Jp(t,e);for(let s of r)s.sampleIdToNode=n.map(o=>s.sourceIdToNode[o]),n=s.sampleIdToNode}function Ls(t,e,r,n,s,o,i){let a=Date.now(),l=i?["callFramePositions","callFrames","modules","packages","categories"]:["callFrames","modules","packages","categories"],{recomputeTimings:c,samplesTimings:p,samplesTimingsFiltered:u,treeTimings:f,treeTimestamps:m,treeTimingsFiltered:d,dictionaryTimings:g,dictionaryTimingsFiltered:A}=ko(t,e,[i,r,n,s,o].filter(y=>y!==null)),h={recomputeTimings:c,samplesTimings:p,samplesTimingsFiltered:u,callFramePositionsTimings:null,callFramePositionsTreeTimings:null,callFramePositionsTimingsFiltered:null,callFramePositionsTreeTimingsFiltered:null,callFramePositionsTreeTimestamps:null};return g.forEach((y,T)=>h[`${l[T]}Timings`]=y),f.forEach((y,T)=>h[`${l[T]}TreeTimings`]=y),A.forEach((y,T)=>h[`${l[T]}TimingsFiltered`]=y),d.forEach((y,T)=>h[`${l[T]}TreeTimingsFiltered`]=y),m.forEach((y,T)=>h[`${l[T]}TreeTimestamps`]=y),ue&&console.log("Compute timings:",Date.now()-a),h}var Kp="no-samples";function Vs(t,e,r,n,s,o){Xp(r,n,s);let i=ye(r);typeof o!="number"&&(o=r.slice().sort()[r.length>>1]),t||(t=0);let a=t+i;(!e||e<a)&&(e=a+o);let l=r[0],c=e-t-l;r.copyWithin(0,1),i-=l;let p=Math.max(0,c-i),u=p>2.5*o?o:p;r[r.length-1]=u,i+=u;let f=i,m=c-f;return{startTime:t,startNoSamplesTime:l,endTime:e,endNoSamplesTime:m,totalTime:f,samplesInterval:o}}function Xp(t,e,r){for(let n=0;n<t.length;n++){let s=t[n];s<0&&(n<t.length-1&&(t[n+1]+=s),t[n]=n===0?0:-s,n>0&&(t[n-1]+=s,js(e,n,n-1),Array.isArray(r)&&js(r,n,n-1),n-=2))}}function js(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function qs(t,e,r,n=null,s){let a=t*1.5,l=t*1.2,c=0;for(let p=0;p<e.length;p++)e[p]>a&&c++;if(c>0){let p=s.nodeIdSeed++,u=e.length;s.noSamplesNodeId=p,s.callFrames.push(s.dict.callFrames.wellKnownIndex[Kp]),s.nodeParentId.push(1),s.parentScriptOffsets.push(-1),e.length+=c,r.length+=c,n!==null&&(n.length+=c);for(let f=u+c-1,m=u-1;f>=0;f--,m--){let d=e[m];d>a?(e[f-1]=l,e[f]=d-l,r[f-1]=r[m],r[f]=p,n!==null&&(n[f-1]=n[m],n[f]=-1),f--):(e[f]=d,r[f]=r[m],n!==null&&(n[f]=n[m]))}}}function dn(t){let e=t.filter(a=>!a.disabled&&a.type==="memory");if(e.length<2)return;let{_callFramesStable:r,_samplesStable:n,_uniqueValuesArray:s}=e[0],o=s.length,i=4294967295;r.fill(0),n.fill(i);for(let a of e){let{samples:l,timeDeltas:c,_samplesAll:p,_uniqueValuesMap:u,_callFramesMap:f}=a,{sampleIdToNode:m,nodes:d,dictionary:g}=a.callFramesTree,A=new Uint32Array(r.length);p.fill(0);for(let h=0;h<l.length;h++){let y=l[h],T=c[h],C=u.get(T)||0,b=d[m[y]],E=g[b],S=f.get(E)||0;p[S*o+C]++,A[S]+=T}for(let h=0;h<p.length;h++)p[h]<n[h]&&(n[h]=p[h])}for(let a=0;a<r.length;a++)for(let l=0;l<o;l++){let c=n[a*o+l];c!==i&&(r[a]+=c*s[l])}for(let a of e){let{_samplesAll:l,_callFramesVariance:c}=a;c.fill(0);for(let p=0;p<c.length;p++)for(let u=0;u<o;u++){let f=p*o+u;n[f]!==i&&(c[p]+=(l[f]-n[f])*s[u])}}}function zs(t,e){let r=ye(t);return typeof e!="number"&&(e=Qn(t)),{startTime:0,startNoSamplesTime:0,endTime:r,endNoSamplesTime:0,totalTime:r,samplesInterval:e}}function $s(t,e){let r=e.filter(f=>f.type==="memory"),n=new Set;if(r.length===0)return;for(let f of r){let m=Object.create(null);for(let d of f.timeDeltas)n.add(d),m[d]=(m[d]||0)+1;f._sampleSizeCounts=Object.fromEntries(Object.entries(m).sort((d,g)=>Number(d[0])-Number(g[0])))}let s=[...n].sort(),o=new Map(s.map((f,m)=>[f,m])),i=s.length,a=t.callFrames.length,l=new Map(t.callFrames.map((f,m)=>[f,m])),c=new Uint32Array(a),p=new Uint32Array(a*i),u=Zp(t,r);for(let f of r)Object.assign(f,{_commonTree:u,_uniqueValuesMap:o,_uniqueValuesArray:s,_callFramesMap:l,_callFramesVariance:new Uint32Array(a),_callFramesStable:c,_samplesStable:p,_samplesAll:new Uint32Array(a*i)});dn(r)}function Zp(t,e){let r=t.callFrames,n=r.length,s=[0],o=new Map([[0,0]]),i=[0],a=[];for(let p of e){let{callFramesTree:{nodes:u,parent:f}}=p,m=new Uint32Array(u.length);a.push(m);for(let d=1;d<u.length;d++){let g=m[f[d]],A=g*n+u[d],h=o.get(A);h===void 0&&(h=s.push(u[d])-1,i.push(g),o.set(A,h)),m[d]=h}}let l=Int32Array.from({length:s.length},(p,u)=>u);return Be(new Uint32Array(i),l,new Uint32Array(s),r)}function Hs(t,e,r,n,s){let o=r!==null?ef(t,r):tf(t);o!==-1&&Qp(o,e,n)}function Qp(t,e,r){let n=new Map,{nodeParentId:s,noSamplesNodeId:o,parentScriptOffsets:i,callFrames:a,dict:l}=e,c=l.callFrames.wellKnownIndex.gc;for(let p=1,u=r[0];p<r.length;p++){let f=r[p];if(f===t){if(u===t)r[p]=r[p-1];else if(u!==o){let m=n.get(u);m===void 0&&(m=e.nodeIdSeed++,n.set(u,m),a.push(c),s.push(u),i.push(-1)),r[p]=m}}u=f}}function ef(t,e){let r=new Set(t[0].children);for(let n of t){let s=n.callFrame,o=typeof s=="number"?e[s]:s;if(o.scriptId===0&&o.functionName==="(garbage collector)"&&r.has(n.id))return n.id}return-1}function tf(t){let e=new Set(t[0].children);for(let r of t){let n=r.callFrame;if(n.scriptId===0&&n.functionName==="(garbage collector)"&&e.has(r.id))return r.id}return-1}function Gs(t,e,r,n,s=null){let o=s?.count||0,i=new Uint32Array(e.length+o);for(let a=0;a<e.length;a++){let{callFrame:l}=e[a],c=typeof l=="number"?r[l]:t.resolveCallFrameIndex(l,n);i[a]=c}return i.set(s?.callFrames||[],e.length),i}function rf(t,e=null){let r=ro(t),n=e?.count||0,s=new Int32Array(r+1+n).fill(-1);for(let o=0;o<t.length;o++)s[t[o].id]=o;for(let o=t.length,i=r+1;o<s.length;o++,i++)s[i]=o;return s}function nf(t,e=null){let r=e?.parentScriptOffsets||[],n=new Int32Array(t.length+r.length).fill(-1);for(let s=0;s<t.length;s++){let{parentScriptOffset:o}=t[s];typeof o=="number"&&(n[s]=o)}return n.set(r,t.length),n}function of(t,e,r=null){let n=r?.nodeParentId||[],s=new Uint32Array(t.length+n.length);for(let o=0;o<t.length;o++){let{children:i}=t[o];if(Array.isArray(i)&&i.length>0)for(let a of i)s[e[a]]=o}for(let o=0,i=t.length;o<n.length;o++,i++)s[i]=e[n[o]];return s}function Ws(t,e=null){let r=rf(t,e),n=of(t,r,e),s=nf(t,e);return{nodeIndexById:r,nodeParent:n,nodePositions:s}}function Ys(t,e,r,n,s=new _e(t),o){let i=Rs(t,s,n),a=sf(t,s,r);return{callFrameByNodeIndex:Gs(t,e,a,s,o),callFrameByFunctionIndex:i}}function sf(t,e,r){let n=new Uint32Array(r?.length||0);if(Array.isArray(r)){for(let s=0;s<r.length;s++)n[s]=t.resolveCallFrameIndex(r[s],e);n.length!==r.length&&console.warn("Merged call frames:",r.length-n.length)}return n}function Js(t=[],e,r,n=0){let s=[],o=new Map,i=Array.from(t,({function:a,codes:l})=>({callFrame:r[e[a]],topTierWeight:-1,topTier:"Unknown",hotness:"cold",codes:new Array(l.length)}));for(let a=0;a<i.length;a++){let l=i[a],{callFrame:c}=l,{codes:p}=t[a],u=-1,f="Unknown",m=c.script;if(m!==null){let d=o.get(m);d===void 0&&o.set(m,d={script:m,compilation:null,callFrameCodes:[]}),c.start===0&&c.end===m.source?.length?d.compilation=l:d.callFrameCodes.push(l)}else console.warn("Script function has no script",l);for(let d=0;d<p.length;d++){let g=p[d],A=g.tier,h=ct.indexOf(A),y={...g,tm:g.tm-n,fns:g.fns.map(T=>i[T].callFrame),duration:d!==p.length-1?p[d+1].tm-g.tm:0,callFrameCodes:l,callFrame:c};l.codes[d]=y,s.push(y),h>u&&(u=h,f=A)}l.topTierWeight=u,l.topTier=f,l.hotness=ut[f]}return s.sort((a,l)=>a.tm-l.tm),{codes:s,codesByCallFrame:i,codesByScript:[...o.values()]}}function Ks(t,e){return e*16777216+t}function af(t,e){return e*16777216+t}function Xs(t,e,r,n,s,o,i){if(i===null)return{positionsTreeSource:null};let a=new Map,l=new Map,c=[],p=new Uint32Array(e.length),u=[],f=[];for(let y=0;y<r.length;y++){let T=s[e[y]],C=r[y],b=Ks(T,C),E=a.get(b);E===void 0&&a.set(b,E=c.push({callFrame:n[T],scriptOffset:C})-1),p[y]=E}if(i!==null)for(let y=0;y<o.length;y++){let T=t[o[y]],C=s[T]||0,b=i[y],E=Ks(C,b),S=a.get(E);S===void 0&&a.set(E,S=c.push({callFrame:n[C],scriptOffset:b})-1);let k=af(T,b),w=l.get(k);w===void 0&&(w=p.length+l.size,l.set(k,w),u.push(S),f.push(T)),o[y]=w-p.length}let m=p.length+u.length,d=new Uint32Array(m),g=new Uint32Array(m);d.set(p),d.set(u,p.length),g.set(e),g.set(f,p.length);let A=new Int32Array(l.values()),h=Be(g,A,d,c);return{samplePositions:i,positionsTreeSource:h}}var lf={chromium:"Chromium",deno:"Deno",edge:"Edge",electron:"Electron",nodejs:"Node.js",unknown:"Unknown"};function Zs(t,e,r){let n=new Set(t.map(o=>o.name)),s=r||(n.has("electron")?"electron":n.has("deno")?"deno":n.has("node")?"nodejs":n.has("chrome-extension")||e.find(o=>o.path&&/^https?:/.test(o.path))?"chromium":"unknown");return{engine:"V8",code:s,name:lf[s]}}var It=class{callFrames;scripts;modules;packages;categories;callFrameToModule;moduleToScript;moduleToPackage;packageToCategory;constructor(e,r,n){let s=new Uint8Array(e.callFrames.length);for(let o=0;o<r.length;o++)s[r[o]]=1;for(let o=0;o<n.length;o++)s[n[o]]=1;this.callFrames=e.callFrames.filter((o,i)=>s[i]),[this.modules,this.callFrameToModule]=Nt(e.modules,this.callFrames,e.callFrameToModule),[this.scripts,this.moduleToScript]=Nt(e.scripts,this.modules,e.moduleToScript),[this.packages,this.moduleToPackage]=Nt(e.packages,this.modules,e.moduleToPackage),[this.categories,this.packageToCategory]=Nt(e.categories,this.packages,e.packageToCategory)}};function Nt(t,e,r){let n=new Set(e.map(r).filter(Boolean)),s=new Uint32Array(n.size),o=new Array(n.size);for(let i=0,a=0;i<t.length;i++){let l=t[i];n.has(l)&&(s[a]=i,o[a]=l,a++)}return[o,s]}function hn(t,e){e.fill(0);for(let r of t){let n=r.callFramesTimings.samplesCount;for(let s=0;s<n.length;s++)n[s]>0&&e[s]++}for(let r of t){let{timeDeltasByProfile:n,sampleCountsByProfile:s}=r,{samplesCount:o,selfTimes:i}=r.callFramesTimings;n.fill(0),s.fill(0);for(let a=0;a<o.length;a++){let l=e[a]-1;n[l]+=i[a],s[l]+=o[a]}}for(let r=0;r<e.length;r++)e[r]/=t.length}var cf=!1;async function Qs(t,e,{work:r}){let n=t.nodes.length,s=t.samples.length,o=t._type==="memory"?"memory":"time",i=o==="memory"||!1,a={dict:e,nodeIdSeed:t.nodes.length+1,noSamplesNodeId:-1,callFrames:[],nodeParentId:[],parentScriptOffsets:[],get count(){return this.nodeParentId.length}},{startTime:l,startNoSamplesTime:c,endTime:p,endNoSamplesTime:u,totalTime:f,samplesInterval:m}=o==="time"?await r("process time deltas",()=>Vs(t.startTime,t.endTime,t.timeDeltas,t.samples,t._samplePositions,t._samplesInterval)):await r("process memory allocations",()=>zs(t.timeDeltas,t._samplesInterval));cf&&o==="time"&&await r("process time deltas",()=>qs(m,t.timeDeltas,t.samples,t._samplePositions,a));let{rawSamples:d,rawTimeDeltas:g,rawSamplePositions:A}=await r("convert samples & timeDeltas into TypedArrays",()=>({rawSamples:Re(t.samples),rawTimeDeltas:Re(t.timeDeltas),rawSamplePositions:Array.isArray(t._samplePositions)?eo(t._samplePositions):null})),{samples:h,sampleCounts:y,samplePositions:T,timeDeltas:C}=await r("process samples",()=>i?{samples:d,sampleCounts:new Uint32Array(d.length).fill(1),samplePositions:A,timeDeltas:g}:vs(d,g,A));await r("reparent GC samples",()=>Hs(t.nodes,a,t._callFrames||null,h,T));let{callFrameByNodeIndex:b,callFrameByFunctionIndex:E}=await r("extract call frames",()=>Ys(e,t.nodes,t._callFrames,t._functions,new _e(e,t._scripts),a)),{codes:S,codesByCallFrame:k,codesByScript:w}=await r("process function codes",()=>Js(t._functionCodes,E,e.callFrames)),F=await r("usage",()=>new It(e,b,E)),{nodeIndexById:_,nodeParent:I,nodePositions:P}=await r("process nodes",()=>Ws(t.nodes,a)),{positionsTreeSource:M}=await r("process call frame positions",()=>Xs(_,I,P,e.callFrames,b,h,T)),{treeSource:x,callFramePositionsTree:N,callFramesTree:R,modulesTree:L,packagesTree:j,categoriesTree:U}=await r("build trees",()=>yo(e,I,_,b,M,F)),q=[N,R,L,j,U].filter(Ra=>Ra!==null);await r("remap samples",()=>Us(h,M?.sourceIdToNode||x.sourceIdToNode,...q));let{recomputeTimings:V,samplesTimings:G,samplesTimingsFiltered:W,callFramePositionsTimings:ge,callFramePositionsTimingsFiltered:it,callFramePositionsTreeTimings:ne,callFramePositionsTreeTimingsFiltered:at,callFramePositionsTreeTimestamps:ma,callFramesTimings:da,callFramesTimingsFiltered:ha,callFramesTreeTimings:ga,callFramesTreeTimingsFiltered:ya,callFramesTreeTimestamps:Aa,modulesTimings:Ta,modulesTimingsFiltered:ba,modulesTreeTimings:Ca,modulesTreeTimingsFiltered:Sa,modulesTreeTimestamps:Ea,packagesTimings:ka,packagesTimingsFiltered:wa,packagesTreeTimings:xa,packagesTreeTimingsFiltered:_a,packagesTreeTimestamps:Pa,categoriesTimings:Na,categoriesTimingsFiltered:Ia,categoriesTreeTimings:Oa,categoriesTreeTimingsFiltered:Ma,categoriesTreeTimestamps:Fa}=await r("process samples",()=>Ls(h,C,R,L,j,U,N));return{name:t._name,type:o,disabled:!1,runtime:Zs(F.categories,F.packages,t._runtime),sourceInfo:{nodes:n,samples:s,samplesInterval:m},startTime:l,startNoSamplesTime:c,endTime:p,endNoSamplesTime:u,totalTime:f,_commonTree:null,_uniqueValuesMap:new Map,_uniqueValuesArray:new Array,_callFramesMap:new Map,_callFramesVariance:new Uint32Array,_callFramesStable:new Uint32Array,_samplesAll:new Uint32Array,_samplesStable:new Uint32Array,_sampleSizeCounts:{},_memoryType:t._memoryType?new Uint8Array(t._memoryType):null,_memoryTypeNames:t._memoryTypeNames||[],_memoryGc:t._memoryGc?new Uint8Array(t._memoryGc):null,_memoryGcNames:t._memoryGcNames||[],_memorySpace:t._memorySpace?new Uint8Array(t._memorySpace):null,_memorySpaceNames:t._memorySpaceNames||[],samples:G.samples,sampleCounts:y,sampleCountsByProfile:new Uint32Array,samplePositions:T,samplesTimings:G,samplesTimingsFiltered:W,timeDeltas:G.timeDeltas,timeDeltasByProfile:new Uint32Array,recomputeTimings:V,...F,codes:S,codesByCallFrame:k,codesByScript:w,positionsTreeSource:M,callFramePositionsTimings:ge,callFramePositionsTimingsFiltered:it,callFramePositionsTree:N,callFramePositionsTreeTimings:ne,callFramePositionsTreeTimingsFiltered:at,callFramePositionsTreeTimestamps:ma,callFramesTimings:da,callFramesTimingsFiltered:ha,callFramesTree:R,callFramesTreeTimings:ga,callFramesTreeTimingsFiltered:ya,callFramesTreeTimestamps:Aa,modulesTimings:Ta,modulesTimingsFiltered:ba,modulesTree:L,modulesTreeTimings:Ca,modulesTreeTimingsFiltered:Sa,modulesTreeTimestamps:Ea,packagesTimings:ka,packagesTimingsFiltered:wa,packagesTree:j,packagesTreeTimings:xa,packagesTreeTimingsFiltered:_a,packagesTreeTimestamps:Pa,categoriesTimings:Na,categoriesTimingsFiltered:Ia,categoriesTree:U,categoriesTreeTimings:Oa,categoriesTreeTimingsFiltered:Ma,categoriesTreeTimestamps:Fa,heap:t._heap||null}}var ei=async function(t,{rejectData:e,markers:r,setWorkTitle:n}){let s=async function(u,f){await n(u);let m=Date.now();try{return f()}finally{ue&&console.info(">",u,Date.now()-m)}},o=await s("extract profile data",()=>Is(t,e)),i=new Pt,a=[];for(let u=0;u<o.profiles.length;u++){let f=o.profiles[u];for(let{origin:d,name:g}of f._executionContexts||[])i.setPackageNameForOrigin(new URL(d).host,g);let m=await Qs(f,i,{work:o.profiles.length>1?(d,g)=>s(`Profile ${u+1}/${o.profiles.length} \u2014 ${d}`,g):s});m.name===void 0&&(m.name="Profile #"+(u+1)),m.callFramePositionsTree?.dictionary.forEach(r["call-frame-position"]),m.codesByCallFrame.forEach(r["call-frame-codes"]),a.push(m)}for(let u of a)u.timeDeltasByProfile=new Uint32Array(a.length),u.sampleCountsByProfile=new Uint32Array(a.length);let l=new Float32Array(i.callFrames.length);await s("cross-profile usage",()=>{hn(a,l)}),a.some(u=>u.type==="memory")&&await s("compute stable memory allocations",()=>$s(i,a)),await s("process module paths",()=>Ms(i.packages,i.modules)),await s("process display names",()=>Fs(i.modules)),await s("mark objects",()=>{i.callFrames.forEach(r["call-frame"]),i.modules.forEach(r.module),i.packages.forEach(r.package),i.categories.forEach(r.category),i.scripts.forEach(r.script)});let c=a[o.indexToView||0]||a[0];return{totalTime:a.reduce((u,f)=>Math.max(f.totalTime,u),0),shared:{scripts:i.scripts,callFrames:i.callFrames,modules:i.modules,packages:i.packages,categories:i.categories},callFramesProfilePresence:l,currentSamplesConvolutionRule:null,currentProfile:c,profiles:a}};var gn=function({defineObjectMarker:t,addQueryHelpers:e,setPrepare:r}){t("call-frame",{ref:"id",title:"name",page:"call-frame"}),t("call-frame-position",{title:"scriptOffset"}),t("module",{ref:"id",title:n=>n.name||n.path,page:"module"}),t("package",{ref:"id",title:"name",page:"package"}),t("category",{ref:"name",title:"name",page:"category"}),t("script",{ref:"id",title:"url"}),t("call-frame-codes",{title:n=>n.callFrame.name}),e(Po),r(ei)};var ai=[(ii(),La(si))];function bn(t,e,r=0,n=e.length){let s=e.indexOf(t,r);return s!==-1&&s<n?s:n}function We(t,e,r=t.length){let n=[];for(;e<=r;){let s=bn(",",t,e,r);n.push(t.slice(e,s)),e=s+1}return n}function Y(t,e,r,n){let s=We(e,r,n),o=s;for(let i=0;i<t.length&&i<s.length;i++)o[i]=t[i](s[i]);return o}function $(...t){return t}var H=parseInt;function li(t){switch(t){case"":return"Builtin";case"~":return"Unopt";case"^":return"Sparkplug";case"+":case"+'":return"Maglev";case"*":case"*'":return"Opt"}throw new Error(`Unknown code state: ${t}`)}var gf=Object.create(null);function Ot(t){return t===""?"":(t in gf,t)}function B(t){if(t===""||t.indexOf("\\")===-1)return Ot(t);let e=t.length,r="";for(let n=0;n<e;n++){let s=t.indexOf("\\",n);if(s===-1){r+=t.slice(n);break}if(s!==n&&(r+=t.slice(n,s),n=s),n===e-1){console.error("Invalid backslash",{inside:[n,n+1]});break}let o=t[++n];switch(o){case"0":r+="\0";break;case"b":r+="\b";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"f":r+="\f";break;case"t":r+="	";break;case"v":r+="\v";break;case"u":{let[i=""]=t.slice(n+1,n+5).match(/^[0-9a-f]*/i)||[];if(i.length===4){r+=String.fromCharCode(parseInt(i,16)),n+=4;break}console.error("Invalid Unicode escape sequence",{inside:[n-1,Math.min(n+1+i.length,e)]});break}case"x":{let[i=""]=t.slice(n+1,n+3).match(/^[0-9a-f]*/i)||[];if(i.length===2){r+=String.fromCharCode(parseInt(i,16)),n+=2;break}console.error("Invalid hexadecimal escape sequence",{inside:[n-1,Math.min(n+1+i.length,e)]});break}default:r+=o}}return/^/.test(r),r}function ci(t,e,r,n){let s=new Array(2*(r.length+(e?2:1))),o=0,i=a=>{let l=n(a);l!==null?(s[o++]=l.id,s[o++]=a-l.start):(s[o++]=-1,s[o++]=a)};i(t),e&&i(e);for(let a=0;a<r.length;a++){let l=r[a];switch(l.charCodeAt(0)){case 43:case 45:i(t+=parseInt(l));break;case 111:break;default:i(parseInt(l))}}return o<s.length&&(s.length=o),s}var yf=new TextDecoder,X={profiler:$(B,parseInt),"heap-capacity":$(parseInt),"heap-available":$(parseInt),new:$(B,B,parseInt),delete:$(B,B),"script-source":$(parseInt,B,B),"shared-library":$(B,H,H,H),"code-creation":$(B,parseInt,parseInt,H,H,B),"code-move":$(H,H),"code-deopt":$(parseInt,parseInt,H,parseInt,parseInt,B,B,B),"sfi-move":$(B,B),"code-delete":$(H),"code-source-info":$(H,parseInt,parseInt,parseInt,B,B,B),"code-disassemble":$(H,B,B),tick:$(H,parseInt,parseInt,H,parseInt)},Ft=class t{id;start;size;end;code;constructor(e,r,n,s){this.id=e,this.start=r,this.size=n,this.end=r+n-1,this.code=s}clone(e){return new t(this.id,e,this.size,this.code)}},Cn=class{start;size;end;codeEntry;constructor(e,r,n){this.start=e,this.size=r,this.end=e+r-1,this.codeEntry=n}};function Af(t,e){for(;e<t.length;e++){let r=t.charCodeAt(e);if(r===10||r===13)return e}return-1}function Pe(...t){Tf&&console.warn(...t.map(Ot))}function ui(t,e,r=!1){let n=0,s=e.length-1;for(;n<=s;){let o=n+s>>1,i=e[o];if(t<i.start)s=o-1;else if(t>i.end)n=o+1;else return o}return r&&n<e.length?n:-1}var Tf=!1,me=!1,bf=14,Mt=1<<bf,pi=[];async function fi(t){let e={},r=[],n=null,s=[],o=new Map,i=new Map,a=[],l=new Map,c=0,p=[],u=new Map,f=[],m={events:f},d=new Set,g=[],A=function(_){let{start:I,size:P}=_;for(;P>0;){let M=I%Mt,x=Math.min(P,Mt-M),N=I-M,R=new Cn(M,x,_);if(x===Mt)o.set(N,[R]);else{let L=o.get(N);L===void 0&&o.set(N,L=[]),h(L,R)}I+=x,P-=x}},h=function(_,I){let{start:P}=I;if(_.length===0||P>_[_.length-1].end){_.push(I);return}let M=P+I.size-1;if(M<_[0].start){_.unshift(I);return}let x=ui(P,_,!0),N=_[x];if(M>N.start){let R=x;for(;R+1<_.length&&!(_[R+1].start>M);R++);_.splice(x,R-x+1,I)}else _.splice(x,0,I)},y=function(_,I=!1){let P=_%Mt,M=_-P,x=o.get(M);if(x===void 0)return null;let N=ui(P,x,I);return N!==-1?x[N].codeEntry:null},T=_=>{for(let I=f.length-1;I>=0&&f[I].tm===0;I--)f[I].tm=_},C=_=>{if(_.length===0)return;let I=bn(",",_),P=_.slice(0,I),M=I+1;switch(P){case"tick":{let[x,N,R,L,j,...U]=Y(X[P],_,M),q=x,V=L;if(R)q=V,V=0;else if(V){let W=y(V);(W===null||W.code.type!=="JS")&&(V=0)}let G=ci(q,V,U,y);T(N),p.push({tm:N,vm:j,s:G});break}case"code-creation":{let x=We(_,M),N=x[0],R=parseInt(x[2]),L=H(x[3]),j=H(x[4]),U=x[5],q,V="";for(let ne=6;ne<x.length;ne++){let at=x[ne];if(at.startsWith("0x")){q=at,V=x[ne+1];break}U+=","+B(x[ne])}U=Ot(U);let G=V?li(V):N==="JS"?"Builtin":N,W;if(q!==void 0&&(W=i.get(q),W===void 0||W.name!==U)){let ne=[];i.set(q,W={id:a.length,name:U,codes:ne}),a.push({name:U,codes:ne})}let ge;W?(W.codes.push(r.length),ge={name:U,type:"JS",kind:G,size:j,func:W.id,tm:R}):ge={name:U,timestamp:R,type:"CODE",kind:G,size:j};let it=new Ft(r.length,L,j,ge);A(it),n=it,r.push(ge),T(R),me&&s.push({op:P,address:L,size:j,type:N,kindNum:x[1],kind:G,timestamp:R,nameAndLocation:U,sfiAddress:q});break}case"code-source-info":{let[x,N,R,L,j,U,q=""]=Y(X[P],_,M),V=n?.start===x?n:y(x);V!==null?V.code.type==="JS"?V.code.source={script:N,start:R,end:L,positions:j,inlined:U,fns:q!==""?(q.match(/[^S]+/g)||pi).map(G=>{let W=i.get(G);return W!==void 0?W.id:(Pe("No SFI found"),-1)}):pi}:Pe("Not a JavaScript code"):Pe(`Code with address ${x} is not found`),me&&s.push({op:P,address:x,scriptId:N,start:R,end:L,positions:j,inlinedPositions:U,inlinedFunctions:q});break}case"script-source":{let[x,N,R]=Y(X[P],_,M);c=Math.max(x,c),l.set(x,{id:x,url:N,source:R});break}case"new":{let[x,N,R]=Y(X[P],_,M);u.set(N,R),f.push({tm:0,event:P,type:x,address:N,size:R});break}case"delete":{let[x,N]=Y(X[P],_,M),R=u.get(N);R===void 0?Pe(`Unknown memory chunk ${x} @ ${N}`):R===-1||(u.set(N,-1),f.push({tm:0,event:P,type:x,address:N,size:R}));break}case"code-deopt":{let[x,N,R,L,j,U,q,V]=Y(X[P],_,M),G=y(R);G?.code.type==="JS"&&(G.code.deopt||(G.code.deopt={tm:x,inliningId:L,scriptOffset:j,posText:q,reason:V,bailoutType:U}));break}case"code-move":{let[x,N]=Y(X[P],_,M),R=y(x);R!==null?A(R.clone(N)):Pe("No code found"),me&&s.push({op:P,address:x,destAddress:N});break}case"sfi-move":{let[x,N]=Y(X[P],_,M),R=i.get(x);R!==void 0?(i.delete(x),i.set(N,R)):Pe("SFI not found, on moving SFI",x,"->",N),me&&s.push({op:P,address:x,destAddress:N});break}case"code-delete":{if(me){let[x]=Y(X[P],_,M);s.push({op:P,address:x})}break}case"code-disassemble":{let[x,N,R]=Y(X[P],_,M);me&&s.push({op:P,address:x,kind:N,disassemble:R});break}case"v8-version":{e.version=We(_,M).join(".");break}case"v8-platform":{e.platform=We(_,M).join("/");break}case"profiler":{let[x,N]=Y(X[P],_,M);x==="start"&&(e.samplesInterval=N);break}case"heap-capacity":{let[x]=Y(X[P],_,M);m.capacity=x;break}case"heap-available":{let[x]=Y(X[P],_,M);m.available=x;break}case"shared-library":{let[x,N,R,L]=Y(X[P],_,M),j={name:x,type:"SHARED_LIB"};A(new Ft(r.length,N,R-N,j)),r.push(j),me&&s.push({op:P,address:N,size:R-N,name:x,aslrSlide:L});break}case"shared-library-end":break;default:d.add(P),g.push({op:P,line:_})}},b="",E=0,S=-1,k=!1,w=!0;for await(let _ of t){let I=typeof _=="string"?_:yf.decode(_,{stream:!0});E=0,w&&!k&&(k=typeof _=="string"?_.includes("\r"):_.includes(13));do{if(S=k?Af(I,E):I.indexOf(`
`,E),S===-1)break;b!==""?(C(b+I.slice(E,S)),b=""):E<S&&C(I.slice(E,S)),E=S+1,w=!1}while(!0);b+=I.slice(E)}return b!==""&&(C(b),b=""),{meta:e,code:r,functions:a,ticks:p,scripts:Array.from({length:c+1},(_,I)=>l.get(I)||null),heap:m,ignoredOps:[...d],ignoredEntries:g}}var Cf=new TextDecoder,mi="v8-version,",di=[{name:"v8log",test(t){return Cf.decode(t.slice(0,mi.length))===mi},streaming:!0,decode:fi}];var Sn=[...di];function Sf(t){if(!t||typeof t!="object")return"value is not an object";let{name:e,test:r,decode:n}=t;return typeof e!="string"?"missed name":typeof r!="function"?"missed test function":typeof n!="function"?"missed decode function":!1}function Ef(t){let e=Sf(t);if(e)throw new Error(`Bad encoding config${t?.name?` "${t.name}"`:""}: ${e}`);let{name:r,test:n,streaming:s,decode:o}=t;return Object.freeze(s?{name:r||"unknown",test:n,streaming:!0,decode:o}:{name:r||"unknown",test:n,streaming:!1,decode:o})}function Rt(t){if(!t)return[];if(!Array.isArray(t))throw new Error("Encodings must be an array");return t.map(Ef)}var Dt=class{subscriber;value;constructor(e,r){this.subscriber=null,this.value=e,this.shouldUpdate=typeof r=="function"?r:this.shouldUpdate}get readonly(){let e=this;return{subscribe:this.subscribe.bind(this),subscribeSync:this.subscribeSync.bind(this),unsubscribe:this.unsubscribe.bind(this),get value(){return e.value}}}subscribe(e){return this.subscriber={callback:e,subscriber:this.subscriber},()=>this.unsubscribe(e)}subscribeSync(e){let r=this.subscribe(e);return e(this.value,r),r}unsubscribe(e){let r=this,n=this.subscriber;for(;n!==null;){if(n.callback===e){n.callback=null,r.subscriber=n.subscriber;break}r=n,n=n.subscriber}}shouldUpdate(e,r){return e!==r}set(e){return this.#e(e)!==!1}asyncSet(e){let r=this.#e(e);return r===!1?Promise.resolve(!1):Promise.all(r).then(()=>!0)}#e(e){if(!this.shouldUpdate(e,this.value))return!1;let r=[],n=this.subscriber;for(this.value=e;n!==null;){let{callback:s}=n;s!==null&&r.push(s(e,()=>this.unsubscribe(s))),n=n.subscriber}return r}};function En(t){return typeof t=="object"&&t!==null&&(typeof t[Symbol.iterator]=="function"||typeof t[Symbol.asyncIterator]=="function")}var Ye=1,kf=2,wf=new TextDecoder;function xf(t,e){return t.name==="SyntaxError"&&e.jsonParseOffset&&(t.message=t.message.replace(/at position (\d+)/,(r,n)=>"at position "+(Number(n)+e.jsonParseOffset))),t}function _f(t,e){let r=t.length;t.length+=e.length;for(let n=0;n<e.length;n++)t[r+n]=e[n]}async function Bt(t){let e=typeof t=="function"?t():t;if(En(e)){let r=new kn;try{for await(let n of e){if(typeof n!="string"&&!ArrayBuffer.isView(n))throw new TypeError("Invalid chunk: Expected string, TypedArray or Buffer");r.push(n)}return r.finish()}catch(n){throw xf(n,r)}}throw new TypeError("Invalid chunk emitter: Expected an Iterable, AsyncIterable, generator, async generator, or a function returning an Iterable or AsyncIterable")}var kn=class{constructor(){this.value=void 0,this.valueStack=null,this.stack=new Array(100),this.lastFlushDepth=0,this.flushDepth=0,this.stateString=!1,this.stateStringEscape=!1,this.pendingByteSeq=null,this.pendingChunk=null,this.chunkOffset=0,this.jsonParseOffset=0}parseAndAppend(e,r){this.stack[this.lastFlushDepth-1]===Ye?(r&&(this.jsonParseOffset--,e="{"+e+"}"),Object.assign(this.valueStack.value,JSON.parse(e))):(r&&(this.jsonParseOffset--,e="["+e+"]"),_f(this.valueStack.value,JSON.parse(e)))}prepareAddition(e){let{value:r}=this.valueStack;if(Array.isArray(r)?r.length!==0:Object.keys(r).length!==0){if(e[0]===",")return this.jsonParseOffset++,e.slice(1);if(e[0]!=="}"&&e[0]!=="]")return this.jsonParseOffset-=3,"[[]"+e}return e}flush(e,r,n){let s=e.slice(r,n);if(this.jsonParseOffset=this.chunkOffset+r,this.pendingChunk!==null&&(s=this.pendingChunk+s,this.jsonParseOffset-=this.pendingChunk.length,this.pendingChunk=null),this.flushDepth===this.lastFlushDepth)this.flushDepth>0?this.parseAndAppend(this.prepareAddition(s),!0):(this.value=JSON.parse(s),this.valueStack={value:this.value,prev:null});else if(this.flushDepth>this.lastFlushDepth){for(let o=this.flushDepth-1;o>=this.lastFlushDepth;o--)s+=this.stack[o]===Ye?"}":"]";this.lastFlushDepth===0?(this.value=JSON.parse(s),this.valueStack={value:this.value,prev:null}):this.parseAndAppend(this.prepareAddition(s),!0);for(let o=this.lastFlushDepth||1;o<this.flushDepth;o++){let i=this.valueStack.value;if(this.stack[o-1]===Ye){let a;for(a in i);i=i[a]}else i=i[i.length-1];this.valueStack={value:i,prev:this.valueStack}}}else{s=this.prepareAddition(s);for(let o=this.lastFlushDepth-1;o>=this.flushDepth;o--)this.jsonParseOffset--,s=(this.stack[o]===Ye?"{":"[")+s;this.parseAndAppend(s,!1);for(let o=this.lastFlushDepth-1;o>=this.flushDepth;o--)this.valueStack=this.valueStack.prev}this.lastFlushDepth=this.flushDepth}push(e){if(typeof e!="string"){if(this.pendingByteSeq!==null){let o=e;e=new Uint8Array(this.pendingByteSeq.length+o.length),e.set(this.pendingByteSeq),e.set(o,this.pendingByteSeq.length),this.pendingByteSeq=null}if(e[e.length-1]>127)for(let o=0;o<e.length;o++){let i=e[e.length-1-o];if(i>>6===3){o++,(o!==4&&i>>3===30||o!==3&&i>>4===14||o!==2&&i>>5===6)&&(this.pendingByteSeq=e.slice(e.length-o),e=e.slice(0,-o));break}}e=wf.decode(e)}let r=e.length,n=0,s=0;e:for(let o=0;o<r;o++){if(this.stateString){for(;o<r;o++)if(this.stateStringEscape)this.stateStringEscape=!1;else switch(e.charCodeAt(o)){case 34:this.stateString=!1;continue e;case 92:this.stateStringEscape=!0}break}switch(e.charCodeAt(o)){case 34:this.stateString=!0,this.stateStringEscape=!1;break;case 44:s=o;break;case 123:s=o+1,this.stack[this.flushDepth++]=Ye;break;case 91:s=o+1,this.stack[this.flushDepth++]=kf;break;case 93:case 125:s=o+1,this.flushDepth--,this.flushDepth<this.lastFlushDepth&&(this.flush(e,n,s),n=s);break;case 9:case 10:case 13:case 32:n===o&&n++,s===o&&s++;break}}s>n&&this.flush(e,n,s),s<r&&(this.pendingChunk!==null?this.pendingChunk+=e:this.pendingChunk=e.slice(s,r)),this.chunkOffset+=r}finish(){return this.pendingChunk!==null&&(this.flush("",0,0),this.pendingChunk=null),this.value}};var If=typeof Object.hasOwn=="function"?Object.hasOwn:(t,e)=>Object.hasOwnProperty.call(t,e),Of={8:"\\b",9:"\\t",10:"\\n",12:"\\f",13:"\\r",34:'\\"',92:"\\\\"},hA=Uint8Array.from({length:2048},(t,e)=>If(Of,e)?2:e<32?6:e<128?1:2);var wn=Object.freeze({name:"json",test:()=>!0,streaming:!0,decode:Bt});var Ff=new Uint8Array([0,0,74,83,79,78,88,76]),Ti=9,Rf=268435455,Df=4294967295,vt=2,Je=4,xn=8,Xe=16,Ut=32,Lt=64,Ne=128,Bf=0,vf=1,Uf=2,Lf=3,jf=4,Vf=5,qf=6,zf=8,$f=9,Hf=10,Gf=11,Wf=12,Yf=224,Jf=7936,bi=0,_n=1,Kf=2,Xf=3,Zf=4,Qf=5,Ci=6,Si=7,em=8,gi=16,yi=32,IA=~Xe,tm=vt|Ut|Lt,Ei=new Uint8Array(256).map((t,e)=>{for(let r=0;r<8;r++)t+=e>>r&1;return t});function rm(t,e,r,n=new Array(r)){let s=e&15,o=e&48,i=r,a=0,l=0;switch(o){case gi:{a=n[0]=t.readIntVar(),i--,l=1;break}case yi:{a=t.readIntVar();break}}switch(s){case Kf:{for(let c=0;c<i;c++)n[l+c]=t.readVlq();break}case Xf:{for(let c=0;c<i;c++)n[l+c]=t.readIntVar();break}case Zf:{let c=t.readBytes(Math.ceil(i/2));for(let p=0,u=0;p<i;p++)u=p&1?u>>4:c[p>>1],n[l+p]=u&8?t.readVlq()*8+(u&7):u&7;break}case Qf:{let c=t.readBytes(Math.ceil(i/2));for(let p=0,u=0;p<i;p++){u=p&1?u>>4:c[p>>1];let f=u&4?-1:1;n[l+p]=u&8?f*(t.readVlq()*4+(u&3)):f*(u&3)}break}case Ci:{let c=e>>8,p=(1<<c)-1,u=t.readBytes(Math.ceil(i*c/8)),f=0,m=0,d=0;for(let g=0;g<i;g++){for(;m<c;)d|=u[f++]<<m,m+=8;n[l+g]=d&p,d>>=c,m-=c}break}case Si:{let c=e>>8,p=(1<<c)-1,u=t.readBytes(Math.ceil(i*c/8)),f=0,m=0,d=0;for(let g=0;g<i;g++){for(;m<c;)d|=u[f++]<<m,m+=8;n[l+g]=d&1?-((d&p)>>1):(d&p)>>1,d>>=c,m-=c}break}case em:{let c=n[0]=t.readIntVar(),p=t.readIntVar();for(let u=1;u<r;u++)n[u]=c+=p;break}case bi:case _n:{let c=s===_n,p=e>>8,u=c?e&Jf|p&Yf:p;if(Ei[p]>1){let f=t.readTypeIndex(i,u);for(let m=0;m<i;m++)n[l+m]=t.readNumber(f[m])}else{let f=31-Math.clz32(u);for(let m=0;m<i;m++)n[l+m]=t.readNumber(f)}break}default:throw new Error(`Unknown numeric array encoding method: ${s}`)}switch(o){case gi:{n[0]=a;for(let c=1;c<r;c++)n[c]+=n[c-1];break}case yi:{for(let c=0;c<r;c++)n[c]+=a;break}}return n}var Ke=12;function nm(t){return t===Ti||t===9}function ki(t){try{let{version:e}=wi(t);if(nm(e))return!0;throw new Error(`Unsupported jsonxl version "${e}", expected "${Ti}"`)}catch{return!1}}function wi(t){if(t.byteLength<Ke)throw new Error(`Header length must be at least ${Ke} bytes`);let e=new Uint8Array(t.buffer,t.byteOffset,Ke);if(e.subarray(0,8).some((o,i)=>o!==Ff[i]))throw new Error("Bad magic number");let r=new DataView(e.buffer,e.byteOffset,Ke),n=r.getUint16(8,!0),s=r.getUint16(10,!0);return{version:n,flags:s,headerSize:Ke}}var om=new TextDecoder("utf8",{ignoreBOM:!0});function sm(t){let e=om.decode(t.readBytes(t.readVlq())),r=t.readNumericArray(),n=t.readNumericArray(),s=t.readNumericArray(),o=new Array(r);for(let i=0,a=0,l=0,c=0,p="";i<r.length;i++){let u=r[i],f=e.slice(a,a+=u>>2);u&2&&(f=p.slice(0,n[l++])+f),u&1&&(f=f+p.slice(-s[c++])),o[i]=f,p=f}return o}var im=class{constructor(t,e){this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.bytes=t,this.pos=0,typeof e=="function"&&e(this),this.consumeHeader(),this.loadStrings(),this.loadArrayLengths(),this.loadArrayHeaders(),this.loadObjectEntries()}consumeHeader(){let{version:t,flags:e,headerSize:r}=wi(this.view);return this.pos+=r,{version:t,flags:e}}loadStrings(){this.strings=sm(this),this.stringRefs=this.readNumericArray(),this.stringRefsCursor=0}loadArrayHeaders(){this.arrayHeaders=this.readNumericArray(),this.arrayHeaderRefs=this.readNumericArray(),this.arrayHeaderRefsCursor=0}loadArrayLengths(){this.arrayLengths=this.readNumericArray(),this.arrayLengthsCursor=0}loadObjectEntries(){let t=this.readVlq(),e=this.readVlq();this.objectEntries=new Array(t),this.objectKeys=e?this.stringRefs.slice(-e).map(r=>this.strings[r]):[];for(let r=0;r<t;r++)this.objectEntries[r]={dict:this.readNumericArray(),refs:this.readNumericArray(),cursor:0}}readString(){return this.strings[this.stringRefs[this.stringRefsCursor++]]}readArrayHeader(){return this.arrayHeaders[this.arrayHeaderRefs[this.arrayHeaderRefsCursor++]]}readArrayLength(){return this.arrayLengths[this.arrayLengthsCursor++]}readObjectEntry(t){let e=this.objectEntries[t],r=e.refs[e.cursor++],n=e.dict[r];return n===0?null:{key:this.objectKeys[n>>8],type:n&255}}readBytes(t){return this.bytes.subarray(this.pos,this.pos+=t)}readTypeIndex(t,e,r){let n=0,s=0,o=0;for(;e>0;)e&1&&(n|=o<<(s++<<2)),o++,e>>=1;let i=new Uint8Array(t),a=32-Math.clz32(s-1),l=(1<<a)-1,c=this.readBytes(Math.ceil(a*t/8)),p=0,u=0,f=0;for(let m=0;m<t;m++){f<a&&(u|=c[p++]<<f,f+=8);let d=n>>((u&l)<<2)&15;i[m]=r?1<<d:d,u>>=a,f-=a}return i}readVlq(){let t=this.view.getUint8(this.pos);if(!(t&1))t=t>>1,this.pos+=1;else if(!(t&2))t=this.view.getUint8(this.pos+1)<<6|t>>2,this.pos+=2;else if(!(t&4))t=this.view.getUint16(this.pos+1,!0)<<5|t>>3,this.pos+=3;else{let e=this.view.getUint32(this.pos,!0);t=e>>>3&Rf,this.pos+=4,e>>>31&&(t+=this.readUintVar()*(1<<28))}return t}readUintVar(){let t=this.view.getUint8(this.pos++),e=t&127,r=128;for(;t&128;)t=this.view.getUint8(this.pos++),e+=(t&127)*r,r*=128;return e}readIntVar(){let t=this.readUintVar();return t&1?-(t-1)/2:t<=Df?t>>>1:t/2}readUint8(){let t=this.view.getUint8(this.pos);return this.pos++,t}readInt8(){let t=this.view.getInt8(this.pos);return this.pos++,t}readUint16(){let t=this.view.getUint16(this.pos,!0);return this.pos+=2,t}readInt16(){let t=this.view.getInt16(this.pos,!0);return this.pos+=2,t}readUint24(){let t=this.view.getUint16(this.pos,!0)|this.view.getUint8(this.pos+2)<<16;return this.pos+=3,t}readInt24(){let t=this.view.getUint16(this.pos,!0),e=this.view.getUint8(this.pos+2),r=e&128?(e<<16|t)-16777216:e<<16|t;return this.pos+=3,r}readUint32(){let t=this.view.getUint32(this.pos,!0);return this.pos+=4,t}readInt32(){let t=this.view.getInt32(this.pos,!0);return this.pos+=4,t}readFloat32(){let t=this.view.getFloat32(this.pos,!0);return this.pos+=4,t}readFloat64(){let t=this.view.getFloat64(this.pos,!0);return this.pos+=8,t}readNumber(t){switch(t){case Bf:return this.readUint8();case vf:return this.readUint16();case Uf:return this.readUint24();case Lf:return this.readUint32();case jf:return this.readUintVar();case zf:return this.readInt8();case $f:return this.readInt16();case Hf:return this.readInt24();case Gf:return this.readInt32();case Wf:return this.readIntVar();case Vf:return this.readFloat32();case qf:return this.readFloat64()}}readNumericArrayEncoding(){let t=this.readUint8();switch(t&15){case bi:case _n:case Ci:case Si:t|=this.readUint8()<<8;break}return t}readNumericArray(t=this.readVlq()){if(t===0)return[];let e=this.readNumericArrayEncoding();return this.readNumbers(e,t)}readNumbers(t,e,r){return rm(this,t,e,r)}};function Ai(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function xi(t,e){function r(a={}){let l=0,c;for(;c=o.readObjectEntry(l++);)a[c.key]=s(c.type);return a}function n(a=o.readArrayLength()){if(a===0)return[];let l=o.readArrayHeader(),c=l>>16,p=l&65535,u=c&1,f=c>>5&1,m=c>>9&1,d=c>>1&255|(c&1)<<4,g=new Array(a),A=Ei[d]>1?o.readTypeIndex(a,d,!0):null;if(d&tm)if(A===null)switch(d){case vt:g.fill(null);break;case Ut:g.fill(!0);break;case Lt:g.fill(!1);break}else for(let h=0;h<a;h++)switch(A[h]){case vt:g[h]=null;break;case Ut:g[h]=!0;break;case Lt:g[h]=!1;break}if(d&xn)for(let h=0;h<a;h++)(A===null||A[h]===xn)&&(g[h]=o.readString());if(d&Je)if(d===Je)o.readNumbers(p,a,g);else{let h=Ai(A,Je),y=o.readNumbers(p,h);for(let T=0,C=0;T<a;T++)A[T]===Je&&(g[T]=y[C++])}if(d&Ne)if(m){let h=d===Ne?a:Ai(A,Ne),y=o.readNumericArray(h),T=n();for(let C=0,b=0,E=0;C<a;C++)(A===null||A[C]===Ne)&&(g[C]=T.slice(E,E+=y[b++]))}else for(let h=0;h<a;h++)(A===null||A[h]===Ne)&&(g[h]=n());if(d&Xe){let h=d===Xe?g:[];for(let y=0,T=0;y<a;y++)(A===null||A[y]===Xe)&&(g[y]=h[T++]={});if(f){let y=o.readVlq(),T=new Array(y);for(let C=0;C<y;C++)T[C]=o.readString();for(let C=0;C<y;C++){let b=T[C],E=n(h.length);for(let S=0;S<h.length;S++)E[S]!==void 0&&(h[S][b]=E[S])}}if(u)for(let y=0;y<h.length;y++)r(h[y])}return g}function s(a){switch(1<<(a&7)){case vt:return null;case xn:return o.readString();case Je:return o.readNumber(a>>3);case Xe:return r();case Ut:return!0;case Lt:return!1;case Ne:return n()}}let o=new im(t,e),i=s(o.readUint8());if(o.pos!==t.byteLength)throw new Error("End of input is not reached");return i}var jt=Object.freeze({name:"jsonxl/snapshot9",test:ki,streaming:!1,decode:xi});var _i=[{name:"gzip",test:t=>t[0]===31&&t[1]===139&&t[2]===8,createTransformStream:()=>new DecompressionStream("gzip")},{name:"zlib",test:t=>(t[0]&15)===8&&t[0]>>4<=7&&(t[0]<<8|t[1])%31===0,createTransformStream:()=>new DecompressionStream("deflate")}];function lm(t){return t.reduce((e,r)=>e+r.byteLength,0)}function cm(t,e){switch(t.length){case 0:return;case 1:return t[0];default:{let r=new Uint8Array(e||lm(t)),n=0;for(let s of t)r.set(s,n),n+=s.length;return r}}}async function Pi(t){let e=[],r=0;for await(let n of t)e.push(n),r+=n.byteLength;return cm(e,r)}function um(t,e){if(typeof t!="string"){for(let r of e)if(r.test(t))return r}return null}var Vt=class{#e;#t;#r;#n;constructor(e,r){this.#e=e,this.#t=r,this.#r=null,this.#n=null}transform(e,r){if(this.#n===null){let n=um(e,this.#e);if(n===null)this.#n=Promise.resolve();else{let{readable:s,writable:o}=n.createTransformStream();this.#r=o.getWriter(),this.#n=s.pipeTo(new WritableStream({write(i){r.enqueue(i)},close(){r.terminate()},abort(i){r.error(i)}})),typeof this.#t=="function"&&this.#t(n.name)}}if(this.#r!==null)return this.#r.write(e);r.enqueue(e)}async flush(){this.#r!==null&&(this.#r.close(),this.#r=null),this.#n!==null&&(await this.#n,this.#n=null)}},pm=1024*1024/4,qt=class{#e;#t;#r;constructor(e,r=pm){this.#e=e,this.#t="",this.#r=r}async transform(e,r){if(typeof this.#t!="string"&&await this.#o(r),typeof e=="string"){if(this.#t+=e,this.#n>=this.#r)return this.#o(r)}else this.#t=e,await this.#o(r)}async flush(e){await this.#o(e),await this.#e(!0)}get#n(){return this.#t.length}async#o(e){let r=this.#t;if(this.#n!==0){this.#t="";for(let n=0;n<r.length;){let s=n===0&&r.length-n<this.#r*1.5?r:r.slice(n,n+this.#r);e.enqueue(s),n+=s.length,await this.#e(!1,s.length)}}}};function fm(t){try{return new URL(t,location.origin).origin===location.origin}catch{return!1}}function mm(t){return t.ok}function dm(t){return t.headers.get("x-file-encoded-size")||t.headers.get("content-length")}function hm(t){return t.headers.get("x-file-size")||(fm(t.url)&&!t.headers.get("content-encoding")?t.headers.get("content-length"):void 0)}function gm(t){return t.headers.get("x-file-created-at")||t.headers.get("last-modified")||void 0}function ym(t){let e=t?Object.keys(t):[],r=["name","createdAt","elapsedTime","data"];return!(e.length!==4||e.some(n=>!r.includes(n)))}function Am(t,e,{size:r,compression:n,encoding:s}){let o=null;if(ym(t)){let{data:A,...h}=t;t=A,e={...e,createdAt:A.createdAt},o=h}let i=t,a=o||{},{type:l,name:c,encoding:p,size:u,encodedSize:f,createdAt:m,...d}=e||{};return{resource:{type:l||"unknown",name:c||"unknown",compression:n,encoding:s,...Number.isFinite(r)?{size:r}:null,...Number.isFinite(f)?{encodedSize:f}:null,createdAt:new Date((typeof m=="string"?Date.parse(m):m)||Date.now()),...d},meta:a,data:i}}async function Tm(t,e,r,n){let s=Date.now(),o=[...Rt(e),jt,wn],i=0,a=!1,l="unknown",c=0;await n("receiving",f(!1));let u=t.pipeThrough(new TransformStream(new qt(m))).pipeThrough(new TransformStream(new Vt(_i,A=>a=A))).getReader();try{let A=await u.read(),{value:h,done:y}=A;if(y)throw new Error("Empty payload");for(let{name:T,test:C,streaming:b,decode:E}of o)if(C(h)){l=T;let S=d(u,A);return{data:await(b?E(S):Pi(S).then(g(E))),compression:a,encoding:l,size:c,decodingTime:i}}throw new Error("No matched encoding found for the payload")}finally{u.releaseLock()}function f(A){return{done:A,elapsed:Date.now()-s,units:"bytes",completed:c,total:r}}async function m(A,h=0){c+=h,await n("receiving",f(A))}async function*d(A,h){for(;;){let{value:y,done:T}=h||await A.read();if(h=void 0,T)break;let C=performance.now();yield y,i+=performance.now()-C}}function g(A){return async h=>{await n("decoding",void 0,l);let y=performance.now();try{return await A(h)}finally{i=performance.now()-y}}}}async function bm(t,e){try{await e.asyncSet({stage:"request"});let r=new Date,{method:n,stream:s,resource:o,options:i,data:a}=await t(),l=new Date,c=o?.size,{encodings:p}=i||{},{data:u,compression:f=!1,encoding:m="unknown",size:d=void 0,decodingTime:g=0}=a?{data:a}:await Tm(s,p,Number(c)||0,(E,S,k)=>e.asyncSet({stage:E,progress:S,step:k}));await e.asyncSet({stage:"received"});let{data:A,resource:h,meta:y}=Am(u,o,{size:d,compression:f,encoding:m}),T=new Date,C=Number(T)-Number(r),b=Math.round(g||0);return{loadMethod:n,resource:h,meta:y,data:A,timings:{time:C,start:r,end:T,loadingTime:C-b,decodingTime:b,requestTime:Number(l)-Number(r),requestStart:r,requestEnd:l,responseTime:Number(T)-Number(l),responseStart:l,responseEnd:T}}}catch(r){throw console.error("[Discovery] Error loading data:",r),await e.asyncSet({stage:"error",error:r}),r}}function Pn(t,e){let r=new Dt({stage:"inited"});return{state:r,dataset:t(r),...e}}function Nn(t){return e=>bm(t,e)}function Ni(t,e){return Pn(Nn(()=>({method:"stream",stream:t,resource:e?.resource,options:e})))}function In(t,e){let r=Mi(t);return Pn(Nn(()=>({method:"file",stream:t.stream(),resource:e?.resource||r,options:e})),{title:"Load data from file: "+(r?.name||"unknown")})}function Ii(t,e){let n=(t.dataTransfer||t.clipboardData||t.target)?.files?.[0];if(t.stopPropagation(),t.preventDefault(),!n)throw new Error("Can't extract a file from an event object");return In(n,e)}function Oi(t,e){return e=e||{},Pn(Nn(async()=>{let r=await fetch(t,e.fetch),n=Mi(r,e);if(n&&r.body)return{method:"fetch",stream:r.body,resource:e.resource||n,options:e};let s=r.headers.get("content-type")||"",o=await r.text();if(s.toLowerCase().startsWith("application/json"))try{let i=JSON.parse(o);o=i.error||i}catch{}throw o=new Error(o),o.isFetchError=!0,o.status=r.status,o.statusText=r.statusText,o.stack=null,o}),{title:`Load data from url: ${t}`})}function Mi(t,e){if(t instanceof Response){let r=e?.isResponseOk||mm,n=e?.getContentSize||hm,s=e?.getContentEncodedSize||dm,o=e?.getContentCreatedAt||gm;if(r(t))return{type:"url",name:t.url,size:Number(n(t))||null,encodedSize:Number(s(t)),createdAt:o(t)}}if(t instanceof File)return{type:"file",name:t.name,size:t.size,createdAt:t.lastModified};if(t instanceof Blob)return{size:t.size};if(ArrayBuffer.isView(t))return{size:t.byteLength};if(typeof t=="string")return{size:t.length}}var{toString:Cm,hasOwnProperty:Sm}=Object.prototype,zt=t=>Cm.call(t),v=Object.hasOwn||((t,e)=>Sm.call(t,e));var Ie=class{listeners;constructor(){this.listeners=Object.create(null)}on(e,r){return this.listeners[e]={callback:r,next:this.listeners[e]||null},this}once(e,r){return this.on(e,function n(...s){r.apply(this,s),this.off(e,n)})}off(e,r){let n=this.listeners[e]||null,s=null;for(;n!==null;){if(n.callback===r){n.callback=null,s?s.next=n.next:this.listeners[e]=n.next;break}s=n,n=n.next}return this}emit(e,...r){let n=this.listeners[e]||null,s=!1;for(;n!==null;)typeof n.callback=="function"&&n.callback.apply(this,r),s=!0,n=n.next;return s}};var ce=class extends Ie{#e;#t;static define(e,r,n){return e.#e.set(r,n),e.emit("define",r,n),n}constructor(e){super(),this.#e=new Map,this.#t=!!e}revoke(e){if(!this.#t)throw new Error("Entry revoking is not allowed");this.#e.delete(e),this.emit("revoke",e)}isDefined(e){return this.#e.has(e)}has(e){return this.#e.has(e)}get(e){return this.#e.get(e)}get names(){return[...this.#e.keys()]}get keys(){return this.#e.keys()}get values(){return this.#e.values()}get entries(){return this.#e.entries()}};function Fi(t,e){let{ast:r}=K.syntax.parse(e),n={view:t};if(r.type!=="Block")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): query root must be a "Block"');if(r.body.type!=="Object")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): query root must return an "Object"');for(let s of r.body.properties){if(s.type!=="ObjectEntry")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): unsupported object entry type "'+s.type+'"');let o,i=s.value;switch(s.key.type){case"Literal":o=s.key.value;break;case"Identifier":o=s.key.name,i||=s.key;break;case"Reference":o=s.key.name.name,i||=s.key;break;default:throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): unsupported object key type "'+s.key.type+'"')}if(o==="view"||o==="postRender")throw new SyntaxError('[Discovery] ViewModel#queryToConfig(): set a value for "'+o+'" property in shorthand notation is prohibited');o==="when"||o==="data"||o==="whenData"?n[o]=i.type==="Literal"&&typeof i.value!="string"?i.value:K.syntax.stringify(i):n[o]=i.type==="Literal"&&(typeof i.value!="string"||i.value[0]!=="=")?i.value:"="+K.syntax.stringify(i)}return n}var ji=Object.freeze({type:void 0}),Vi=Object.freeze({view:""}),qi=new WeakMap,Ri=new WeakMap,Em=new Set(["view","when","context","data","whenData","postRender"]);function km(t){return typeof t=="string"||Array.isArray(t)||t!==null&&typeof t=="object"&&typeof t.view=="string"}function de(t,e){return qi.set(t,e),t}function wm(){return{name:"config-error",options:ji,render(t,e){t.appendText(`[Error: ${e.reason}]`),"config"in e}}}function Di(t,e,r,n,s,o,i,a){return!v(r,t)||r[t]===void 0||e.host.queryBool(r[t]===!0?"":r[t],n,s)?!0:(e.viewEls.set(a,{skipped:t,config:r,inputData:o,inputDataIndex:i,data:n,context:s}),!1)}var ee=class t{type;children;border;constructor(e="inline",r){if(this.type=e,this.children=[],this.border=null,Array.isArray(r))for(let n of r)this.append(n)}appendText(e){this.append(new $t(e))}appendInlineBlock(){let e=new t("inline-block");return this.append(e),e}appendBlock(){let e=new t("block");return this.append(e),e}appendLine(){let e=new t("line");return this.append(e),e}append(e){return this.children.push(e),this}setBorder(e){if(!e){this.border=null;return}this.border=typeof e=="string"?new Qe(e,e,e,e):Array.isArray(e)?new Qe(...e):new Qe(e.top||null,e.right||null,e.bottom||null,e.left||null)}},$t=class{value;constructor(e){this.value=String(e)}},et=class{node;constructor(){this.node=null}setNode(e){this.node=e}};function Ze(t,e=0,r=t.length-1){let n=t[e].length;for(let s=e+1;s<=r;s++)n=Math.max(n,t[s].length);return n}function Bi(t,e){return t.length>e?t.slice(0,e):t}function xm(t,e=t,r=e,n=t){return(s,o)=>o===1?n:s===0?t:s+1===o?r:e}function vi(t){return Array.isArray(t)?xm(...t):t}function _m(t,e=t,r=e){return(n,s,o)=>`${t}${"".padStart(n+s+o-t.length-r.length,e)}${r}`}function Ui(t){return Array.isArray(t)?_m(...t):t}var Qe=class{top;left;right;bottom;constructor(e=null,r=null,n=e,s=r){this.top=e||null,this.left=s||null,this.right=r||null,this.bottom=n||null}render(e,r,n){let s=vi(this.left),o=vi(this.right),i=Ui(this.top),a=Ui(this.bottom),l=Ze(e),c=0,p=0;if(s){if(typeof s=="function"){let u=e.map((f,m)=>String(s(m,e.length)??""));c=Ze(u),e=e.map((f,m)=>u[m].padEnd(c)+f)}else c=s.length,e=e.map(u=>s+u);if(c>0)for(let u=0;u<e.length;u++)r[u].unshift({length:c,node:n})}if(o)if(typeof o=="function"){let u=e.map((f,m)=>String(o(m,e.length)??""));if(p=Ze(u),p>0){for(let f=0;f<e.length;f++)r[f].push({length:c+l-e[f].length+p,node:n});e=e.map((f,m)=>f.padEnd(c+l)+u[m].padStart(p))}}else{p=o.length;for(let u=0;u<e.length;u++)r[u].push({length:c+l-e[u].length+p,node:n});e=e.map(u=>u.padEnd(c+l)+o)}if(i||a){let u=l+c+p;if(i){let f=typeof i=="function"?i(l,c,p)||"":"".padStart(u,i);f&&(e.unshift(Bi(f,u)),r.unshift([{length:e[0].length,node:n}]))}if(a){let f=typeof a=="function"?a(l,c,p)||"":"".padStart(u,a);f&&(e.push(Bi(f,u)),r.push([{length:e[e.length-1].length,node:n}]))}}return{spans:r,lines:e}}};async function zi(t,e,r,n,s,o,i,a,l){let c=new ee(e.options.type||"inline");e.options.border&&c.setBorder(e.options.border),await e.render(c,s,o,i),typeof n.postRender=="function"&&await n.postRender(c,n,o,i);let p={config:n,props:s,inputData:a,inputDataIndex:l,data:o,context:i};return t.viewEls.set(c,p),r.setNode(c),r}function Li(t,e,r,n){return zi(t,t.defaultRenderErrorRenderer,r,Vi,{type:"render",reason:e,config:n})}function Pm(t,e){return{name:e,normalizeConfig:t.normalizeConfig.bind(t),ensureValidConfig:t.ensureValidConfig.bind(t),composeConfig:t.composeConfig.bind(t),propsFromConfig:t.propsFromConfig.bind(t),render:t.render.bind(t),listLimit:t.listLimit.bind(t),renderList:t.renderList.bind(t)}}async function $i(t,e,r,n,s,o){if(Array.isArray(r))return Promise.all(r.map(c=>$i(t,e,c,n,s,o))).then(c=>new ee("inline",c));let i=n&&typeof s=="number"?n[s]:n,a=null;switch(typeof r.view){case"function":a={name:!1,options:ji,render:r.view};break;case"string":a=t.get(r.view)||null;break}e||(e=new ee);let l=new et;if(e.append(l),!a){let c=typeof r.view=="string"?"View `"+r.view+"` is not found":"Render is not a function";return t.host.logger.error(c,r),Li(t,c,l,r)}try{if(Di("when",t,r,i,o,n,s,l)){let c="context"in r?await t.host.query(r.context,i,o):o,p="data"in r?await t.host.query(r.data,i,c):i;if(Di("whenData",t,r,p,c,n,s,l))return await zi(t,a,l,r,t.propsFromConfig(r,p,c),p,c,n,s)}return l}catch(c){return t.host.logger.error("View render error:",c.message),Li(t,String(c),l,Vi)}}var Ht=class t extends ce{host;defaultRenderErrorRenderer;viewEls;constructor(e){super(),this.host=e,this.defaultRenderErrorRenderer=wm(),this.viewEls=new WeakMap}define(e,r,n){let s=km(r)||typeof r=="function"?{...n,render:r}:r,{render:o=[],...i}=s,{type:a,props:l}=i;return t.define(this,e,Object.freeze({name:e,options:Object.freeze({...s,type:typeof a=="string"||a===void 0?a:void 0,props:typeof l=="string"?this.host.queryFn(l):l}),render:typeof o=="function"?o.bind(Pm(this,e)):(c,p,u,f)=>this.render(c,o,u,f)}))}normalizeConfig(e){if(!e)return null;if(Array.isArray(e)){let r=[];for(let n of e){let s=this.normalizeConfig(n);s!==null&&(Array.isArray(s)?r.push(...s):r.push(s))}return r}if(typeof e=="string"){let[,r,n,s]=e.match(/^(\S+?)([:{])((?:.|\s)+)$/)||[];if(r){if(n==="{")try{return de(Fi(r,n+s),e)}catch(o){return de(this.badConfig(e,o),e)}return de({view:r,data:s},e)}return de({view:e},e)}else if(typeof e=="function")return de({view:e},e);return e}badConfig(e,r){let n=r?.message||"Unknown error";return this.host.logger.error(n,{config:e,error:r}),{view:this.defaultRenderErrorRenderer.render,type:"config",reason:n,config:e}}ensureValidConfig(e){return Array.isArray(e)?e.map(r=>this.ensureValidConfig(r)).flat():!e||!e.view?this.badConfig(e,new Error(e?"Option `view` is missed":"Config is not a valid value")):e}composeConfig(e,r){return e=this.normalizeConfig(e),r=this.normalizeConfig(r),e&&r?Array.isArray(e)?e.map(n=>de({...n,...r},[n,r])):de({...e,...r},[e,r]):e||r}propsFromConfig(e,r,n,s=this.get(e?.view)?.options.props){let o={};for(let[i,a]of Object.entries(e))Em.has(i)||(o[i]=typeof a=="string"&&a.startsWith("=")?this.host.query(a.slice(1),r,n):a);if(typeof s=="function"){let i=s(r,{props:o,context:n});i!==null&&typeof i=="object"&&i!==o&&(Ri.set(i,{props:o,fn:s}),o=i)}return o}textWidth(e){if(e===null)return 0;if(e instanceof ee){let r=0;for(let n of e.children)r+=this.textWidth(n);return r}else return e instanceof et?this.textWidth(e.node):e.value.length}cleanUpRenderTree(e){if(e===null)return null;if(e instanceof et)return this.cleanUpRenderTree(e.node);if(e instanceof ee){let r=e.children.map(this.cleanUpRenderTree,this).filter(o=>o!==null);if(r.length===0)return null;let n=this.viewEls.get(e),s=e.border;e=new ee(e.type,r),e.border=s,n&&this.viewEls.set(e,n)}else if(e.value==="")return null;return e}serialize(e){let r=this.cleanUpRenderTree(e),n=[],s="";if(r!==null){let{lines:a,spans:l}=i(r,null),c=0;for(let p of l){for(let u of p)if(u.length>0){let f=c+u.length;n.push({range:[c,f],view:(u.node&&this.viewEls.get(u.node))??null}),c=f}c++}s=a.join(`
`)}return{text:s,ranges:n};function o(a,l,c,p,u){if(l<a.length&&a[l].length<c){let f=a[l],m=f.padEnd(c),g=p[l].at(-1);a[l]=m,g?g.length+=m.length-f.length:p[l].push({length:m.length,node:u})}}function i(a,l){if(a instanceof $t){let f=a.value.split(/\r\n?|\n/);return{spans:f.map(m=>[{length:m.length,node:l}]),lines:f}}let c=[[]],p=[""],u=0;if(a instanceof ee){let f="none";for(let m of a.children){let d=m instanceof ee?m.type:"inline",{lines:g,spans:A}=i(m,a);if(g.length>0){switch(d){case"block":u=p.length-1,p[u]!==""?(c.push([]),p.push("")):u>0&&p[u]!==""?(c.push([]),p.push("")):u===0&&(c.pop(),p.pop()),c.push(...A),p.push(...g),c.push([]),u=p.push("")-1;break;case"line":f==="block"||p[u]===""&&(c.pop(),p.pop()),c.push(...A),p.push(...g),c.push([]),u=p.push("")-1;break;case"inline-block":{f==="block"?(u=p.push("")-1,c.push([])):(f==="inline"||f==="inline-block")&&o(p,u,Ze(p,u)+1,c,a);let h=p[u].length;if(c[u].push(...A[0]),p[u]+=g[0],g.length>1){let y=g.length-(p.length-u);for(let T=0;T<y;T++)c.push([]),p.push("");for(let T=1;T<g.length;T++)o(p,u+T,h,c,a),c[u+T].push(...A[T]),p[u+T]+=g[T]}break}case"inline":if(f==="block"?(u=p.push("")-1,c.push([])):f==="inline-block"&&o(p,u,Ze(p,u)+1,c,a),c[u].push(...A[0]),p[u]+=g[0],g.length>1)for(let h=1;h<g.length;h++)u=p.push(g[h])-1,c[u]=A[h];break}f=d}}for(;f!=="inline"&&p[u]==="";)u--,c.pop(),p.pop();if(a.border)return a.border.render(p,c,a)}return{spans:c,lines:p}}}async render(e,r,n,s,o){return typeof e=="string"?e=new ee(e):e||(e=new ee),await $i(this,e,this.ensureValidConfig(this.normalizeConfig(r)),n,o,s),e}async renderString(e,r,n,s,o){return this.serialize(await this.render(e,r,n,s,o))}listLimit(e,r){return e===!1?!1:!e||isNaN(e)?r:Math.max(parseInt(e,10),0)||r}renderList(e,r,n,s,o){let{offset:i=0,moreContainer:a,beforeItem:l,afterItem:c,beforeMore:p=l,afterMore:u=c}=o,{limit:f=!1}=o;f===!1&&(f=n.length);let m=Promise.all(n.slice(i,i+f).map((d,g,A)=>{l&&e.appendText(l);let h=this.render(e,r,n,{...s,index:i+g,array:n,sliceIndex:g,slice:A},i+g);return c&&e.appendText(c),h}));return this.maybeMore(a||e,null,n.length,i+f,p,u),m}maybeMore(e,r,n,s,o,i){if(n>s){let a=n-s;e.appendText((o||"")+"("+a+" more\u2026)"+(i||""))}}getViewConfigTransitionTree(e){let r=qi.get(e)||[];return Array.isArray(r)||(r=[r]),{value:e,deps:r.map(this.getViewConfigTransitionTree,this)}}getViewPropsTransition(e){let r=Ri.get(e)||null;return r&&{props:r.props,fn:r.fn,query:r.fn.query||null}}};var Wt={};O(Wt,{alert:()=>On,badge:()=>Mn,block:()=>Fn,blockquote:()=>Rn,context:()=>Dn,headerViews:()=>Bn,link:()=>vn,listViews:()=>Un,source:()=>Ln,switchView:()=>jn,table:()=>$n,textViews:()=>Hn});var On={};O(On,{default:()=>Nm});var Hi=t=>({demo:`${t}:"hello world\\nsome text..."`});function Nm({textView:t}){t.define("alert",{type:"block",usage:Hi,border:{top:["\u2554","\u2550","\u2557"],left:"\u2551 ",right:" \u2551",bottom:["\u255A","\u2550","\u255D"]},render(e,r,n,s){let{content:o="text"}=r;return t.render(e,o,n,s)}})}var Mn={};O(Mn,{default:()=>Im});var Gi=(t,e)=>({demo:{view:t,text:"hello world"},examples:[{title:"Variations",demo:e.map(r=>[`${r}:"${r}"`,`${r}:"${r}\\nmulti-line"`,`${r}:"${r}\\nmulti-line\\nmore..."`]).flat()},{title:"Complex content",highlightProps:["content"],demo:{view:t,content:['text:"text"','link:"#example"','text:"text"']}}]});function Im({textView:t}){let e={type:"inline-block",usage:Gi,props:`is not array? | {
            text: #.props has no 'content' ? is (string or number or boolean) ?: text,
            content: undefined,
            prefix,
            postfix
        } | overrideProps()`,render(r,n,s,o){let{text:i,content:a,prefix:l,postfix:c}=n,p;return l&&r.appendText(String(l)+" "),a?p=this.render(r,a,s,o):r.appendText(String(i)),c&&r.appendText(" "+String(c)),p}};t.define("badge",{...e,border:{left:["\u23A1","\u23A2","\u23A3","["],right:["\u23A4","\u23A5","\u23A6","]"]}}),t.define("pill-badge",{...e,border:{left:["\u23A7","\u23AA","\u23A9","("],right:["\u23AB","\u23AA","\u23AD",")"]}})}var Fn={};O(Fn,{default:()=>Om});var tt=(t,e)=>({demo:`${t}:'just a text'`,examples:[{title:"Variations",demo:e.map(r=>[`header:"${r}"`,'text:"\u2026text\u2026"',`${r}:"\u23A1${r}\u23A6"`,'text:"\u2026text\u2026"',`${r}:"\u23A1${r}\\nmulti-line\u23A6"`,'text:"\u2026text\u2026"',`${r}:"\u23A1${r}\\nmulti-line\\nmore and more\u2026\u23A6"`,'text:"\u2026text\u2026"']).flat()},{title:"Variations with border",demo:e.map(r=>[`header:"${r}"`,'text:"\u2026text\u2026"',`${r}{ border: [null, " |", null, "| "], data:"\u23A1${r}\u23A6" }`,'text:"\u2026text\u2026"',`${r}{ border: [null, " |", null, "| "], data:"\u23A1${r}\\nmulti-line\u23A6" }`,'text:"\u2026text\u2026"',`${r}{ border: [null, " |", null, "| "], data:"\u23A1${r}\\nmulti-line\\nmore and more\u2026\u23A6" }`,'text:"\u2026text\u2026"']).flat()}]});function Om({textView:t}){function e(r,n,s,o){let{content:i="text",border:a}=n;return a&&r.setBorder(a),t.render(r,i,s,o)}t.define("inline",{type:"inline",usage:tt,render:e}),t.define("inline-block",{type:"inline-block",usage:tt,render:e}),t.define("block",{type:"block",usage:tt,render:e}),t.define("line",{type:"line",usage:tt,render:e})}var Rn={};O(Rn,{default:()=>Mm});var Wi=t=>({demo:{view:t,content:['text:"Blockquote text..."','blockquote:"Nested blockquote\\nmulti-line text..."']},examples:[{title:"Variations",demoData:"Blockquote text...",demo:[{kind:"",text:"Default blockquote without any kind."},{kind:"note",text:"Useful information that users should know, even when skimming content."},{kind:"tip",text:"Helpful advice for doing things better or more easily."},{kind:"important",text:"Key information users need to know to achieve their goal."},{kind:"warning",text:"Urgent info that needs immediate user attention to avoid problems."},{kind:"caution",text:"Advises about risks or negative outcomes of certain actions."}].map(({kind:e,text:r})=>e?`${t}{ kind: "${e}", data: ${JSON.stringify(r)} }`:`${t}:${JSON.stringify(r)}`)}]});var Yi=Wi;function Mm({textView:t}){t.define("blockquote",function(e,r,n,s){let{content:o="text",kind:i}=r;return typeof i=="string"&&/\S/.test(i)&&e.appendLine().appendText(`[!${i.trim().toUpperCase()}]`),t.render(e,o,n,s)},{type:"block",usage:Yi,border:{left:"> "}})}var Dn={};O(Dn,{default:()=>Fm});var Ji={beforeDemo:['md:"A non-visual view used to group views, manage their visibility, or explicitly define data and context for nested views. In the example, the `context` view sets up specific data and context, allowing nested views (`content`) to utilize these shared definitions directly:"'],demo:{view:"context",data:{name:"World",age:"1000 years"},context:'{ ...#, greeting: "Hello" }',content:["text:`${#.greeting}, ${name}!`","table"]}};function Fm({textView:t}){t.define("context",function(e,r,n,s){let{content:o=[]}=r;return t.render(e,o,n,s)},{usage:Ji})}var Bn={};O(Bn,{default:()=>Rm});var he=(t,e)=>({demo:`${t}:"Header \\"${t}\\""`,examples:[{title:"Variations",view:e.map(r=>`${r}:"Header \\"${r}\\""`)},{title:"Complex content",demo:{view:t,content:['text:"Text "','link:{ text: "Link" }']}},{title:"Using anchor",demo:[{view:t,anchor:"foo",content:'text:"Explicit value for an anchor"'},{view:t,anchor:!0,content:'text:"Auto generated anchor based on text content of header"'}]}]});function Rm({textView:t}){function e(r){let n="#".repeat(r)+" ";return async function(o,i,a,l){let{content:c}=i;return o.appendText(n),t.render(o,c||"text",a,l)}}t.define("header",e(1),{type:"block",usage:he}),t.define("h1",e(1),{type:"block",usage:he}),t.define("h2",e(2),{type:"block",usage:he}),t.define("h3",e(3),{type:"block",usage:he}),t.define("h4",e(4),{type:"block",usage:he}),t.define("h5",e(5),{type:"block",usage:he})}var vn={};O(vn,{default:()=>Bm});var Ki={demo:{view:"link",text:"I am a link",href:"#example"},examples:[{title:"Infering text \u21FF href",highlightProps:["text","href","data"],beforeDemo:['md:"When `text` is omitted but `href` is specified, or vice versa, the opposite component is inferred from the specified one"'],demo:[{view:"link",text:"http://example1.com"},{view:"link",href:"http://example2.com"},{view:"link",data:'"http://example3.com"'}]}]};var Dm=`is not array? | {
    text: #.props.content is undefined ? is string ?: text,
    content: undefined,
    href
} | overrideProps() | {
    $text; $href;
    ...,
    text: $text | is not undefined or no $href ?: $href,
    href: $href | is not undefined or no $text ?: $text
}`;function Bm({textView:t}){t.define("link",async function(e,r,n,s){let{text:o,content:i,href:a}=r;a&&e.appendText("["),i?await t.render(e,i,n,s):e.appendText(o),a&&e.appendText(`](${a})`)},{type:"inline-block",props:Dm,usage:Ki})}var Un={};O(Un,{default:()=>vm});var Oe=(t,e)=>({demo:{view:t,data:["one","two","three","four"]},examples:[{title:"Variations",demoData:["foo","bar","baz"],demo:e.map(r=>[`header:'view: \\"${r}\\"'`,r]).flat()},{title:"Variations long lists",demoData:Array.from({length:100},(r,n)=>"item#"+n),demo:e.map(r=>[`header:'view: \\"${r}\\"'`,{view:r,limit:3}]).flat()},{title:"Configure item's content",demo:[{view:t,data:["one","two","three","four"],item:['text:"<item> "',{view:"link",data:'{ href: "#" + $ }'}]}]}]});function vm({textView:t}){t.define("list",e("line",""),{type:"block",usage:Oe}),t.define("inline-list",e("inline-block"),{type:"inline-block",usage:Oe}),t.define("comma-list",e("inline-block","",","),{type:"inline-block",usage:Oe}),t.define("ol",e("line",r=>1+r.index+". "),{type:"block",usage:Oe}),t.define("ul",e("line","- "),{type:"block",usage:Oe}),t.define("list-item",function(r,n,s,o){let{content:i="text",bullet:a,delim:l,renderType:c="line"}=n,p=typeof a=="function"?a:a?()=>a:null,u=typeof l=="function"?l:l?()=>l:null;return r.type=c,(p||u)&&r.setBorder({left:p?f=>f===0?p(o):"":null,right:u?f=>f===0&&o.index!==o.array.length-1?u(o):"":null}),t.render(r,i,s,o)});function e(r,n,s){return async function(i,a,l,c){let{item:p,itemConfig:u,limit:f,emptyText:m}=a,d;return!Array.isArray(l)&&l&&(l=[l]),Array.isArray(l)&&l.length>0?d=t.renderList(i,this.composeConfig({view:"list-item",content:p,bullet:n,delim:s,renderType:r},u),l,c,{limit:t.listLimit(f,25)}):i.appendText(String(m||"<empty list>")),d}}}var Ln={};O(Ln,{default:()=>jm});var Gt='let name = "world";\n\nconsole.log(`Hello, ${name}!`);',Um=Function("return num => num + 5")(),Xi={demo:{view:"source",syntax:"js",source:Gt},examples:[{title:"Custom line numbers",highlightProps:["lineNum"],demo:[{view:"source",source:Gt,syntax:"js",lineNum:Um},{view:"source",source:Gt,syntax:"js",lineNum:"==> $ + 12345"}]},{title:"Hide line numbers",highlightProps:["lineNum"],beforeDemo:['md:"Pass falsy value to `lineNum` option to hide line numbers:"'],demo:{view:"source",source:Gt,syntax:"js",lineNum:!1}},{title:"Marks",highlightProps:["marks"],beforeDemo:{view:"md",source:["The `marks` option allows injecting text marks at specific points in the source text. The `marks` value must be an array of objects with the following fields:",`
`,"- `offset` (required) - the offset in the source where the mark is injected.","- `content` - view config for content (e.g., `'text:\"hello\"'` or `{ view: 'name', ... }`)","- `prefix` - text to display before the content of mark","- `postfix` - text to display after the content of mark"]},demo:{view:"source",source:`let demo = "mark";

if (expr) {
  // do something
}`,syntax:"js",marks:[{offset:4},{offset:4,content:'text:"mark"'},{offset:24,prefix:"self: ",content:'text:"123"',postfix:"ms"}]}}]};var Lm=`is not array? | {
    source: #.props has no 'source' ? is string ?: content is string ? content : source,
    syntax,
    lineNum is function ?: is not undefined ? bool() : true,
    marks is array ?: null
} | overrideProps()`;function jm(t){t.textView.define("source",{type:"block",props:Lm,usage:Xi,async render(e,r,n,s){let o=[],{source:i,syntax:a,lineNum:l=!0,marks:c}=r,p={...s,sourceViewProps:{source:i,syntax:a,lineNum:l,marks:c}};if(typeof i!="string")return;let u=typeof l=="function"?l:g=>g+1,f=l?i.split(/\r\n?|\n/g).map((g,A)=>String(u(A))):[];if(f.length>2){let g=f.reduce((A,h)=>Math.max(A,h.length),3);for(let A=0;A<f.length;A++)f[A].length<g&&(f[A]=f[A].padStart(g))}if(e.appendLine().appendText(`\`\`\`${a||""}`),e.appendText(m()),Array.isArray(c)){for(let A of c){if(!A||typeof A!="object"){t.logger.warn('Bad value for an entry in "source" view props.mark, must be an object',{props:r,mark:A});return}let h=typeof A.offset=="number"&&isFinite(A.offset)?Math.max(0,Math.round(A.offset)):void 0;if(typeof h!="number"){t.logger.warn('Bad "offset" value for an entry in "source" view props.marks',{props:r,mark:A});return}o.push({...A,offset:Math.max(0,Math.min(h,i.length))})}o.sort((A,h)=>A.offset-h.offset);let g=0;for(let A of o){let{offset:h,content:y=[],prefix:T="",postfix:C=""}=A;h>g&&(d(i.slice(g,h)),g=h),e.appendText("/* "+T),await this.render(e,y,A,p),e.appendText(C+" */")}g<i.length&&d(i.slice(g))}else d(i);e.appendLine().appendText("```");function m(){let g=f.shift();return typeof g=="string"?g+" \u2502 ":""}function d(g){let A=g.split(/\r\n?|\n/);e.appendText(A[0]);for(let h=1;h<A.length;h++)e.appendText(`
`+m()+A[h])}}})}var jn={};O(jn,{default:()=>Vm});var Zi={demo:{view:"switch",content:[{when:"expr",content:'text:"Renders when `expr` is truthy"'},{content:'text:"Renders when all other `when` conditions are falsy"'}]}};function Vm(t){t.textView.define("switch",function(e,r,n,s){let{content:o}=r,i='text:"<switch: no case choosen>"';if(Array.isArray(o)){for(let a of o)if(a&&t.queryBool(a.when||!0,n,s)){i="data"in a?{view:"context",data:a.data,content:a.content}:a.content;break}}return t.textView.render(e,i,n,s)},{usage:Zi})}var $n={};O($n,{default:()=>$m});function Qi(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Vn(t){return Array.isArray(t)||Qi(t)}function qn(t){return zt(t)==="[object Set]"}var qm=[{name:"Alice",age:34,occupation:"Engineer"},{name:"Bob",age:42,occupation:"Doctor"},{name:"Charlie",age:9,occupation:"Student"},{name:"David",age:50,occupation:"Doctor"},{name:"Eve",age:15,occupation:"Engineer"}],ea={demoData:qm,demo:{view:"table",limit:2,cols:{age:{footer:"text:sum(=>age)"},occupation:{footer:{}}}}};function zn(t,e){return{header:t,view:"table-cell",data:e}}function zm(t,e,r){return typeof e=="string"&&(e={content:e}),v(e,"content")||v(e,"data")?{header:t,view:"table-cell",...e}:{...zn(t,r),...e}}function $m(t){let e=t.queryFn("is not object");t.textView.define("table",async function(r,n,s,o){let{rows:i,cols:a,valueCol:l=!1,headerWhen:c=!0,footerWhen:p=!0,limit:u=25}=n,f=0;"rows"in n||(i=s),qn(i)&&(i=[...i]),Vn(i)||(i=i?[i]:[]),u!==!1&&i.length>u&&(f=i.length-u,i=i.slice(0,u));let m=[];if(Array.isArray(a))a=a.map((b,E)=>typeof b=="string"?zn(b,t.pathToQuery([b])):{header:"col"+E,view:"table-cell",...b});else{let b=new Set,E=a&&typeof a=="object"?a:{};a=[];for(let S of i)if(e(S))l=!0;else for(let k of Object.keys(S))b.add(k);for(let S of Object.keys(E))E[S]?b.add(S):b.delete(S);for(let S of b)a.push(v(E,S)?zm(S,E[S],t.pathToQuery([S])):zn(S,t.pathToQuery([S])))}if(l&&a.unshift({header:"[value]",view:"table-cell",details:!1}),a=a.filter(b=>!v(b,"colWhen")||t.queryBool(b.colWhen,s,o)),!a.length)return r.appendText(`
<empty table>
`);let d=t.query(c,s,o),g=t.query(p,s,o),A=Array.from(i,()=>[]),h=[],y=[];for(let b of a){let E=String(b.header).trim(),S=0;if(d){let k=await this.render(null,"text",E),w=t.textView.textWidth(k);S=Math.max(S,w),m.push({width:w,content:k})}for(let k=0;k<i.length;k++){let w=await this.render(null,b,i[k],o),F=t.textView.textWidth(w);S=Math.max(S,F),A[k].push({width:F,align:b.align,content:w})}if(g&&b.footer){let k=typeof b.footer=="object"&&b.footer!==null&&!v(b.footer,"view")?b.footer:{content:b.footer},{align:w,...F}=k,_=await this.render(null,this.composeConfig("block",F),s,o),I=t.textView.textWidth(_);S=Math.max(S,I),y.push({width:I,align:w,content:_})}else y.push(null);h.push(S)}T(h,"\u250C","\u252C","\u2510"),d&&(C(h,m),T(h,"\u251C","\u253C","\u2524"));for(let b of A)C(h,b);if(f>0){let b=h.reduce((k,w)=>k+w+3,0)+1,E=` ${f} more rows\u2026 `,S=Math.max(1,b-E.length);r.appendLine().appendText(`${"~".repeat(Math.floor(1))}${E}${"~".repeat(Math.ceil(S-1))}`),g&&y.some(k=>k!==null)&&(T(h,"\u251C","\u253C","\u2524"),C(h,y),T(h,"\u2514","\u2534","\u2518"))}else g&&y.some(b=>b!==null)&&(T(h,"\u251C","\u253C","\u2524"),C(h,y)),T(h,"\u2514","\u2534","\u2518");function T(b,E,S,k){let w=E+"\u2500".repeat((b[0]||0)+2);for(let F=1;F<b.length;F++)w+=S+"\u2500".repeat(b[F]+2);r.appendLine().appendText(w+k)}function C(b,E){let S=r.appendLine();for(let k=0;k<E.length;k++){let{width:w=0,align:F,content:_=""}=E[k]||{},I=b[k]-w+1;I>0&&F!=="right"?S.appendText("\u2502 "):S.appendText("\u2502"+" ".repeat(I)),S.append(_),I>0&&F==="right"?S.appendText(" "):S.appendText(" ".repeat(I))}S.appendText("\u2502")}},{type:"block",usage:ea}),t.textView.define("table-cell",function(r,n,s,o){let{content:i,contentWhen:a=!0}=n,l=!i&&s!==null&&(Array.isArray(s)?s.length>0:typeof s=="object")&&!(s instanceof RegExp);if(t.queryBool(a,s,o)){if(i)return t.textView.render(r,i,s,o);r.appendText(Hm(s,l))}})}function Hm(t,e){if(Array.isArray(t)||ArrayBuffer.isView(t))return t.length||"";if(e){for(let r in t)if(v(t,r))return"{\u2026}";return"{}"}return t===void 0?"":String(t)}var Hn={};O(Hn,{default:()=>Gm});var ta={demo:'text:"just a text"'};function Gm({textView:t}){t.define("text",{props:"{ text: #.props has no 'text'? } | overrideProps()",usage:ta,render(e,r){let{text:n}=r;e.appendText(String(n))}})}var Yt=class t extends ce{#e;constructor(){super(!0),this.#e=Object.create(null)}define(e,r){if(typeof r!="function")throw new Error("callback is not a function");return this.#e=Object.freeze({...this.#e,[e]:r}),t.define(this,e,Object.freeze({name:e,callback:r}))}revoke(e){if(this.has(e)){let r={...this.#e};delete r[e],this.#e=Object.freeze(r)}super.revoke(e)}get actionMap(){return this.#e}call(e,...r){let n=this.get(e);if(n===void 0)throw new Error(`action "${e}" doesn't exist`);let{callback:s}=n;return s(...r)}};var rt=new Map,Gn=null;function Wm(t){Gn=null;for(let[e,r]of rt.entries())t.warn.groupCollapsed(`${e} (${r.length})`,r);rt.clear()}function Ym(t,e,...r){Gn===null&&rt.size===0&&(Gn=setTimeout(()=>Wm(t),1));let n=rt.get(e);n!==void 0?n.push(r):rt.set(e,[r])}function sa(t,e,r){switch(typeof e){case"function":return e;case"string":return Object.assign(n=>n&&v(n,e)?n[e]:void 0,{getterFromString:`object[${JSON.stringify(e)}]`});default:throw new Error(`[Discovery] Bad type "${typeof e}" for ${r} in object marker "${t}" config (must be a string or a function)`)}}function ra(t,e,r,n){let s=e&&v(e,r)?e[r]:void 0;return s!==void 0?sa(t,s,`"${r}" option`):n}function na(t,e,r){return(Array.isArray(e[r])?e[r]||[]:[]).map(s=>sa(t,s,`"${r}" option`))}function oa(t,e=!1){return t===null?!1:e?typeof t=="object":typeof t=="object"||typeof t=="number"||typeof t=="string"}function Jm(t,e){let{name:r,indexRefs:n,lookupRefs:s,annotateScalars:o,page:i,getRef:a,getTitle:l}=e;a!==null&&n.unshift(a),i&&a===null&&t.warn(`Option "ref" for "${r}" marker must be specified when "page" options is defined ("page" option ignored)`),n.length>0&&s.unshift(A=>A);let c=new Set,p=new Map,u=new Map,f=new WeakMap;return{name:r,page:a!==null?i:null,mark:A=>{if(A===null||typeof A!="object"){t.warn(`Invalid value used for "${r}" marker (should be an object)`);return}c.add(A);for(let h of n){let y=h(A);if(oa(y)){if(!p.has(y)){p.set(y,A);continue}p.get(y)!==A&&Ym(t,`The same reference value used for different objects for "${r}" marker`,`Reference value "${y}"`,{refGetter:h.getterFromString||h,ref:y,currentObject:p.get(y),newObject:A})}}},lookup:(A,h=!1)=>{if(!oa(A,h?!o:!1))return null;let y=typeof A=="object",T=y?f.get(A):u.get(A);if(T!==void 0)return T;let C=null;if(y&&c.has(A))C=A;else for(let k of s){let w=k(A),F=p.get(w);if(F!==void 0){C=F;break}}if(C===null)return null;let b=u.get(C);if(b!==void 0)return b;let E=a!==null?a(C):null,S=Object.freeze({type:r,object:C,ref:E,title:l(C),href:i!==null&&E!==null?`#${encodeURIComponent(i)}:${encodeURIComponent(E)}`:null});return u.set(C,S),A!==C&&(y?f.set(A,S):u.set(A,S)),S},reset:()=>{c.clear(),p.clear(),u.clear(),f=new WeakMap}}}var Me=class t extends ce{constructor(e){super(),this.logger=e}#e=!1;lock(){this.#e=!0}define(e,r){if(this.#e)throw new Error("Object marker definition is not allowed after setup");if(this.isDefined(e))throw new Error(`Object marker "${e}" is already defined, new definition ignored`);r=r||{};let n=na(e,r,"refs"),s=na(e,r,"lookupRefs"),o=!!r.annotateScalars,i=r.page,a=typeof i=="string"?i:null,l=ra(e,r,"ref",null),c=ra(e,r,"title",l||(()=>null));return t.define(this,e,Object.freeze(Jm(this.logger,{name:e,indexRefs:n,lookupRefs:s,annotateScalars:o,page:a,getRef:l,getTitle:c})))}reset(){for(let{reset:e}of this.values)e()}markerMap(){return Object.fromEntries([...this.entries].map(([e,r])=>[e,r.mark]))}lookup(e,r){if(typeof r=="string")return this.get(r)?.lookup(e)||null;for(let{lookup:n}of this.values){let s=n(e);if(s!==null)return s}return null}lookupAll(e){let r=[];for(let{lookup:n}of this.values){let s=n(e);s!==null&&r.push(s)}return r}};function ia(t,e){return{before(){t.objectMarkers.reset()},contextApi:{markers:t.objectMarkers.markerMap(),setWorkTitle:e?.setPrepareWorkTitle||(()=>Promise.resolve()),rejectData(r,n){throw Object.assign(new Error(r),{renderContent:n})}}}}function Wn(t,e){let r=t.objectMarkers,n={setPrepare:t.setPrepare.bind(t),defineObjectMarker:o,addQueryHelpers(l){s={...s,...l}}},s={query:t.query.bind(t),overrideProps:i,pageLink:(l,c,p,u)=>t.encodePageHash(c,l,p,u),marker:r.lookup.bind(r),markerAll:r.lookupAll.bind(r),callAction:a,actionHandler:(l,...c)=>t.action.has(l)?()=>a(l,...c):void 0};typeof e=="function"&&e(n),r.lock(),t.queryFnFromString=K.setup({methods:s});function o(l,c){let{mark:p,lookup:u}=r.define(l,c);return u?p:()=>{}}function i(l,c=this.context.props){if(!c)return l;let p={...l};for(let u of Object.keys(p))v(c,u)&&(p[u]=c[u]);return p}function a(l,...c){let p=c[c.length-1],u=null;typeof p=="function"&&(u=p,c.pop());let f=t.action.call(l,...c);return f&&u&&typeof f.then=="function"?f.then(u):u?u(f):f}}function aa(t,e){let r=new Me(t.logger),n=[],s=[],o={setWorkTitle:e?.setPrepareWorkTitle||(()=>Promise.resolve()),rejectData(d,g){throw Object.assign(new Error(d),{renderContent:g})},defineObjectMarker:l,lookupObjectMarker:c,lookupObjectMarkerAll:p,addValueAnnotation:f,addQueryHelpers(d){a=K.setup({methods:i={...i,...d}})},query(d,...g){return t.queryFn.call({queryFnFromString:a},d)(...g)}},i={query:t.query.bind(t),overrideProps:u,pageLink:(d,g,A,h)=>t.encodePageHash(g,d,A,h),marker:c,markerAll:p,callAction:m,actionHandler:(d,...g)=>t.action.has(d)?()=>m(d,...g):void 0},a=K.setup({methods:i});return{contextApi:o,after(d){Object.assign(d,{objectMarkers:r,linkResolvers:n,annotations:s,queryFnFromString:a})}};function l(d,g){let{page:A,mark:h,lookup:y}=r.define(d,g)||{};if(!y)return()=>{};if(A!==null){if(!t.page?.isDefined(A))return t.logger.error(`Page reference "${A}" doesn't exist`),()=>{};n.push(T=>{let C=y(T);return C&&{type:A,text:C.title,href:C.href,entity:C.object}})}return f((T,C)=>{let b=y(T,!0);if(b!==null&&b.object!==C.host)return{place:"before",style:"badge",text:d,href:b.href}}),h}function c(d,g){return r.lookup(d,g)}function p(d){return r.lookupAll(d)}function u(d,g=this.context.props){if(!g)return d;let A={...d};for(let h of Object.keys(A))v(g,h)&&(A[h]=g[h]);return A}function f(d,g=!1){typeof g=="boolean"&&(g={debug:g}),s.push({query:d,...g})}function m(d,...g){let A=g[g.length-1],h=null;typeof A=="function"&&(h=A,g.pop());let y=t.action.call(d,...g);return y&&h&&typeof y.then=="function"?y.then(h):h?h(y):y}}var la=new WeakMap,ca=["variable","property","value","assertion","method"],Km=(t,e)=>ca.indexOf(t.type)-ca.indexOf(e.type),Xm=t=>{let e=t.toLowerCase();return r=>r!==t&&(typeof r=="string"?r:String(r)).toLowerCase().indexOf(e)!==-1};function Zm(t,e){return typeof t!="string"?String(t):(t=JSON.stringify(t),e[0]!=="'"?t:`'${t.slice(1,-1).replace(/\\.|'/g,r=>r==='\\"'?'"':r==="'"?"\\'":r)}'`)}function Qm(t,e,r){if(e===r)return!0;let n=t.stat(e)||[],s=t.stat(r)||[];if(n.length!==s.length)return!1;for(let o=0;o<n.length;o++){let i=n[o],a=s[o];for(let l of Object.keys(i))if(i[l]!==a[l])return!1}return!0}function ua(t,e,r,n,s){try{let o=la.get(t);if(!o||o.query!==e||o.data!==n||o.context!==s){let a={tolerant:!0,stat:!0};la.set(t,o={query:e,data:n,context:s,offset:-1,suggestions:null,api:null}),o.api=t.queryFnFromString(e,a)(n,s)}if(o.api===null)return null;if(o.offset!==-1&&Qm(o.api,o.offset,r))return o.suggestions;let i=o.api.suggestion(o.offset=r,{sort:!0,filter:Xm,limit:50});if(i){o.suggestions=[];for(let a of i.sort(Km))o.suggestions.push(...a.suggestions.map(l=>({type:a.type,from:a.from,to:a.to,text:a.text,value:a.type==="value"?Zm(l,a.text):l})))}else o.suggestions=null;return o.suggestions}catch(o){return t.logger.error("Error while attempting to retrieve suggestions for the query:",o.message),null}}var ed=new Proxy({},{get:()=>()=>{}}),Jt=["silent","error","warn","info","perf","debug"],td={error:["error","error"],warn:["warn","warn"],info:["info","info"],perf:["log","perf"],log:["log","any"],debug:["debug","debug"]},nt=class{#e;#t;#r;error;warn;info;perf;debug;log;constructor(e="",r="debug",n=console){this.#t=e,this.#r=n||ed,this.logLevel=r}shouldLogLevel(e){let r=Jt.indexOf(e);return this.#e!=="silent"&&r!==-1&&r<=Jt.indexOf(this.#e)}get logLevel(){return this.#e}set logLevel(e){if(Jt.indexOf(e)===-1&&console.error(this.#t,`Bad log level "${e}", supported: ${Jt.join(", ")}`),e!==this.#e){let n=this.#r,s=this.#t,o=a=>Function.prototype.bind.call(this.#r[a],this.#r,...this.#t?[this.#t]:[]),i=(a,l)=>(c,p)=>{n[l?"groupCollapsed":"group"](`${s} ${c}`);let f=typeof p=="function"?p():p;if(Array.isArray(f))for(let m of f)n[a](...Array.isArray(m)?m:[m]);n.groupEnd()};this.#e=e;for(let[a,[l,c]]of Object.entries(td))c==="any"||this.shouldLogLevel(c)?this[a]=Object.assign(o(l),{group:i(l,!1),groupCollapsed:i(l,!0)}):this[a]=Object.assign(()=>{},{group:()=>()=>{},groupCollapsed:()=>()=>{}})}}};function Yn(t,e,r=Object.is){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;for(let n in t)if(v(t,n)&&(!v(e,n)||!r(t[n],e[n])))return!1;for(let n in e)if(v(e,n)&&!v(t,n))return!1;return!0}var rd=()=>{},nd="[Discovery]",od=t=>/^[a-zA-Z_][a-zA-Z_$0-9]*$/.test(t)&&!sd.includes(t),sd=["and","or","in","has","is","not","no","asc","ascN","ascA","ascNA","ascAN","desc","descN","descA","descNA","descAN"],Kt=(t,e)=>({...e,encodings:Array.isArray(e?.encodings)?[...e.encodings,...t.encodings]:t.encodings}),ot=class extends Ie{options;info;logger;action;objectMarkers;linkResolvers;encodings;datasets;data;#e;prepare;#t;#r;textView;constructor(e){super(),this.options=e||{};let{name:r,version:n,description:s,icon:o,logLevel:i="warn",logger:a=console,extensions:l,encodings:c,context:p,setup:u}=e||{};this.info={name:r||"Untitled model",version:n||null,description:s||null,icon:o||null},this.logger=new nt(nd,i,a),this.action=new Yt,this.objectMarkers=new Me(this.logger),this.linkResolvers=[],this.datasets=[],this.encodings=Rt(c),this.data=void 0,this.#e=p,this.prepare=f=>f,this.#t=!0,this.textView=new Ht(this),this.apply(l),typeof u=="function"?(this.#t=!1,Wn(this,u)):Wn(this,()=>{}),this.apply(Wt);for(let{page:f,lookup:m}of this.objectMarkers.values)f&&this.linkResolvers.push(d=>{let g=m(d);return g&&{type:f,text:g.title,href:g.href,entity:g.object}})}apply(e){Array.isArray(e)?e.forEach(r=>this.apply(r)):typeof e=="function"?e.call(null,this):e&&this.apply(Object.values(e))}log(){this.logger.error("Model#log() is deprecated, use Model#logger interface instead")}get legacyPrepare(){return this.#t}setPrepare(e){if(typeof e!="function")throw new Error("An argument should be a function");this.prepare=e}get context(){return this.#e}set context(e){this.setContext(e,!0)}setContext(e,r=!1){let n=this.#e;if(r)this.#e=e;else{let s={...this.#e,...e};Yn(s,n)||(this.#e=s)}Object.is(this.#e,n)||this.emit("context",n,this.#e)}getContext(){return{model:this.info,actions:this.action.actionMap,datasets:this.datasets,data:this.data,...this.context}}setData(e,r){r=r||{};let n=Symbol();this.#r=n;let s=Date.now(),o=()=>{if(this.#r!==n)throw new Error("Prevented by another setData()")},i=this.#t?aa(this,r):ia(this,r);return Promise.resolve().then(()=>(o(),i.before?.(this),this.prepare.call(null,e,i.contextApi)||e)).then(l=>{o(),this.datasets=[{...r.dataset,data:l}],this.data=l,i.after?.(this),this.emit("data"),this.logger.perf(`Data prepared in ${Date.now()-s}ms`)})}async trackLoadDataProgress(e){let r=Date.now(),n=await e.dataset;return this.logger.perf(`Data loaded in ${Date.now()-r}ms`),this.setData(n.data,{dataset:n})}loadDataFromStream(e,r){return this.trackLoadDataProgress(Ni(e,Kt(this,r)))}loadDataFromEvent(e,r){return this.trackLoadDataProgress(Ii(e,Kt(this,r)))}loadDataFromFile(e,r){return this.trackLoadDataProgress(In(e,Kt(this,r)))}loadDataFromUrl(e,r){return this.trackLoadDataProgress(Oi(e,Kt(this,r)))}unloadData(){this.hasDatasets()&&(this.datasets=[],this.data=void 0,this.emit("unloadData"))}hasDatasets(){return this.datasets.length!==0}getQueryEngineInfo(){return{name:"jora",version:K.version,link:"https://discoveryjs.github.io/jora/#article:jora-syntax"}}queryFnFromString(){return rd}queryFn(e){switch(typeof e){case"function":return e;case"string":return Object.assign(this.queryFnFromString(e),{query:e})}}query(e,r,n){switch(typeof e){case"function":return e(r,n);case"string":return this.queryFn(e)(r,n);default:return e}}queryBool(e,r,n){return K.buildin.bool(this.query(e,r,n))}querySuggestions(e,r,n,s){return ua(this,e,r,n,s)}pathToQuery(e){let r="",n=s=>r+=r===""?s[0]==="["?"$"+s:s:s[0]==="["?s:"."+s;for(let s of e)s==="*"?n("values()"):typeof s=="number"?n(`[${s}]`):od(s)?n(s):n(`["${s}"]`);return r}stripAnchorFromHash(e){return typeof e=="string"?e.replace(/(^|&)!anchor(=[^&]+|(?=&|$))/g,""):e}encodePageHash(e=null,r=null,n,s=null){let o=n;return o&&(typeof o!="string"?(Array.isArray(o)||(o=Object.entries(o)),o=o.filter(([i])=>i!=="!anchor").map(i=>i.map(encodeURIComponent).join("=")).join("&")):o=this.stripAnchorFromHash(o)),`#${e?encodeURIComponent(e):""}${typeof r=="string"&&r||typeof r=="number"?":"+encodeURIComponent(r):""}${o?"&"+o:""}${s?"&!anchor="+encodeURIComponent(s):""}`}decodePageHash(e,r=()=>Object.fromEntries){let n=(e.indexOf("&")+1||e.length+1)-1,[s,o=null]=e.substring(e[0]==="#"?1:0,n).split(":").map(decodeURIComponent),i=[],a=null;for(let l of e.slice(n+1).split("&").filter(Boolean)){let c=l.indexOf("="),p,u;c!==-1?(p=decodeURIComponent(l.slice(0,c)),u=decodeURIComponent(l.slice(c+1))):(p=decodeURIComponent(l),u=!0),p==="!anchor"?a=u&&u!==!0?u:null:i.push([p,u])}return{pageId:s,pageRef:o,pageParams:r(s)(i),pageAnchor:a}}resolveValueLinks(e){let r=[],n=typeof e;if(e&&(n==="object"||n==="string"))for(let s of this.linkResolvers){let o=s(e);o&&r.push(o)}return r.length?r:null}};var[nb,ob]=(()=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Uint8Array(64),r=new Uint8Array(256);for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);r[s]=n,e[n]=s}return[e,r]})();var fb=Symbol("stop-match");function st(t,e=t.then()){return Object.assign(Promise.resolve(e),{query(r,n){let s=t.then(async({host:o,data:i,context:a})=>({host:o,data:await o.query(r,i,{...a,args:n}),context:a}));return st(s,s.then(o=>o.data))},context(r,n){let s=t.then(async({host:o,data:i,context:a})=>({host:o,data:i,context:await o.query(r,i,{...a,args:n})}));return st(s,s.then(o=>o.context))},render(r,n){let s=t.then(async({host:o,data:i,context:a})=>{let l=await o.textView.render(null,r,i,{...a,args:n});return await o.textView.serialize(l)});return st(s)},renderToConsole(r,n){let s=t.then(async({host:o,data:i,context:a})=>{let l=await o.textView.render(null,r,i,{...a,args:n}),c=await o.textView.serialize(l);return console.log(c.text),c});return st(s)}})}function pa(t){if(typeof t=="string")try{let e=Jn.resolve(process.cwd(),t),r=fa.statSync(e);return{type:"file",name:Jn.basename(e),path:e,size:r.size,createdAt:r.ctime}}catch{}}var Xt=class extends ot{loadDataFromStream(e,r){return super.loadDataFromStream(cd(e)?ud.toWeb(e):e,typeof e.path=="string"&&!r?.resource?{...r,resource:pa(e.path)}:r)}loadDataFromFile(e,r){let n=Jn.resolve(process.cwd(),e);return this.loadDataFromStream(fa.createReadStream(n),{...r,resource:pa(n)})}queryChain(e=""){return st(Promise.resolve({host:this,data:this.data,context:this.getContext()})).query(e)}},Yb=new Xt({encodings:Sn,extensions:ai,setup:gn,context:{model:Kn.model}}),Jb=new Xt({encodings:Sn});export{Yb as model,Jb as raw};
